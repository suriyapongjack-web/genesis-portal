<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AVS Service Catalog & Pricing System</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
body { font: 12px 'Segoe UI', Arial, sans-serif; background: #f0f2f5; }
.container { max-width: 1600px; margin: 0 auto; padding: 10px; }

/* Header */
.header {
    background: linear-gradient(135deg, #1e3a8a 0%, #3730a3 100%);
    color: white;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.header h1 { font-size: 24px; margin-bottom: 5px; }
.header-info { text-align: right; font-size: 11px; opacity: 0.9; }

/* Project Bar */
.project-bar {
    background: white;
    padding: 15px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    display: flex;
    gap: 15px;
    align-items: center;
    flex-wrap: wrap;
}
.project-bar input, .project-bar select {
    padding: 8px;
    border: 1px solid #d1d5db;
    border-radius: 4px;
    font-size: 12px;
}
.project-bar label {
    font-weight: 600;
    color: #374151;
}

/* Service Navigation */
.service-nav {
    background: white;
    padding: 10px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}
.nav-tabs {
    display: flex;
    gap: 5px;
}
.nav-tab {
    padding: 10px 20px;
    background: #e5e7eb;
    border: none;
    border-radius: 4px 4px 0 0;
    cursor: pointer;
    font-weight: 600;
    transition: all 0.3s;
}
.nav-tab.active {
    background: #3b82f6;
    color: white;
}
.nav-tab:hover {
    background: #60a5fa;
    color: white;
}

/* Main Content Grid */
.content-grid {
    display: grid;
    grid-template-columns: 300px 1fr;
    gap: 20px;
}

/* Service Catalog Tree */
.catalog-panel {
    background: white;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    max-height: 700px;
    overflow-y: auto;
}
.catalog-title {
    font-size: 14px;
    font-weight: bold;
    color: #1f2937;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid #3b82f6;
}
.service-group {
    margin-bottom: 15px;
}
.group-header {
    background: #f3f4f6;
    padding: 8px;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 5px;
}
.group-header:hover {
    background: #e5e7eb;
}
.service-items {
    margin-left: 20px;
    margin-top: 5px;
}
.service-item {
    padding: 6px 10px;
    cursor: pointer;
    border-radius: 4px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}
.service-item:hover {
    background: #eff6ff;
}
.service-item.selected {
    background: #dbeafe;
    font-weight: 600;
}
.service-code {
    font-size: 10px;
    background: #6366f1;
    color: white;
    padding: 2px 6px;
    border-radius: 3px;
}

/* Work Panel */
.work-panel {
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

/* Service Configuration */
.config-section {
    margin-bottom: 25px;
}
.config-title {
    font-size: 16px;
    font-weight: bold;
    color: #1f2937;
    margin-bottom: 15px;
    padding-bottom: 8px;
    border-bottom: 2px solid #10b981;
}
.config-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
}
.config-item {
    display: flex;
    flex-direction: column;
    gap: 5px;
}
.config-item label {
    font-weight: 600;
    color: #4b5563;
    font-size: 11px;
}
.config-item input,
.config-item select {
    padding: 6px;
    border: 1px solid #d1d5db;
    border-radius: 4px;
    font-size: 11px;
}

/* Resource Table */
.resource-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
}
.resource-table th {
    background: #f9fafb;
    padding: 10px;
    text-align: left;
    font-weight: 600;
    border: 1px solid #e5e7eb;
    font-size: 11px;
}
.resource-table td {
    padding: 8px;
    border: 1px solid #e5e7eb;
    font-size: 11px;
}
.resource-table tr:hover {
    background: #f9fafb;
}
.add-resource-btn {
    background: #10b981;
    color: white;
    border: none;
    padding: 8px 16px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 11px;
    font-weight: 600;
}
.add-resource-btn:hover {
    background: #059669;
}
.remove-btn {
    background: #ef4444;
    color: white;
    border: none;
    padding: 4px 8px;
    border-radius: 3px;
    cursor: pointer;
    font-size: 10px;
}

/* Document Management */
.doc-status {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 3px;
    font-size: 10px;
    font-weight: 600;
}
.status-ifr { background: #fef3c7; color: #92400e; }
.status-ifc { background: #dbeafe; color: #1e40af; }
.status-ifa { background: #d1fae5; color: #065f46; }
.status-afc { background: #fee2e2; color: #991b1b; }

.revision-tag {
    display: inline-block;
    background: #e5e7eb;
    padding: 2px 6px;
    border-radius: 3px;
    font-size: 10px;
    margin-left: 5px;
}

/* Summary Panel */
.summary-panel {
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
    border: 2px solid #3b82f6;
    border-radius: 8px;
    padding: 20px;
    margin-top: 20px;
}
.summary-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-bottom: 15px;
}
.summary-item {
    text-align: center;
}
.summary-label {
    font-size: 11px;
    color: #6b7280;
    margin-bottom: 5px;
}
.summary-value {
    font-size: 20px;
    font-weight: bold;
    color: #1e40af;
}
.summary-unit {
    font-size: 11px;
    color: #6b7280;
}

/* Buttons */
.action-buttons {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}
.btn {
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: 600;
    font-size: 12px;
    transition: all 0.3s;
}
.btn-primary {
    background: #3b82f6;
    color: white;
}
.btn-primary:hover {
    background: #2563eb;
}
.btn-success {
    background: #10b981;
    color: white;
}
.btn-warning {
    background: #f59e0b;
    color: white;
}
.btn-export {
    background: #8b5cf6;
    color: white;
}

/* Responsive */
@media (max-width: 1024px) {
    .content-grid {
        grid-template-columns: 1fr;
    }
}

/* Location Info Panel */
.location-info {
    background: #f0f9ff;
    border: 1px solid #3b82f6;
    border-radius: 4px;
    padding: 10px;
    margin-top: 10px;
    font-size: 11px;
    display: none;
}
.location-info.active {
    display: block;
}
.location-info-title {
    font-weight: 600;
    color: #1e40af;
    margin-bottom: 5px;
}
.location-info-details {
    color: #4b5563;
}

/* Integration Status */
.integration-status {
    position: fixed;
    top: 10px;
    right: 10px;
    padding: 8px 12px;
    background: #10b981;
    color: white;
    border-radius: 4px;
    font-size: 11px;
    display: none;
    z-index: 1000;
}
.integration-status.active {
    display: block;
}

/* Service Recommendations */
.service-item.recommended {
    background-color: #fef3c7 !important;
    border-left: 3px solid #f59e0b;
}

/* Location Type Badges */
.location-badge {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 3px;
    font-size: 10px;
    font-weight: 600;
    margin-left: 5px;
}
.badge-offshore { background: #dbeafe; color: #1e40af; }
.badge-onshore { background: #d1fae5; color: #065f46; }
.badge-document { background: #fee2e2; color: #991b1b; }
</style>
</head>
<body>
<div class="container">
    <!-- Header -->
    <div class="header">
        <div>
            <h1>üè¢ ADDVALUE SYSTEM CO., LTD.</h1>
            <p>Standard Service Catalog & Pricing System v4.0</p>
        </div>
        <div class="header-info">
            <p>User: Engineering Team</p>
            <p id="datetime">Loading...</p>
            <p>Session: #2025-001</p>
        </div>
    </div>

    <!-- Project Information Bar -->
    <div class="project-bar">
        <div>
            <label>Project:</label>
            <input type="text" id="projectName" placeholder="Enter Project Name" style="width: 200px;">
        </div>
        <div>
            <label>Client:</label>
            <select id="clientType" onchange="updateLocations()">
                <option value="">-- Select Client --</option>
                <option>PTTEP</option>
                <option>Chevron</option>
                <option>MUBADALA</option>
                <option>TOTAL</option>
                <option>Other O&G</option>
                <option>Non-O&G</option>
            </select>
        </div>
        <div>
            <label>Country:</label>
            <select id="country" onchange="updateLocationsByCountry()">
                <option value="">-- Select Country --</option>
                <option value="thailand">üáπüá≠ Thailand</option>
                <option value="myanmar">üá≤üá≤ Myanmar</option>
                <option value="malaysia">üá≤üáæ Malaysia</option>
            </select>
        </div>
        <div>
            <label>Location:</label>
            <select id="location">
                <option value="">-- Select Location --</option>
            </select>
        </div>
        <div>
            <label>Quote No:</label>
            <input type="text" id="quoteNo" value="Q-2025-001" style="width: 120px;">
        </div>
        <div>
            <label>Rev:</label>
            <select id="revision">
                <option>Rev.0</option>
                <option>Rev.A</option>
                <option>Rev.B</option>
                <option>Rev.C</option>
            </select>
        </div>
    </div>
    
    <!-- Price Adjustment Settings -->
    <div class="project-bar" style="background: #fef3c7; border: 1px solid #f59e0b;">
        <div style="width: 100%; display: flex; gap: 20px; align-items: center;">
            <div style="font-weight: bold; color: #92400e;">
                üí∞ Location Price Adjustment:
            </div>
            <div>
                <label style="font-size: 11px;">Offshore:</label>
                <input type="number" id="offshoreAdjust" value="30" min="-100" max="200" style="width: 60px;">
                <span style="font-size: 11px;">%</span>
            </div>
            <div>
                <label style="font-size: 11px;">Onshore:</label>
                <input type="number" id="onshoreAdjust" value="30" min="-100" max="200" style="width: 60px;">
                <span style="font-size: 11px;">%</span>
            </div>
            <div>
                <label style="font-size: 11px;">Document:</label>
                <input type="number" id="documentAdjust" value="0" min="-100" max="200" style="width: 60px;">
                <span style="font-size: 11px;">%</span>
            </div>
            <button onclick="applyPriceAdjustment()" style="padding: 6px 12px; background: #f59e0b; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px;">
                Apply Adjustment
            </button>
            <span id="adjustmentStatus" style="font-size: 11px; color: #065f46; display: none;">‚úì Applied</span>
        </div>
    </div>
    
    <!-- Location Info Panel -->
    <div class="location-info" id="locationInfo">
        <div class="location-info-title">üìç Selected Location Details</div>
        <div class="location-info-details" id="locationDetails">
            No location selected
        </div>
    </div>

    <!-- Integration Status Indicator -->
    <div class="integration-status" id="integrationStatus">
        ‚úÖ Location Dashboard Connected
    </div>

    <!-- Service Navigation -->
    <div class="service-nav">
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('field')">üîß Field Engineering</button>
            <button class="nav-tab" onclick="switchTab('document')">üìÑ Document Engineering</button>
            <button class="nav-tab" onclick="switchTab('testing')">üß™ Testing & Commissioning</button>
            <button class="nav-tab" onclick="switchTab('specialized')">üöÄ Specialized Services</button>
            <button class="nav-tab" onclick="switchTab('summary')">üìä Summary</button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="content-grid">
        <!-- Service Catalog Tree -->
        <div class="catalog-panel">
            <div class="catalog-title">üìö Service Catalog</div>
            
            <!-- Field Engineering Services -->
            <div class="service-group">
                <div class="group-header" onclick="toggleGroup('field-group')">
                    <span>‚ñº</span> Field Engineering Services
                </div>
                <div class="service-items" id="field-group">
                    <div class="service-item" onclick="selectService('SURVEY')">
                        <span>Site Survey</span>
                        <span class="service-code">SURVEY</span>
                    </div>
                    <div class="service-item" onclick="selectService('INSTALL')">
                        <span>Installation & Config</span>
                        <span class="service-code">INSTALL</span>
                    </div>
                    <div class="service-item" onclick="selectService('MAINT')">
                        <span>Maintenance Service</span>
                        <span class="service-code">MAINT</span>
                    </div>
                    <div class="service-item" onclick="selectService('TROUBLE')">
                        <span>Troubleshooting</span>
                        <span class="service-code">TROUBLE</span>
                    </div>
                    <div class="service-item" onclick="selectService('UPGRADE')">
                        <span>System Upgrade</span>
                        <span class="service-code">UPGRADE</span>
                    </div>
                </div>
            </div>

            <!-- Testing Services -->
            <div class="service-group">
                <div class="group-header" onclick="toggleGroup('test-group')">
                    <span>‚ñº</span> Testing & Commissioning
                </div>
                <div class="service-items" id="test-group">
                    <div class="service-item" onclick="selectService('FAT')">
                        <span>Factory Acceptance Test</span>
                        <span class="service-code">FAT</span>
                    </div>
                    <div class="service-item" onclick="selectService('SAT')">
                        <span>Site Acceptance Test</span>
                        <span class="service-code">SAT</span>
                    </div>
                    <div class="service-item" onclick="selectService('SIT')">
                        <span>System Integration Test</span>
                        <span class="service-code">SIT</span>
                    </div>
                    <div class="service-item" onclick="selectService('COMM')">
                        <span>Commissioning</span>
                        <span class="service-code">COMM</span>
                    </div>
                    <div class="service-item" onclick="selectService('LOOP')">
                        <span>Loop Check</span>
                        <span class="service-code">LOOP</span>
                    </div>
                </div>
            </div>

            <!-- Document Engineering -->
            <div class="service-group">
                <div class="group-header" onclick="toggleGroup('doc-group')">
                    <span>‚ñº</span> Document Engineering
                </div>
                <div class="service-items" id="doc-group">
                    <div class="service-item" onclick="selectService('PRE-FEED')">
                        <span>Pre-FEED Package</span>
                        <span class="service-code">PRE-FEED</span>
                    </div>
                    <div class="service-item" onclick="selectService('FEED')">
                        <span>FEED Package</span>
                        <span class="service-code">FEED</span>
                    </div>
                    <div class="service-item" onclick="selectService('DETAIL')">
                        <span>Detail Design</span>
                        <span class="service-code">DETAIL</span>
                    </div>
                    <div class="service-item" onclick="selectService('VDRL')">
                        <span>VDRL Documents</span>
                        <span class="service-code">VDRL</span>
                    </div>
                    <div class="service-item" onclick="selectService('AS-BUILT')">
                        <span>As-Built Package</span>
                        <span class="service-code">AS-BUILT</span>
                    </div>
                </div>
            </div>

            <!-- Specialized Services -->
            <div class="service-group">
                <div class="group-header" onclick="toggleGroup('spec-group')">
                    <span>‚ñº</span> Specialized Services
                </div>
                <div class="service-items" id="spec-group">
                    <div class="service-item" onclick="selectService('PM')">
                        <span>Project Management</span>
                        <span class="service-code">PM</span>
                    </div>
                    <div class="service-item" onclick="selectService('CONSULT')">
                        <span>Technical Consultancy</span>
                        <span class="service-code">CONSULT</span>
                    </div>
                    <div class="service-item" onclick="selectService('TRAINING')">
                        <span>Training Services</span>
                        <span class="service-code">TRAINING</span>
                    </div>
                    <div class="service-item" onclick="selectService('AUDIT')">
                        <span>System Audit</span>
                        <span class="service-code">AUDIT</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Work Configuration Panel -->
        <div class="work-panel">
            <!-- Service Configuration -->
            <div class="config-section">
                <div class="config-title">‚öôÔ∏è Service Configuration: <span id="selectedService">Site Survey</span></div>
                
                <div class="config-grid">
                    <div class="config-item">
                        <label>Service Type:</label>
                        <select id="serviceType">
                            <option>Standard Package</option>
                            <option>Custom Configuration</option>
                            <option>Emergency Response</option>
                        </select>
                    </div>
                    <div class="config-item">
                        <label>Duration (Days):</label>
                        <input type="number" id="duration" value="5" min="1">
                    </div>
                    <div class="config-item">
                        <label>Start Date:</label>
                        <input type="date" id="startDate" value="2025-02-01">
                    </div>
                    <div class="config-item">
                        <label>Complexity:</label>
                        <select id="complexity">
                            <option>Low</option>
                            <option selected>Medium</option>
                            <option>High</option>
                            <option>Very High</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Resource Assignment -->
            <div class="config-section">
                <div class="config-title">üë• Resource Assignment</div>
                
                <table class="resource-table">
                    <thead>
                        <tr>
                            <th>Position</th>
                            <th>Name/Code</th>
                            <th>Level</th>
                            <th>Qty</th>
                            <th>Days</th>
                            <th>Rate/Day</th>
                            <th>Man-Hours</th>
                            <th>Subtotal</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="resourceTable">
                        <tr>
                            <td>
                                <select class="position-select">
                                    <option>Lead Engineer</option>
                                    <option>Sr. Engineer</option>
                                    <option>Engineer</option>
                                    <option>Technician</option>
                                </select>
                            </td>
                            <td><input type="text" value="ENG-001" style="width: 80px;"></td>
                            <td>
                                <select>
                                    <option>Senior</option>
                                    <option>Mid</option>
                                    <option>Junior</option>
                                </select>
                            </td>
                            <td><input type="number" value="1" min="1" style="width: 50px;"></td>
                            <td><input type="number" value="5" min="1" style="width: 50px;"></td>
                            <td><input type="number" value="18000" style="width: 80px;"></td>
                            <td>60</td>
                            <td style="font-weight: bold; color: #059669;">‡∏ø90,000</td>
                            <td><button class="remove-btn">Remove</button></td>
                        </tr>
                        <tr>
                            <td>
                                <select class="position-select">
                                    <option>Lead Engineer</option>
                                    <option>Sr. Engineer</option>
                                    <option selected>Engineer</option>
                                    <option>Technician</option>
                                </select>
                            </td>
                            <td><input type="text" value="ENG-002" style="width: 80px;"></td>
                            <td>
                                <select>
                                    <option>Senior</option>
                                    <option selected>Mid</option>
                                    <option>Junior</option>
                                </select>
                            </td>
                            <td><input type="number" value="2" min="1" style="width: 50px;"></td>
                            <td><input type="number" value="5" min="1" style="width: 50px;"></td>
                            <td><input type="number" value="9000" style="width: 80px;"></td>
                            <td>120</td>
                            <td style="font-weight: bold; color: #059669;">‡∏ø90,000</td>
                            <td><button class="remove-btn">Remove</button></td>
                        </tr>
                    </tbody>
                </table>
                <button class="add-resource-btn" onclick="addResource()">+ Add Resource</button>
            </div>

            <!-- Document Details (for Document Engineering) -->
            <div class="config-section" id="documentSection" style="display: none;">
                <div class="config-title">üìã Document Deliverables</div>
                
                <table class="resource-table">
                    <thead>
                        <tr>
                            <th>Document Code</th>
                            <th>Document Title</th>
                            <th>Type</th>
                            <th>Rev</th>
                            <th>Status</th>
                            <th>Man-Hours</th>
                            <th>Responsible</th>
                            <th>Progress</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>TSI-DDS-001</td>
                            <td>System Design Specification</td>
                            <td>Technical</td>
                            <td><span class="revision-tag">Rev.B</span></td>
                            <td><span class="doc-status status-ifc">IFC</span></td>
                            <td>120</td>
                            <td>Sr. Engineer</td>
                            <td>75%</td>
                        </tr>
                        <tr>
                            <td>TSI-PID-001</td>
                            <td>P&ID Telecom System</td>
                            <td>Drawing</td>
                            <td><span class="revision-tag">Rev.A</span></td>
                            <td><span class="doc-status status-ifr">IFR</span></td>
                            <td>80</td>
                            <td>CAD Designer</td>
                            <td>50%</td>
                        </tr>
                        <tr>
                            <td>TSI-BOQ-001</td>
                            <td>Bill of Quantity</td>
                            <td>Commercial</td>
                            <td><span class="revision-tag">Rev.C</span></td>
                            <td><span class="doc-status status-ifa">IFA</span></td>
                            <td>40</td>
                            <td>Engineer</td>
                            <td>100%</td>
                        </tr>
                        <tr>
                            <td>TSI-MTO-001</td>
                            <td>Material Take Off</td>
                            <td>Procurement</td>
                            <td><span class="revision-tag">Rev.0</span></td>
                            <td><span class="doc-status status-afc">AFC</span></td>
                            <td>60</td>
                            <td>Engineer</td>
                            <td>25%</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Cost Summary -->
            <div class="summary-panel">
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-label">Total Man-Days</div>
                        <div class="summary-value">30</div>
                        <div class="summary-unit">days</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Total Man-Hours</div>
                        <div class="summary-value">360</div>
                        <div class="summary-unit">hours</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Service Cost</div>
                        <div class="summary-value">‡∏ø180,000</div>
                        <div class="summary-unit">THB</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Additional Cost</div>
                        <div class="summary-value">‡∏ø25,000</div>
                        <div class="summary-unit">THB</div>
                    </div>
                </div>
                
                <div style="text-align: center; padding-top: 15px; border-top: 2px solid #3b82f6;">
                    <div style="font-size: 14px; color: #6b7280;">Total Package Price</div>
                    <div style="font-size: 28px; font-weight: bold; color: #1e40af;">‡∏ø205,000</div>
                    <div style="font-size: 11px; color: #6b7280;">(Exclude VAT 7%)</div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-primary">üíæ Save Configuration</button>
                <button class="btn btn-success">‚úì Add to Quote</button>
                <button class="btn btn-warning">üìã Copy Service</button>
                <button class="btn btn-export">üì• Export to Excel</button>
                <button class="btn" style="background: #6b7280; color: white;">üîÑ Reset</button>
            </div>
        </div>
    </div>
</div>

<script>
// Update datetime
function updateDateTime() {
    const now = new Date();
    document.getElementById('datetime').textContent = now.toLocaleString('en-US', {
        year: 'numeric',
        month: 'short',
        day: '2-digit',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
    });
}
setInterval(updateDateTime, 1000);
updateDateTime();

// Toggle service group
function toggleGroup(groupId) {
    const group = document.getElementById(groupId);
    group.style.display = group.style.display === 'none' ? 'block' : 'none';
}

// Switch tabs
function switchTab(tab) {
    const tabs = document.querySelectorAll('.nav-tab');
    tabs.forEach(t => t.classList.remove('active'));
    event.target.classList.add('active');
    
    // Show/hide document section based on tab
    const docSection = document.getElementById('documentSection');
    if (tab === 'document') {
        docSection.style.display = 'block';
    } else {
        docSection.style.display = 'none';
    }
}

// Select service
function selectService(serviceCode) {
    // Update UI
    const items = document.querySelectorAll('.service-item');
    items.forEach(item => item.classList.remove('selected'));
    event.currentTarget.classList.add('selected');
    
    // Update selected service display
    document.getElementById('selectedService').textContent = event.currentTarget.querySelector('span').textContent;
    
    // Load service-specific configuration
    loadServiceConfig(serviceCode);
}

// Load service configuration
function loadServiceConfig(serviceCode) {
    // This would load specific configurations based on service type
    console.log('Loading configuration for:', serviceCode);
    
    // Show document section for document services
    const docSection = document.getElementById('documentSection');
    if (['PRE-FEED', 'FEED', 'DETAIL', 'VDRL', 'AS-BUILT'].includes(serviceCode)) {
        docSection.style.display = 'block';
    } else {
        docSection.style.display = 'none';
    }
}

// Add resource row
function addResource() {
    const table = document.getElementById('resourceTable');
    const newRow = table.insertRow();
    newRow.innerHTML = `
        <td>
            <select class="position-select">
                <option>Lead Engineer</option>
                <option>Sr. Engineer</option>
                <option>Engineer</option>
                <option>Technician</option>
            </select>
        </td>
        <td><input type="text" value="ENG-00${table.rows.length + 1}" style="width: 80px;"></td>
        <td>
            <select>
                <option>Senior</option>
                <option>Mid</option>
                <option>Junior</option>
            </select>
        </td>
        <td><input type="number" value="1" min="1" style="width: 50px;"></td>
        <td><input type="number" value="1" min="1" style="width: 50px;"></td>
        <td><input type="number" value="6000" style="width: 80px;"></td>
        <td>12</td>
        <td style="font-weight: bold; color: #059669;">‡∏ø6,000</td>
        <td><button class="remove-btn" onclick="this.closest('tr').remove()">Remove</button></td>
    `;
}

// Calculate totals
function calculateTotals() {
    // This would calculate all totals based on inputs
    console.log('Calculating totals...');
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    console.log('AVS Service Catalog System loaded');
    calculateTotals();
    initializeLocationData();
});

// Location Data from Location Dashboard v4
const locationData = {
    thailand: {
        name: 'üáπüá≠ Thailand',
        locations: [
            { id: 'th-g1', name: 'G1 Platform', type: 'offshore', details: 'Platong, Erawan, Satun, Funan' },
            { id: 'th-g2', name: 'G2 Platform', type: 'offshore', details: 'G2N, G2S, Arthit' },
            { id: 'th-bualuang', name: 'Bualuang Field', type: 'offshore', details: 'Alpha, Bravo' },
            { id: 'th-gcme', name: 'GCME Platform', type: 'offshore', details: 'Arthit South' },
            { id: 'th-bkk', name: 'Bangkok DCC', type: 'document', details: 'Main, VDRL, ESO, PMO' }
        ]
    },
    myanmar: {
        name: 'üá≤üá≤ Myanmar',
        locations: [
            { id: 'mm-zawtika-off', name: 'ZAWTIKA Offshore', type: 'offshore', details: 'ZPQ, Z1D, Z1E' },
            { id: 'mm-zawtika-on', name: 'ZAWTIKA Onshore', type: 'onshore', details: 'ATL' },
            { id: 'mm-yadana', name: 'YADANA', type: 'onshore', details: 'PLC-MS' }
        ]
    },
    malaysia: {
        name: 'üá≤üáæ Malaysia',
        locations: [
            { id: 'my-jda', name: 'JDA Platform', type: 'offshore', details: 'CPOC' }
        ]
    }
};

// Client-Location Mapping
const clientLocationMap = {
    'PTTEP': ['thailand', 'myanmar', 'malaysia'],
    'Chevron': ['thailand'],
    'MUBADALA': ['thailand', 'myanmar'],
    'TOTAL': ['myanmar'],
    'Other O&G': ['thailand', 'myanmar', 'malaysia'],
    'Non-O&G': ['thailand']
};

// Initialize location data
function initializeLocationData() {
    console.log('Initializing Location Data from Dashboard v4');
    
    // Add event listeners
    const clientSelect = document.getElementById('clientType');
    const countrySelect = document.getElementById('country');
    
    if (clientSelect) {
        clientSelect.addEventListener('change', updateLocations);
    }
    
    if (countrySelect) {
        countrySelect.addEventListener('change', updateLocationsByCountry);
    }
}

// Update available countries based on selected client
function updateLocations() {
    const client = document.getElementById('clientType').value;
    const countrySelect = document.getElementById('country');
    const locationSelect = document.getElementById('location');
    
    // Clear selections
    countrySelect.innerHTML = '<option value="">-- Select Country --</option>';
    locationSelect.innerHTML = '<option value="">-- Select Location --</option>';
    
    if (client && clientLocationMap[client]) {
        const availableCountries = clientLocationMap[client];
        
        availableCountries.forEach(country => {
            if (locationData[country]) {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = locationData[country].name;
                countrySelect.appendChild(option);
            }
        });
        
        // Enable country select
        countrySelect.disabled = false;
    } else if (client === '') {
        // If no client selected, show all countries
        Object.keys(locationData).forEach(country => {
            const option = document.createElement('option');
            option.value = country;
            option.textContent = locationData[country].name;
            countrySelect.appendChild(option);
        });
    }
}

// Update locations based on selected country
function updateLocationsByCountry() {
    const country = document.getElementById('country').value;
    const locationSelect = document.getElementById('location');
    
    // Clear current locations
    locationSelect.innerHTML = '<option value="">-- Select Location --</option>';
    
    if (country && locationData[country]) {
        const locations = locationData[country].locations;
        
        locations.forEach(loc => {
            const option = document.createElement('option');
            option.value = loc.id;
            option.textContent = `${loc.name} (${loc.type.charAt(0).toUpperCase() + loc.type.slice(1)})`;
            option.setAttribute('data-type', loc.type);
            option.setAttribute('data-details', loc.details);
            
            // Add icon based on type
            if (loc.type === 'offshore') {
                option.textContent = 'üõ¢Ô∏è ' + option.textContent;
            } else if (loc.type === 'onshore') {
                option.textContent = 'üè≠ ' + option.textContent;
            } else if (loc.type === 'document') {
                option.textContent = 'üìÑ ' + option.textContent;
            }
            
            locationSelect.appendChild(option);
        });
        
        // Auto-adjust service recommendations based on location type
        locationSelect.addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            if (selectedOption && selectedOption.value) {
                const locationType = selectedOption.getAttribute('data-type');
                const details = selectedOption.getAttribute('data-details');
                
                // Show location info
                showLocationInfo(selectedOption.textContent, locationType, details);
                
                // Recommend services
                recommendServices(locationType);
                
                // Auto-adjust pricing based on location
                adjustPricingByLocation(locationType);
            } else {
                hideLocationInfo();
            }
        });
    }
}

// Show location information panel
function showLocationInfo(locationName, locationType, details) {
    const locationInfo = document.getElementById('locationInfo');
    const locationDetails = document.getElementById('locationDetails');
    
    let badgeClass = '';
    if (locationType === 'offshore') badgeClass = 'badge-offshore';
    else if (locationType === 'onshore') badgeClass = 'badge-onshore';
    else if (locationType === 'document') badgeClass = 'badge-document';
    
    locationDetails.innerHTML = `
        <strong>${locationName}</strong>
        <span class="location-badge ${badgeClass}">${locationType.toUpperCase()}</span>
        <br>
        <span style="color: #6b7280; font-size: 10px;">Facilities: ${details}</span>
    `;
    
    locationInfo.classList.add('active');
    
    // Show integration status briefly
    showIntegrationStatus();
}

// Hide location information panel
function hideLocationInfo() {
    const locationInfo = document.getElementById('locationInfo');
    locationInfo.classList.remove('active');
}

// Show integration status notification
function showIntegrationStatus() {
    const status = document.getElementById('integrationStatus');
    status.classList.add('active');
    setTimeout(() => {
        status.classList.remove('active');
    }, 2000);
}

// Adjust pricing based on location type
function adjustPricingByLocation(locationType) {
    // Get custom adjustment percentages from inputs
    const offshoreAdjust = parseFloat(document.getElementById('offshoreAdjust').value) || 30;
    const onshoreAdjust = parseFloat(document.getElementById('onshoreAdjust').value) || 30;
    const documentAdjust = parseFloat(document.getElementById('documentAdjust').value) || 0;
    
    const multipliers = {
        'offshore': 1 + (offshoreAdjust / 100),  // Custom % adjustment
        'onshore': 1 + (onshoreAdjust / 100),    // Custom % adjustment
        'document': 1 + (documentAdjust / 100)    // Custom % adjustment (default 0%)
    };
    
    const multiplier = multipliers[locationType] || 1.0;
    
    // Store base rates if not already stored
    if (!window.baseRates) {
        window.baseRates = {
            lead: 18000,
            senior: 9000,
            mid: 6000
        };
    }
    
    // Update all rate inputs based on multiplier
    document.querySelectorAll('#resourceTable input[type="number"]').forEach(input => {
        const currentValue = parseInt(input.value);
        // Check if this is a rate field (typical values)
        if (currentValue >= 5000 && currentValue <= 25000) {
            // Determine base rate
            let baseRate = currentValue;
            if (currentValue > 15000) baseRate = window.baseRates.lead;
            else if (currentValue > 7000) baseRate = window.baseRates.senior;
            else baseRate = window.baseRates.mid;
            
            const adjustedRate = Math.round(baseRate * multiplier);
            input.value = adjustedRate;
        }
    });
    
    // Trigger recalculation
    calculateTotals();
    
    // Show adjustment info
    const adjustPercent = multiplier > 1 ? `+${((multiplier - 1) * 100).toFixed(0)}%` : 
                          multiplier < 1 ? `-${((1 - multiplier) * 100).toFixed(0)}%` : 
                          'Standard';
    
    console.log(`Pricing adjusted for ${locationType} location (${adjustPercent})`);
    
    // Update location info to show adjustment
    const locationDetails = document.getElementById('locationDetails');
    if (locationDetails && locationDetails.innerHTML !== 'No location selected') {
        const currentHTML = locationDetails.innerHTML;
        if (!currentHTML.includes('Price Adjustment:')) {
            locationDetails.innerHTML += `<br><span style="color: #f59e0b; font-weight: bold;">üí∞ Price Adjustment: ${adjustPercent}</span>`;
        } else {
            // Update existing adjustment info
            locationDetails.innerHTML = currentHTML.replace(/Price Adjustment:.*?<\/span>/, `Price Adjustment: ${adjustPercent}</span>`);
        }
    }
}

// Apply custom price adjustment
function applyPriceAdjustment() {
    const locationSelect = document.getElementById('location');
    const selectedOption = locationSelect.options[locationSelect.selectedIndex];
    
    if (selectedOption && selectedOption.value) {
        const locationType = selectedOption.getAttribute('data-type');
        adjustPricingByLocation(locationType);
        
        // Show confirmation
        const status = document.getElementById('adjustmentStatus');
        status.style.display = 'inline';
        setTimeout(() => {
            status.style.display = 'none';
        }, 2000);
    } else {
        alert('Please select a location first');
    }
}

// Reset price adjustment to defaults
function resetPriceAdjustment() {
    document.getElementById('offshoreAdjust').value = 30;
    document.getElementById('onshoreAdjust').value = 30;
    document.getElementById('documentAdjust').value = 0;
    
    const locationSelect = document.getElementById('location');
    const selectedOption = locationSelect.options[locationSelect.selectedIndex];
    
    if (selectedOption && selectedOption.value) {
        const locationType = selectedOption.getAttribute('data-type');
        adjustPricingByLocation(locationType);
    }
}

// Recommend services based on location type
function recommendServices(locationType) {
    console.log('Recommending services for location type:', locationType);
    
    // Highlight recommended services based on location type
    const recommendations = {
        'offshore': ['SURVEY', 'INSTALL', 'MAINT', 'COMM', 'SAT'],
        'onshore': ['INSTALL', 'UPGRADE', 'FAT', 'TRAINING'],
        'document': ['PRE-FEED', 'FEED', 'DETAIL', 'VDRL', 'AS-BUILT']
    };
    
    // Clear all highlights first
    document.querySelectorAll('.service-item').forEach(item => {
        item.style.backgroundColor = '';
    });
    
    // Highlight recommended services
    if (recommendations[locationType]) {
        recommendations[locationType].forEach(serviceCode => {
            document.querySelectorAll('.service-code').forEach(code => {
                if (code.textContent === serviceCode) {
                    code.parentElement.style.backgroundColor = '#fef3c7';
                }
            });
        });
    }
}

// Integration with Location Dashboard (if embedded in iframe)
window.addEventListener('message', function(event) {
    if (event.data.type === 'LOCATION_SELECTED') {
        console.log('Location selected from dashboard:', event.data.data);
        
        // Parse location ID to set country and location
        const locationId = event.data.data.id;
        if (locationId) {
            const parts = locationId.split('-');
            const countryMap = { 'th': 'thailand', 'mm': 'myanmar', 'my': 'malaysia' };
            const country = countryMap[parts[0]];
            
            if (country) {
                document.getElementById('country').value = country;
                updateLocationsByCountry();
                
                // Set the specific location after a short delay
                setTimeout(() => {
                    document.getElementById('location').value = locationId;
                }, 100);
            }
        }
    }
});

// Send system status to parent window (if in iframe)
function sendSystemStatus() {
    if (window.parent !== window) {
        window.parent.postMessage({
            type: 'AVS_CATALOG_STATUS',
            module: 'service-catalog',
            version: '4.0',
            ready: true,
            timestamp: new Date().toISOString()
        }, '*');
    }
}

// Call on load
setTimeout(sendSystemStatus, 1000);
</script>
</body>
</html>