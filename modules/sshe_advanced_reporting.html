<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Addvalue SSHE Advanced Reporting System</title>
<style>
* {margin:0;padding:0;box-sizing:border-box}
body {font-family:'Segoe UI',Tahoma,sans-serif;background:#f0f2f5;color:#1a1a1a}
.container {max-width:1400px;margin:0 auto;padding:20px}
.header {background:linear-gradient(135deg,#4f46e5,#7c3aed);color:white;padding:30px;border-radius:12px;margin-bottom:30px}
.header h1 {font-size:2rem;margin-bottom:10px}
.tabs {display:flex;gap:10px;margin-bottom:20px;background:white;padding:15px;border-radius:10px}
.tab {padding:12px 24px;border:none;background:#f3f4f6;border-radius:8px;cursor:pointer;font-weight:500;transition:all 0.3s}
.tab.active {background:#4f46e5;color:white}
.tab:hover {background:#e5e7eb}
.tab.active:hover {background:#4338ca}
.content {background:white;padding:25px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.hidden {display:none}
.stats {display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px}
.stat-card {background:white;padding:20px;border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,0.1)}
.stat-value {font-size:2rem;font-weight:bold;color:#4f46e5}
.stat-label {color:#6b7280;margin-top:5px}
.filter-section {background:#f9fafb;padding:20px;border-radius:10px;margin-bottom:20px}
.filter-group {margin-bottom:20px}
.filter-group h3 {margin-bottom:15px;color:#374151;font-size:1.1rem}
.checkbox-grid {display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:10px}
.checkbox-item {display:flex;align-items:center;gap:8px;padding:8px;background:white;border-radius:6px;cursor:pointer;transition:all 0.2s}
.checkbox-item:hover {background:#e0e7ff}
.checkbox-item input {cursor:pointer;width:18px;height:18px}
.checkbox-item label {cursor:pointer;flex:1}
.btn {padding:10px 20px;border:none;border-radius:6px;cursor:pointer;font-weight:500;transition:all 0.3s;margin-right:10px}
.btn-primary {background:#4f46e5;color:white}
.btn-primary:hover {background:#4338ca}
.btn-success {background:#10b981;color:white}
.btn-success:hover {background:#059669}
.btn-warning {background:#f59e0b;color:white}
.btn-warning:hover {background:#d97706}
.btn-danger {background:#ef4444;color:white}
.btn-danger:hover {background:#dc2626}
.btn-info {background:#3b82f6;color:white}
.btn-info:hover {background:#2563eb}
.btn-secondary {background:#6b7280;color:white}
.btn-secondary:hover {background:#4b5563}
input,select,textarea {padding:10px;border:1px solid #d1d5db;border-radius:6px;font-size:14px}
.search-box {width:100%;padding:12px;font-size:16px;margin-bottom:20px}
.report-preview {background:#f9fafb;padding:20px;border-radius:10px;margin-top:20px;max-height:500px;overflow-y:auto}
.report-table {width:100%;border-collapse:collapse;margin-top:20px}
.report-table th {background:#4f46e5;color:white;padding:12px;text-align:left;position:sticky;top:0}
.report-table td {padding:10px;border-bottom:1px solid #e5e7eb}
.report-table tr:hover {background:#f9fafb}
.valid {background:#d1fae5;color:#065f46;padding:4px 8px;border-radius:4px}
.expiring {background:#fed7aa;color:#92400e;padding:4px 8px;border-radius:4px}
.expired {background:#fee2e2;color:#991b1b;padding:4px 8px;border-radius:4px}
.na {background:#f3f4f6;color:#6b7280;padding:4px 8px;border-radius:4px}
.personnel-grid {display:grid;grid-template-columns:repeat(auto-fill,minmax(350px,1fr));gap:20px}
.person-card {background:white;border-radius:10px;padding:20px;box-shadow:0 2px 8px rgba(0,0,0,0.1);transition:all 0.3s}
.person-card:hover {box-shadow:0 4px 12px rgba(0,0,0,0.15)}
.person-header {border-bottom:1px solid #e5e7eb;padding-bottom:15px;margin-bottom:15px}
.person-name {font-size:1.2rem;font-weight:bold;color:#1f2937}
.person-id {color:#6b7280;font-size:0.9rem;margin-top:5px}
.cert-list {display:flex;flex-direction:column;gap:8px}
.cert-item {display:flex;justify-content:space-between;align-items:center;padding:8px;background:#f9fafb;border-radius:6px}
.modal {display:none;position:fixed;inset:0;background:rgba(0,0,0,0.5);z-index:1000}
.modal-content {background:white;max-width:800px;margin:50px auto;padding:30px;border-radius:12px;max-height:80vh;overflow-y:auto}
.modal-header {display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding-bottom:15px;border-bottom:2px solid #e5e7eb}
.close {font-size:28px;cursor:pointer;color:#6b7280}
.close:hover {color:#ef4444}
.form-group {margin-bottom:20px}
.form-group label {display:block;margin-bottom:5px;font-weight:500;color:#374151}
.form-group input {width:100%;padding:10px;border:1px solid #d1d5db;border-radius:6px}
.form-group input:focus {outline:none;border-color:#4f46e5;box-shadow:0 0 0 3px rgba(79,70,229,0.1)}
.action-buttons {display:flex;gap:10px;margin-top:15px}
.select-all-btn {background:#e0e7ff;color:#4338ca;padding:8px 16px;border:none;border-radius:6px;cursor:pointer;font-weight:500;margin-bottom:10px}
.select-all-btn:hover {background:#c7d2fe}
.summary-cards {display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:15px;margin:20px 0}
.summary-card {background:linear-gradient(135deg,#667eea,#764ba2);color:white;padding:20px;border-radius:10px;position:relative;overflow:hidden}
.summary-card::before {content:'';position:absolute;top:-50%;right:-50%;width:200%;height:200%;background:rgba(255,255,255,0.1);transform:rotate(45deg)}
.summary-card h4 {font-size:0.9rem;opacity:0.9;margin-bottom:10px}
.summary-card .value {font-size:2rem;font-weight:bold}
.date-filter {display:flex;gap:10px;align-items:center;margin:15px 0}
.date-filter label {font-weight:500;color:#374151}
.date-filter input {padding:8px;border:1px solid #d1d5db;border-radius:6px}
@media print {
.no-print {display:none}
.report-table {font-size:12px}
.report-table th {background:#333;color:white}
}
.chart-container {margin:20px 0;padding:20px;background:#f9fafb;border-radius:10px}
#statusChart {width:100%;height:300px}
.legend {display:flex;justify-content:center;gap:20px;margin-top:15px}
.legend-item {display:flex;align-items:center;gap:5px}
.legend-box {width:20px;height:20px;border-radius:4px}
</style>
</head>
<body>
<div class="container">
<div class="header">
<h1>üõ°Ô∏è Addvalue SSHE Advanced Reporting System</h1>
<p>‡∏£‡∏∞‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ç‡∏±‡πâ‡∏ô‡∏™‡∏π‡∏á - ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡πÅ‡∏•‡∏∞‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£</p>
</div>

<div class="tabs">
<button class="tab active" onclick="showTab('dashboard')">üìä Dashboard</button>
<button class="tab" onclick="showTab('personnel')">üë• ‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</button>
<button class="tab" onclick="showTab('reports')">üìã ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
<button class="tab" onclick="showTab('analysis')">üìà ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
</div>

<div id="dashboard" class="content">
<div class="stats">
<div class="stat-card">
<div class="stat-value" id="statTotal">0</div>
<div class="stat-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
</div>
<div class="stat-card">
<div class="stat-value" id="statValid">0</div>
<div class="stat-label">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏õ‡∏Å‡∏ï‡∏¥</div>
</div>
<div class="stat-card">
<div class="stat-value" id="statExpiring">0</div>
<div class="stat-label">‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ (30 ‡∏ß‡∏±‡∏ô)</div>
</div>
<div class="stat-card">
<div class="stat-value" id="statExpired">0</div>
<div class="stat-label">‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß</div>
</div>
</div>
<div class="summary-cards" id="summaryCards"></div>
<div class="chart-container">
<h3>üìä ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÇ‡∏î‡∏¢‡∏£‡∏ß‡∏°</h3>
<canvas id="statusChart"></canvas>
<div class="legend">
<div class="legend-item">
<div class="legend-box valid"></div>
<span>‡∏õ‡∏Å‡∏ï‡∏¥</span>
</div>
<div class="legend-item">
<div class="legend-box expiring"></div>
<span>‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</span>
</div>
<div class="legend-item">
<div class="legend-box expired"></div>
<span>‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</span>
</div>
<div class="legend-item">
<div class="legend-box na"></div>
<span>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span>
</div>
</div>
</div>
</div>

<div id="personnel" class="content hidden">
<input type="text" class="search-box" id="searchBox" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏£‡∏∑‡∏≠ National ID..." onkeyup="searchPersonnel()">
<button class="btn btn-primary" onclick="showAddModal()">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</button>
<button class="btn btn-info" onclick="importData()">üì• Import ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
<button class="btn btn-warning" onclick="exportData()">üì§ Export ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
<div class="personnel-grid" id="personnelGrid"></div>
</div>

<div id="reports" class="content hidden">
<div class="filter-section">
<h2>üéØ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h2>
<div class="filter-group">
<h3>üìå ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</h3>
<button class="select-all-btn" onclick="toggleAllPersonnel()">‚òëÔ∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å/‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
<div class="checkbox-grid" id="personnelCheckboxes"></div>
</div>
<div class="filter-group">
<h3>üìÑ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h3>
<button class="select-all-btn" onclick="toggleAllDocuments()">‚òëÔ∏è ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å/‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</button>
<div class="checkbox-grid">
<div class="checkbox-item">
<input type="checkbox" id="doc_passport" checked>
<label for="doc_passport">üìò Passport</label>
</div>
<div class="checkbox-item">
<input type="checkbox" id="doc_bosiet" checked>
<label for="doc_bosiet">üî∂ BOSIET/FOET</label>
</div>
<div class="checkbox-item">
<input type="checkbox" id="doc_wah" checked>
<label for="doc_wah">üèóÔ∏è WAH Certificate</label>
</div>
<div class="checkbox-item">
<input type="checkbox" id="doc_medical" checked>
<label for="doc_medical">üè• Medical</label>
</div>
<div class="checkbox-item">
<input type="checkbox" id="doc_nationalid" checked>
<label for="doc_nationalid">üÜî National ID</label>
</div>
</div>
</div>
<div class="filter-group">
<h3>üé® ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</h3>
<select id="reportFormat" style="width:200px;padding:10px">
<option value="table">‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô</option>
<option value="detailed">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</option>
<option value="expiry">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</option>
<option value="compliance">Compliance Matrix</option>
</select>
</div>
<div class="filter-group">
<h3>üìÖ ‡∏Å‡∏£‡∏≠‡∏á‡∏ï‡∏≤‡∏°‡∏ß‡∏±‡∏ô‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</h3>
<div class="date-filter">
<label>‡πÅ‡∏™‡∏î‡∏á‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏µ‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡∏†‡∏≤‡∏¢‡πÉ‡∏ô:</label>
<select id="expiryFilter" style="width:150px">
<option value="all">‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
<option value="expired">‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß</option>
<option value="7">7 ‡∏ß‡∏±‡∏ô</option>
<option value="30">30 ‡∏ß‡∏±‡∏ô</option>
<option value="60">60 ‡∏ß‡∏±‡∏ô</option>
<option value="90">90 ‡∏ß‡∏±‡∏ô</option>
</select>
</div>
</div>
<button class="btn btn-success" onclick="generateCustomReport()">üìä ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
<button class="btn btn-primary" onclick="printReport()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
<button class="btn btn-info" onclick="downloadReport()">üíæ ‡∏î‡∏≤‡∏ß‡∏ô‡πå‡πÇ‡∏´‡∏•‡∏î CSV</button>
<button class="btn btn-warning" onclick="emailReport()">üìß ‡∏™‡πà‡∏á‡∏≠‡∏µ‡πÄ‡∏°‡∏•</button>
</div>
<div class="report-preview hidden" id="reportPreview"></div>
</div>

<div id="analysis" class="content hidden">
<h2>üìà ‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• SSHE</h2>
<div class="summary-cards">
<div class="summary-card">
<h4>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h4>
<div class="value" id="totalDocs">0</div>
</div>
<div class="summary-card" style="background:linear-gradient(135deg,#10b981,#059669)">
<h4>‡∏≠‡∏±‡∏ï‡∏£‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á</h4>
<div class="value" id="validRate">0%</div>
</div>
<div class="summary-card" style="background:linear-gradient(135deg,#f59e0b,#d97706)">
<h4>‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 30 ‡∏ß‡∏±‡∏ô</h4>
<div class="value" id="urgentCount">0</div>
</div>
<div class="summary-card" style="background:linear-gradient(135deg,#ef4444,#dc2626)">
<h4>‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</h4>
<div class="value" id="expiredCount">0</div>
</div>
</div>
<div id="analysisReport"></div>
</div>
</div>

<div id="addModal" class="modal">
<div class="modal-content">
<div class="modal-header">
<h2>‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£</h2>
<span class="close" onclick="closeModal('addModal')">&times;</span>
</div>
<form id="addForm" onsubmit="savePersonnel(event)">
<div class="form-group">
<label>‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
<input type="text" id="addName" required>
</div>
<div class="form-group">
<label>National ID *</label>
<input type="text" id="addNationalId" required>
</div>
<div class="form-group">
<label>National ID Issue Date</label>
<input type="text" id="addNationalIdIssue" placeholder="DD Mon YYYY">
</div>
<div class="form-group">
<label>National ID Expiry Date</label>
<input type="text" id="addNationalIdExpiry" placeholder="DD Mon YYYY">
</div>
<div class="form-group">
<label>Passport Number</label>
<input type="text" id="addPassport">
</div>
<div class="form-group">
<label>Passport Issue Date</label>
<input type="text" id="addPassportIssue" placeholder="DD Mon YYYY">
</div>
<div class="form-group">
<label>Passport Expiry Date</label>
<input type="text" id="addPassportExpiry" placeholder="DD Mon YYYY">
</div>
<div class="form-group">
<label>BOSIET/FOET Certificate No</label>
<input type="text" id="addBosiet">
</div>
<div class="form-group">
<label>BOSIET Issue Date</label>
<input type="text" id="addBosietIssue" placeholder="DD Mon YYYY">
</div>
<div class="form-group">
<label>BOSIET Expiry Date</label>
<input type="text" id="addBosietExpiry" placeholder="DD Mon YYYY">
</div>
<div class="form-group">
<label>WAH Certificate No</label>
<input type="text" id="addWah">
</div>
<div class="form-group">
<label>WAH Issue Date</label>
<input type="text" id="addWahIssue" placeholder="DD Mon YYYY">
</div>
<div class="form-group">
<label>WAH Expiry Date</label>
<input type="text" id="addWahExpiry" placeholder="DD Mon YYYY">
</div>
<div class="form-group">
<label>Medical Hospital</label>
<input type="text" id="addMedical">
</div>
<div class="form-group">
<label>Medical Exam Date</label>
<input type="text" id="addMedicalExam" placeholder="DD Mon YYYY">
</div>
<div class="form-group">
<label>Medical Expiry Date</label>
<input type="text" id="addMedicalExpiry" placeholder="DD Mon YYYY">
</div>
<button type="submit" class="btn btn-primary">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
</form>
</div>
</div>

<script>
let personnelData = {
"1 9098 02393 61 4": {
name: "Suttirak Nunsong",
national_id_issue: "05 Sep 2018",
national_id_expiry: "20 Oct 2028",
passport_no: "AC4335274",
passport_issue: "03 Jan 2023",
passport_expiry: "02 Jan 2028",
bosiet_no: "NONE",
bosiet_issue: "-",
bosiet_expiry: "-",
wah_no: "FR-2023-27854 SAFESIRI Operator",
wah_issue: "20 Oct 2023",
wah_expiry: "19 Oct 2025",
medical: "Vibhavadi Hospital PAD: Dr. Kanda Kumuang (52491)",
medical_exam: "25 Oct 2025",
medical_expiry: "25 Oct 2027"
},
"3 1005 03048 91 1": {
name: "Yuttapong Eakimphon",
national_id_issue: "14 Nov 2022",
national_id_expiry: "22 Apr 2031",
passport_no: "AC3883473",
passport_issue: "22 Aug 2022",
passport_expiry: "21 Aug 2027",
bosiet_no: "OPITO1C1vta103C MOG Industry FOET+EBS Learner: L01423124",
bosiet_issue: "09 Oct 2024",
bosiet_expiry: "16 Nov 2028",
wah_no: "202416701 Perfect Safety",
wah_issue: "05 Oct 2024",
wah_expiry: "05 Oct 2027",
medical: "Bangkok Hospital PAD: Dr. Piyapat Pandee (24901)",
medical_exam: "25 Oct 2025",
medical_expiry: "25 Oct 2027"
},
"5 1005 00047 64 2": {
name: "Suriyapong Yoo-om-sin",
national_id_issue: "14 Apr 2022",
national_id_expiry: "14 Apr 2027",
passport_no: "AC3883510",
passport_issue: "22 Aug 2022",
passport_expiry: "21 Aug 2027",
bosiet_no: "NONE",
bosiet_issue: "-",
bosiet_expiry: "-",
wah_no: "NONE",
wah_issue: "-",
wah_expiry: "-",
medical: "NONE",
medical_exam: "-",
medical_expiry: "-"
},
"3 7703 00480 42 1": {
name: "Sakda Wongiam",
national_id_issue: "14 Nov 2022",
national_id_expiry: "21 Jan 2032",
passport_no: "AC3887124",
passport_issue: "UNKNOWN",
passport_expiry: "UNKNOWN",
bosiet_no: "6374585811124733945 RelyOn Nutec FOET+EBS",
bosiet_issue: "11 Nov 2024",
bosiet_expiry: "16 Nov 2028",
wah_no: "FR-65-14837 SAFESIRI Tower Climber",
wah_issue: "25 Aug 2022",
wah_expiry: "24 Aug 2024",
medical: "NONE",
medical_exam: "-",
medical_expiry: "-"
},
"1 1195 01064 97 0": {
name: "Ratchaneekorn Mo-on",
national_id_issue: "12 Nov 2024",
national_id_expiry: "22 Jan 2030",
passport_no: "AC7243956",
passport_issue: "21 Jan 2025",
passport_expiry: "20 Jan 2030",
bosiet_no: "NONE",
bosiet_issue: "-",
bosiet_expiry: "-",
wah_no: "NONE",
wah_issue: "-",
wah_expiry: "-",
medical: "NONE",
medical_exam: "-",
medical_expiry: "-"
}
};

function saveToLocalStorage() {
localStorage.setItem('ssheAdvancedData', JSON.stringify(personnelData));
}

function loadFromLocalStorage() {
const saved = localStorage.getItem('ssheAdvancedData');
if (saved) personnelData = JSON.parse(saved);
}

function getDaysUntilExpiry(dateStr) {
if (!dateStr || dateStr === '-' || dateStr === 'NONE' || dateStr === 'UNKNOWN') return null;
const months = {Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};
const parts = dateStr.split(' ');
if (parts.length !== 3) return null;
const date = new Date(parts[2], months[parts[1]], parseInt(parts[0]));
const today = new Date();
return Math.floor((date - today) / (1000 * 60 * 60 * 24));
}

function getCertStatus(dateStr) {
const days = getDaysUntilExpiry(dateStr);
if (days === null) return 'na';
if (days < 0) return 'expired';
if (days <= 30) return 'expiring';
return 'valid';
}

function showTab(tabName) {
document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
document.querySelectorAll('.content').forEach(content => content.classList.add('hidden'));
event.target.classList.add('active');
document.getElementById(tabName).classList.remove('hidden');
if (tabName === 'reports') {
renderPersonnelCheckboxes();
} else if (tabName === 'analysis') {
generateAnalysis();
} else if (tabName === 'dashboard') {
updateDashboard();
} else if (tabName === 'personnel') {
renderPersonnel();
}
}

function renderPersonnelCheckboxes() {
const container = document.getElementById('personnelCheckboxes');
container.innerHTML = '';
Object.entries(personnelData).forEach(([id, person]) => {
const div = document.createElement('div');
div.className = 'checkbox-item';
div.innerHTML = `
<input type="checkbox" id="person_${id.replace(/\s/g, '_')}" value="${id}" checked>
<label for="person_${id.replace(/\s/g, '_')}">${person.name}</label>
`;
container.appendChild(div);
});
}

function toggleAllPersonnel() {
const checkboxes = document.querySelectorAll('#personnelCheckboxes input[type="checkbox"]');
const allChecked = Array.from(checkboxes).every(cb => cb.checked);
checkboxes.forEach(cb => cb.checked = !allChecked);
}

function toggleAllDocuments() {
const checkboxes = document.querySelectorAll('[id^="doc_"]');
const allChecked = Array.from(checkboxes).every(cb => cb.checked);
checkboxes.forEach(cb => cb.checked = !allChecked);
}

function generateCustomReport() {
const selectedPersonnel = [];
document.querySelectorAll('#personnelCheckboxes input[type="checkbox"]:checked').forEach(cb => {
selectedPersonnel.push(cb.value);
});

const selectedDocs = {
passport: document.getElementById('doc_passport').checked,
bosiet: document.getElementById('doc_bosiet').checked,
wah: document.getElementById('doc_wah').checked,
medical: document.getElementById('doc_medical').checked,
nationalid: document.getElementById('doc_nationalid').checked
};

const format = document.getElementById('reportFormat').value;
const expiryFilter = document.getElementById('expiryFilter').value;

let report = '';
switch(format) {
case 'table':
report = generateTableReport(selectedPersonnel, selectedDocs, expiryFilter);
break;
case 'detailed':
report = generateDetailedReport(selectedPersonnel, selectedDocs, expiryFilter);
break;
case 'expiry':
report = generateExpiryReport(selectedPersonnel, selectedDocs, expiryFilter);
break;
case 'compliance':
report = generateComplianceReport(selectedPersonnel, selectedDocs, expiryFilter);
break;
}

document.getElementById('reportPreview').innerHTML = report;
document.getElementById('reportPreview').classList.remove('hidden');
}

function generateTableReport(personnel, docs, filter) {
let html = '<h3>üìä SSHE Personnel Report</h3>';
html += `<p>Generated: ${new Date().toLocaleString('th-TH')}</p>`;
html += '<table class="report-table">';
html += '<thead><tr><th>Name</th><th>National ID</th>';

if (docs.nationalid) html += '<th>ID Expiry</th>';
if (docs.passport) html += '<th>Passport</th><th>Passport Exp</th>';
if (docs.bosiet) html += '<th>BOSIET/FOET</th><th>BOSIET Exp</th>';
if (docs.wah) html += '<th>WAH</th><th>WAH Exp</th>';
if (docs.medical) html += '<th>Medical</th><th>Medical Exp</th>';
html += '</tr></thead><tbody>';

personnel.forEach(id => {
const person = personnelData[id];
if (!shouldIncludeInReport(person, filter)) return;

html += `<tr>
<td>${person.name}</td>
<td>${id}</td>`;
if (docs.nationalid) html += `<td class="${getCertStatus(person.national_id_expiry)}">${person.national_id_expiry}</td>`;
if (docs.passport) {
html += `<td>${person.passport_no}</td>`;
html += `<td class="${getCertStatus(person.passport_expiry)}">${person.passport_expiry}</td>`;
}
if (docs.bosiet) {
html += `<td>${person.bosiet_no}</td>`;
html += `<td class="${getCertStatus(person.bosiet_expiry)}">${person.bosiet_expiry}</td>`;
}
if (docs.wah) {
html += `<td>${person.wah_no}</td>`;
html += `<td class="${getCertStatus(person.wah_expiry)}">${person.wah_expiry}</td>`;
}
if (docs.medical) {
html += `<td>${person.medical}</td>`;
html += `<td class="${getCertStatus(person.medical_expiry)}">${person.medical_expiry}</td>`;
}
html += '</tr>';
});
html += '</tbody></table>';
return html;
}

function generateDetailedReport(personnel, docs, filter) {
let html = '<h3>üìã Detailed SSHE Report</h3>';
html += `<p>Generated: ${new Date().toLocaleString('th-TH')}</p>`;
html += '<div style="margin-top:20px">';

personnel.forEach(id => {
const person = personnelData[id];
if (!shouldIncludeInReport(person, filter)) return;

html += `<div style="margin-bottom:30px;padding:20px;background:#f9fafb;border-radius:8px">
<h4 style="color:#4f46e5;margin-bottom:15px">${person.name}</h4>
<p><strong>National ID:</strong> ${id}</p>`;

if (docs.nationalid) {
html += `<p><strong>ID Issue:</strong> ${person.national_id_issue} | <strong>Expiry:</strong> <span class="${getCertStatus(person.national_id_expiry)}">${person.national_id_expiry}</span></p>`;
}
if (docs.passport && person.passport_no !== 'NONE') {
html += `<p><strong>Passport:</strong> ${person.passport_no} | <strong>Issue:</strong> ${person.passport_issue} | <strong>Expiry:</strong> <span class="${getCertStatus(person.passport_expiry)}">${person.passport_expiry}</span></p>`;
}
if (docs.bosiet && person.bosiet_no !== 'NONE') {
html += `<p><strong>BOSIET:</strong> ${person.bosiet_no} | <strong>Issue:</strong> ${person.bosiet_issue} | <strong>Expiry:</strong> <span class="${getCertStatus(person.bosiet_expiry)}">${person.bosiet_expiry}</span></p>`;
}
if (docs.wah && person.wah_no !== 'NONE') {
html += `<p><strong>WAH:</strong> ${person.wah_no} | <strong>Issue:</strong> ${person.wah_issue} | <strong>Expiry:</strong> <span class="${getCertStatus(person.wah_expiry)}">${person.wah_expiry}</span></p>`;
}
if (docs.medical && person.medical !== 'NONE') {
html += `<p><strong>Medical:</strong> ${person.medical} | <strong>Exam:</strong> ${person.medical_exam} | <strong>Expiry:</strong> <span class="${getCertStatus(person.medical_expiry)}">${person.medical_expiry}</span></p>`;
}
html += '</div>';
});
html += '</div>';
return html;
}

function generateExpiryReport(personnel, docs, filter) {
let html = '<h3>‚è∞ Document Expiry Report</h3>';
html += `<p>Generated: ${new Date().toLocaleString('th-TH')}</p>`;


const expiryItems = [];
personnel.forEach(id => {
const person = personnelData[id];
if (docs.nationalid && person.national_id_expiry !== '-') {
const days = getDaysUntilExpiry(person.national_id_expiry);
if (days !== null && shouldIncludeByExpiry(days, filter)) {
expiryItems.push({name: person.name, doc: 'National ID', expiry: person.national_id_expiry, days});
}
}
if (docs.passport && person.passport_expiry !== '-' && person.passport_expiry !== 'UNKNOWN') {
const days = getDaysUntilExpiry(person.passport_expiry);
if (days !== null && shouldIncludeByExpiry(days, filter)) {
expiryItems.push({name: person.name, doc: 'Passport', expiry: person.passport_expiry, days});
}
}
if (docs.bosiet && person.bosiet_expiry !== '-') {
const days = getDaysUntilExpiry(person.bosiet_expiry);
if (days !== null && shouldIncludeByExpiry(days, filter)) {
expiryItems.push({name: person.name, doc: 'BOSIET', expiry: person.bosiet_expiry, days});
}
}
if (docs.wah && person.wah_expiry !== '-') {
const days = getDaysUntilExpiry(person.wah_expiry);
if (days !== null && shouldIncludeByExpiry(days, filter)) {
expiryItems.push({name: person.name, doc: 'WAH', expiry: person.wah_expiry, days});
}
}
if (docs.medical && person.medical_expiry !== '-') {
const days = getDaysUntilExpiry(person.medical_expiry);
if (days !== null && shouldIncludeByExpiry(days, filter)) {
expiryItems.push({name: person.name, doc: 'Medical', expiry: person.medical_expiry, days});
}
}
});

expiryItems.sort((a, b) => a.days - b.days);

html += '<table class="report-table">';
html += '<thead><tr><th>Name</th><th>Document</th><th>Expiry Date</th><th>Days Until Expiry</th><th>Status</th></tr></thead><tbody>';
expiryItems.forEach(item => {
const status = item.days < 0 ? 'expired' : item.days <= 30 ? 'expiring' : 'valid';
const statusText = item.days < 0 ? '‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÅ‡∏•‡πâ‡∏ß' : item.days <= 30 ? '‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏' : '‡∏õ‡∏Å‡∏ï‡∏¥';
html += `<tr>
<td>${item.name}</td>
<td>${item.doc}</td>
<td>${item.expiry}</td>
<td>${item.days < 0 ? `‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ${Math.abs(item.days)} ‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß` : `${item.days} ‡∏ß‡∏±‡∏ô`}</td>
<td class="${status}">${statusText}</td>
</tr>`;
});
html += '</tbody></table>';
return html;
}

function generateComplianceReport(personnel, docs, filter) {
let html = '<h3>‚úÖ Compliance Matrix Report</h3>';
html += `<p>Generated: ${new Date().toLocaleString('th-TH')}</p>`;
html += '<table class="report-table">';
html += '<thead><tr><th>Name</th>';
if (docs.nationalid) html += '<th>National ID</th>';
if (docs.passport) html += '<th>Passport</th>';
if (docs.bosiet) html += '<th>BOSIET</th>';
if (docs.wah) html += '<th>WAH</th>';
if (docs.medical) html += '<th>Medical</th>';
html += '<th>Overall Status</th></tr></thead><tbody>';

personnel.forEach(id => {
const person = personnelData[id];
if (!shouldIncludeInReport(person, filter)) return;

let overallStatus = 'valid';
const statuses = [];

if (docs.nationalid) statuses.push(getCertStatus(person.national_id_expiry));
if (docs.passport) statuses.push(getCertStatus(person.passport_expiry));
if (docs.bosiet) statuses.push(getCertStatus(person.bosiet_expiry));
if (docs.wah) statuses.push(getCertStatus(person.wah_expiry));
if (docs.medical) statuses.push(getCertStatus(person.medical_expiry));

if (statuses.includes('expired')) overallStatus = 'expired';
else if (statuses.includes('expiring')) overallStatus = 'expiring';

html += `<tr><td>${person.name}</td>`;
if (docs.nationalid) html += `<td class="${getCertStatus(person.national_id_expiry)}">‚úì</td>`;
if (docs.passport) html += `<td class="${getCertStatus(person.passport_expiry)}">‚úì</td>`;
if (docs.bosiet) html += `<td class="${getCertStatus(person.bosiet_expiry)}">‚úì</td>`;
if (docs.wah) html += `<td class="${getCertStatus(person.wah_expiry)}">‚úì</td>`;
if (docs.medical) html += `<td class="${getCertStatus(person.medical_expiry)}">‚úì</td>`;
html += `<td class="${overallStatus}">${overallStatus === 'expired' ? '‚ùå ‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£' : overallStatus === 'expiring' ? '‚ö†Ô∏è ‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏' : '‚úÖ ‡∏õ‡∏Å‡∏ï‡∏¥'}</td></tr>`;
});
html += '</tbody></table>';
return html;
}

function shouldIncludeInReport(person, filter) {
if (filter === 'all') return true;
const fields = ['national_id_expiry', 'passport_expiry', 'bosiet_expiry', 'wah_expiry', 'medical_expiry'];
for (let field of fields) {
const days = getDaysUntilExpiry(person[field]);
if (days !== null && shouldIncludeByExpiry(days, filter)) return true;
}
return false;
}

function shouldIncludeByExpiry(days, filter) {
if (filter === 'all') return true;
if (filter === 'expired') return days < 0;
const filterDays = parseInt(filter);
if (!isNaN(filterDays)) return days <= filterDays;
return true;
}

function renderPersonnel() {
const grid = document.getElementById('personnelGrid');
grid.innerHTML = '';
Object.entries(personnelData).forEach(([id, person]) => {
const card = document.createElement('div');
card.className = 'person-card';
card.innerHTML = `
<div class="person-header">
<div class="person-name">${person.name}</div>
<div class="person-id">ID: ${id}</div>
</div>
<div class="cert-list">
${person.passport_no !== 'NONE' ? `
<div class="cert-item">
<span>üìò Passport: ${person.passport_no}</span>
<span class="${getCertStatus(person.passport_expiry)}">${person.passport_expiry}</span>
</div>` : ''}
${person.bosiet_no !== 'NONE' ? `
<div class="cert-item">
<span>üî∂ BOSIET/FOET</span>
<span class="${getCertStatus(person.bosiet_expiry)}">${person.bosiet_expiry}</span>
</div>` : ''}
${person.wah_no !== 'NONE' ? `
<div class="cert-item">
<span>üèóÔ∏è WAH</span>
<span class="${getCertStatus(person.wah_expiry)}">${person.wah_expiry}</span>
</div>` : ''}
${person.medical !== 'NONE' ? `
<div class="cert-item">
<span>üè• Medical</span>
<span class="${getCertStatus(person.medical_expiry)}">${person.medical_expiry}</span>
</div>` : ''}
</div>
<div class="action-buttons">
<button class="btn btn-primary" onclick="editPerson('${id}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
<button class="btn btn-danger" onclick="deletePerson('${id}')">‡∏•‡∏ö</button>
</div>
`;
grid.appendChild(card);
});
}

function updateDashboard() {
updateStats();
updateSummaryCards();
}

function updateStats() {
let totalDocs = 0, valid = 0, expiring = 0, expired = 0;
Object.values(personnelData).forEach(person => {
['national_id_expiry', 'passport_expiry', 'bosiet_expiry', 'wah_expiry', 'medical_expiry'].forEach(field => {
if (person[field] && person[field] !== '-' && person[field] !== 'NONE') {
totalDocs++;
const status = getCertStatus(person[field]);
if (status === 'valid') valid++;
else if (status === 'expiring') expiring++;
else if (status === 'expired') expired++;
}
});
});
document.getElementById('statTotal').textContent = Object.keys(personnelData).length;
document.getElementById('statValid').textContent = valid;
document.getElementById('statExpiring').textContent = expiring;
document.getElementById('statExpired').textContent = expired;
}

function updateSummaryCards() {
const cards = document.getElementById('summaryCards');
const urgentList = [];
Object.entries(personnelData).forEach(([id, person]) => {
['passport_expiry', 'bosiet_expiry', 'wah_expiry', 'medical_expiry'].forEach(field => {
const days = getDaysUntilExpiry(person[field]);
if (days !== null && days <= 30) {
urgentList.push({name: person.name, doc: field.replace('_expiry', ''), days});
}
});
});

urgentList.sort((a, b) => a.days - b.days);
let html = '<h3>‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡πà‡∏ß‡∏ô</h3>';
html += '<div style="margin-top:15px">';
urgentList.slice(0, 5).forEach(item => {
const status = item.days < 0 ? 'expired' : 'expiring';
html += `<div style="padding:10px;margin:5px 0;background:#fff;border-left:4px solid ${status === 'expired' ? '#ef4444' : '#f59e0b'};border-radius:4px">
${item.name} - ${item.doc}: ${item.days < 0 ? `‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏ ${Math.abs(item.days)} ‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡πâ‡∏ß` : `‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${item.days} ‡∏ß‡∏±‡∏ô`}
</div>`;
});
if (urgentList.length > 5) {
html += `<p style="margin-top:10px;color:#6b7280">‡πÅ‡∏•‡∏∞‡∏≠‡∏µ‡∏Å ${urgentList.length - 5} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£...</p>`;
}
html += '</div>';
cards.innerHTML = html;
}

function generateAnalysis() {
let totalDocs = 0, valid = 0, expiring = 0, expired = 0;
const docTypes = {passport: 0, bosiet: 0, wah: 0, medical: 0, nationalid: 0};
const docStatus = {
passport: {valid: 0, expiring: 0, expired: 0, na: 0},
bosiet: {valid: 0, expiring: 0, expired: 0, na: 0},
wah: {valid: 0, expiring: 0, expired: 0, na: 0},
medical: {valid: 0, expiring: 0, expired: 0, na: 0},
nationalid: {valid: 0, expiring: 0, expired: 0, na: 0}
};

Object.values(personnelData).forEach(person => {
const checkDoc = (type, expiry) => {
if (person[expiry] && person[expiry] !== '-' && person[expiry] !== 'NONE') {
docTypes[type]++;
totalDocs++;
const status = getCertStatus(person[expiry]);
docStatus[type][status]++;
if (status === 'valid') valid++;
else if (status === 'expiring') expiring++;
else if (status === 'expired') expired++;
} else {
docStatus[type].na++;
}
};
checkDoc('nationalid', 'national_id_expiry');
checkDoc('passport', 'passport_expiry');
checkDoc('bosiet', 'bosiet_expiry');
checkDoc('wah', 'wah_expiry');
checkDoc('medical', 'medical_expiry');
});

const validRate = totalDocs > 0 ? Math.round(valid / totalDocs * 100) : 0;
document.getElementById('totalDocs').textContent = totalDocs;
document.getElementById('validRate').textContent = validRate + '%';
document.getElementById('urgentCount').textContent = expiring;
document.getElementById('expiredCount').textContent = expired;

let html = '<h3>üìä ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Å‡∏≤‡∏£‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå</h3>';
html += '<table class="report-table" style="margin-top:20px">';
html += '<thead><tr><th>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</th><th>‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</th><th>‡∏õ‡∏Å‡∏ï‡∏¥</th><th>‡πÉ‡∏Å‡∏•‡πâ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</th><th>‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏</th><th>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</th></tr></thead><tbody>';
Object.entries(docStatus).forEach(([type, stats]) => {
const total = docTypes[type];
html += `<tr>
<td>${type.toUpperCase()}</td>
<td>${total}</td>
<td class="valid">${stats.valid}</td>
<td class="expiring">${stats.expiring}</td>
<td class="expired">${stats.expired}</td>
<td class="na">${stats.na}</td>
</tr>`;
});
html += '</tbody></table>';
document.getElementById('analysisReport').innerHTML = html;
}

function searchPersonnel() {
const search = document.getElementById('searchBox').value.toLowerCase();
const cards = document.querySelectorAll('.person-card');
cards.forEach(card => {
const text = card.textContent.toLowerCase();
card.style.display = text.includes(search) ? 'block' : 'none';
});
}

function showAddModal() {
document.getElementById('addModal').style.display = 'block';
}

function closeModal(modalId) {
document.getElementById(modalId).style.display = 'none';
}

function savePersonnel(e) {
e.preventDefault();
const nationalId = document.getElementById('addNationalId').value;
personnelData[nationalId] = {
name: document.getElementById('addName').value,
national_id_issue: document.getElementById('addNationalIdIssue').value || '-',
national_id_expiry: document.getElementById('addNationalIdExpiry').value || '-',
passport_no: document.getElementById('addPassport').value || 'NONE',
passport_issue: document.getElementById('addPassportIssue').value || '-',
passport_expiry: document.getElementById('addPassportExpiry').value || '-',
bosiet_no: document.getElementById('addBosiet').value || 'NONE',
bosiet_issue: document.getElementById('addBosietIssue').value || '-',
bosiet_expiry: document.getElementById('addBosietExpiry').value || '-',
wah_no: document.getElementById('addWah').value || 'NONE',
wah_issue: document.getElementById('addWahIssue').value || '-',
wah_expiry: document.getElementById('addWahExpiry').value || '-',
medical: document.getElementById('addMedical').value || 'NONE',
medical_exam: document.getElementById('addMedicalExam').value || '-',
medical_expiry: document.getElementById('addMedicalExpiry').value || '-'
};
saveToLocalStorage();
renderPersonnel();
updateStats();
closeModal('addModal');
document.getElementById('addForm').reset();
alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢');
}

function editPerson(id) {
const person = personnelData[id];
document.getElementById('addNationalId').value = id;
document.getElementById('addName').value = person.name;
document.getElementById('addNationalIdIssue').value = person.national_id_issue !== '-' ? person.national_id_issue : '';
document.getElementById('addNationalIdExpiry').value = person.national_id_expiry !== '-' ? person.national_id_expiry : '';
document.getElementById('addPassport').value = person.passport_no !== 'NONE' ? person.passport_no : '';
document.getElementById('addPassportIssue').value = person.passport_issue !== '-' ? person.passport_issue : '';
document.getElementById('addPassportExpiry').value = person.passport_expiry !== '-' ? person.passport_expiry : '';
document.getElementById('addBosiet').value = person.bosiet_no !== 'NONE' ? person.bosiet_no : '';
document.getElementById('addBosietIssue').value = person.bosiet_issue !== '-' ? person.bosiet_issue : '';
document.getElementById('addBosietExpiry').value = person.bosiet_expiry !== '-' ? person.bosiet_expiry : '';
document.getElementById('addWah').value = person.wah_no !== 'NONE' ? person.wah_no : '';
document.getElementById('addWahIssue').value = person.wah_issue !== '-' ? person.wah_issue : '';
document.getElementById('addWahExpiry').value = person.wah_expiry !== '-' ? person.wah_expiry : '';
document.getElementById('addMedical').value = person.medical !== 'NONE' ? person.medical : '';
document.getElementById('addMedicalExam').value = person.medical_exam !== '-' ? person.medical_exam : '';
document.getElementById('addMedicalExpiry').value = person.medical_expiry !== '-' ? person.medical_expiry : '';
showAddModal();
}

function deletePerson(id) {
if (confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ${personnelData[id].name}?`)) {
delete personnelData[id];
saveToLocalStorage();
renderPersonnel();
updateStats();
}
}

function printReport() {
const content = document.getElementById('reportPreview').innerHTML;
const win = window.open('', '_blank');
win.document.write(`
<html>
<head>
<title>SSHE Report</title>
<style>
body {font-family:Arial;padding:20px}
table {width:100%;border-collapse:collapse}
th {background:#4f46e5;color:white;padding:10px}
td {border:1px solid #ddd;padding:8px}
.expired {background:#fee2e2;color:#991b1b}
.expiring {background:#fed7aa;color:#92400e}
.valid {background:#d1fae5;color:#065f46}
.na {background:#f3f4f6;color:#6b7280}
@media print {.no-print{display:none}}
</style>
</head>
<body>${content}</body>
</html>
`);
win.document.close();
win.print();
}

function downloadReport() {
const preview = document.getElementById('reportPreview');
if (!preview.innerHTML) {
alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô');
return;
}
const table = preview.querySelector('table');
if (!table) {
alert('‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•');
return;
}
let csv = [];
const rows = table.querySelectorAll('tr');
rows.forEach(row => {
const cols = row.querySelectorAll('td, th');
const csvRow = [];
cols.forEach(col => {
csvRow.push('"' + col.textContent.replace(/"/g, '""') + '"');
});
csv.push(csvRow.join(','));
});
const csvContent = '\ufeff' + csv.join('\n');
const blob = new Blob([csvContent], {type: 'text/csv;charset=utf-8;'});
const link = document.createElement('a');
link.href = URL.createObjectURL(blob);
link.download = `sshe_report_${new Date().toISOString().split('T')[0]}.csv`;
link.click();
}

function emailReport() {
const subject = 'SSHE Report ' + new Date().toLocaleDateString();
const body = 'Please find attached the SSHE report generated on ' + new Date().toLocaleString();
window.location.href = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
}

function exportData() {
const dataStr = JSON.stringify(personnelData, null, 2);
const blob = new Blob([dataStr], {type: 'application/json'});
const url = URL.createObjectURL(blob);
const a = document.createElement('a');
a.href = url;
a.download = `sshe_data_${new Date().toISOString().split('T')[0]}.json`;
a.click();
}

function importData() {
const input = document.createElement('input');
input.type = 'file';
input.accept = '.json';
input.onchange = e => {
const file = e.target.files[0];
const reader = new FileReader();
reader.onload = event => {
try {
const data = JSON.parse(event.target.result);
personnelData = data;
saveToLocalStorage();
renderPersonnel();
updateStats();
alert('‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
} catch (error) {
alert('‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á');
}
};
reader.readAsText(file);
};
input.click();
}

window.onclick = e => {
if (e.target.className === 'modal') e.target.style.display = 'none';
};

loadFromLocalStorage();
updateDashboard();
</script>
</body>
</html>
