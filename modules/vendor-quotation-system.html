<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Addvalue Vendor Quotation Management System</title>
    
    <!-- External Libraries from CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }
        
        /* Header Styles */
        .header {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            color: white;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .logo-section {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo {
            width: 50px;
            height: 50px;
            background: white;
            color: #1e3a8a;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 24px;
        }
        
        .company-name {
            font-size: 24px;
            font-weight: 600;
        }
        
        .header-stats {
            display: flex;
            gap: 30px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 24px;
            font-weight: bold;
        }
        
        .stat-label {
            font-size: 12px;
            opacity: 0.8;
        }
        
        /* Tab Navigation */
        .tab-navigation {
            background: white;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .tabs {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            overflow-x: auto;
            scrollbar-width: thin;
        }
        
        .tab {
            padding: 15px 20px;
            cursor: pointer;
            border: none;
            background: none;
            color: #666;
            font-size: 14px;
            font-weight: 500;
            white-space: nowrap;
            transition: all 0.3s;
            position: relative;
        }
        
        .tab:hover {
            background: #f5f5f5;
            color: #1e3a8a;
        }
        
        .tab.active {
            color: #1e3a8a;
            background: #e6f2ff;
        }
        
        .tab.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: #3b82f6;
        }
        
        .tab.import-tab {
            background: linear-gradient(135deg, #10b981 0%, #34d399 100%);
            color: white;
            font-weight: 600;
            animation: pulse 2s infinite;
        }
        
        .tab.import-tab:hover {
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
            color: white;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        /* Content Area */
        .content {
            max-width: 1400px;
            margin: 20px auto;
            padding: 0 20px;
        }
        
        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* Card Styles */
        .card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .card-header {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #1e3a8a;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        /* Dashboard Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .stat-card-value {
            font-size: 32px;
            font-weight: bold;
            color: #1e3a8a;
        }
        
        .stat-card-label {
            color: #666;
            margin-top: 5px;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: 500;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        /* Buttons */
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-success {
            background: #10b981;
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .btn-danger {
            background: #ef4444;
            color: white;
        }
        
        .btn-danger:hover {
            background: #dc2626;
        }
        
        .btn-secondary {
            background: #6b7280;
            color: white;
        }
        
        .btn-secondary:hover {
            background: #4b5563;
        }
        
        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e5e7eb;
        }
        
        th {
            background: #f9fafb;
            font-weight: 600;
            color: #374151;
        }
        
        tr:hover {
            background: #f9fafb;
        }
        
        /* Import Section */
        .import-area {
            border: 2px dashed #10b981;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: #f0fdf4;
            transition: all 0.3s;
        }
        
        .import-area.dragover {
            background: #dcfce7;
            border-color: #059669;
        }
        
        .import-icon {
            font-size: 48px;
            color: #10b981;
            margin-bottom: 20px;
        }
        
        /* Quick Start Guide */
        .quick-start {
            background: linear-gradient(135deg, #e0f2fe 0%, #bae6fd 100%);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .quick-start h3 {
            color: #0369a1;
            margin-bottom: 15px;
        }
        
        .quick-start ol {
            margin-left: 20px;
            color: #0c4a6e;
        }
        
        .quick-start li {
            margin-bottom: 10px;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 10px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 24px;
            font-weight: 600;
            color: #1e3a8a;
        }
        
        .close-btn {
            font-size: 24px;
            cursor: pointer;
            color: #666;
        }
        
        .close-btn:hover {
            color: #333;
        }
        
        /* Loading Spinner */
        .spinner {
            border: 4px solid #f3f4f6;
            border-top: 4px solid #3b82f6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Alert Messages */
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }
        
        .alert-warning {
            background: #fed7aa;
            color: #92400e;
            border: 1px solid #fdba74;
        }
        
        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }
        
        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border: 1px solid #93c5fd;
        }
        
        /* Price Comparison */
        .comparison-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .vendor-comparison {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .vendor-comparison.best-price {
            border: 2px solid #10b981;
            background: #f0fdf4;
        }
        
        .best-price-badge {
            background: #10b981;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            display: inline-block;
            margin-bottom: 10px;
        }
        
        /* Extracted Data Display */
        .extracted-data {
            background: #f9fafb;
            border-radius: 5px;
            padding: 15px;
            margin-top: 20px;
        }
        
        .extracted-item {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 5px;
            padding: 10px;
            margin-bottom: 10px;
        }
        
        .extracted-item-header {
            display: flex;
            justify-content: space-between;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .extracted-item-details {
            color: #666;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-content">
            <div class="logo-section">
                <div class="logo">AV</div>
                <div class="company-name">Addvalue Innovation Co., Ltd.</div>
            </div>
            <div class="header-stats">
                <div class="stat">
                    <div class="stat-value" id="totalVendors">0</div>
                    <div class="stat-label">Total Vendors</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="activeQuotes">0</div>
                    <div class="stat-label">Active Quotes</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="monthlyVolume">$0</div>
                    <div class="stat-label">Monthly Volume</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="tab-navigation">
        <div class="tabs">
            <button class="tab active" data-tab="dashboard">üìä Dashboard</button>
            <button class="tab" data-tab="vendors">üë• Vendors</button>
            <button class="tab" data-tab="vendor-quotes">üìã Vendor Quotes</button>
            <button class="tab" data-tab="new-quote">‚ûï New Quote Entry</button>
            <button class="tab" data-tab="customer-quotes">üíº Customer Quotes</button>
            <button class="tab import-tab" data-tab="import">üì• Import PDF/Excel</button>
            <button class="tab" data-tab="analyze">üîç Analyze Proposal</button>
            <button class="tab" data-tab="comparison">‚öñÔ∏è Price Comparison</button>
            <button class="tab" data-tab="database">üíæ Database</button>
            <button class="tab" data-tab="reports">üìà Reports</button>
        </div>
    </div>

    <!-- Content Area -->
    <div class="content">
        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
            <div class="quick-start">
                <h3>üöÄ Quick Start Guide - Import Your Files</h3>
                <ol>
                    <li>Click the <strong style="color: #10b981;">Import PDF/Excel</strong> tab (green button)</li>
                    <li>Upload vendor quotations in PDF or Excel format</li>
                    <li>System will automatically extract: vendor name, items, prices, delivery terms</li>
                    <li>Review extracted data and click "Import to Quote"</li>
                    <li>Add markup and generate customer quotation</li>
                </ol>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-value">12</div>
                    <div class="stat-card-label">Active Vendors</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-value">28</div>
                    <div class="stat-card-label">Quotes This Month</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-value">$425,000</div>
                    <div class="stat-card-label">Total Pipeline Value</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-value">18%</div>
                    <div class="stat-card-label">Average Markup</div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    Recent Vendor Quotes
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Quote #</th>
                            <th>Vendor</th>
                            <th>Date</th>
                            <th>Amount</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="recentQuotesTable">
                        <tr>
                            <td>VQ-2025-001</td>
                            <td>Ceragon Networks</td>
                            <td>2025-01-02</td>
                            <td>$125,000</td>
                            <td><span style="color: #10b981;">Active</span></td>
                        </tr>
                        <tr>
                            <td>VQ-2025-002</td>
                            <td>Huawei Technologies</td>
                            <td>2025-01-03</td>
                            <td>$98,500</td>
                            <td><span style="color: #10b981;">Active</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Vendors Tab -->
        <div class="tab-content" id="vendors">
            <div class="card">
                <div class="card-header">
                    Vendor Management
                    <button class="btn btn-primary" onclick="openAddVendorModal()">Add New Vendor</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Vendor ID</th>
                            <th>Company Name</th>
                            <th>Contact Person</th>
                            <th>Email</th>
                            <th>Phone</th>
                            <th>Rating</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="vendorsTable">
                        <!-- Vendors will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Vendor Quotes Tab -->
        <div class="tab-content" id="vendor-quotes">
            <div class="card">
                <div class="card-header">
                    Vendor Quotations
                    <button class="btn btn-primary" onclick="window.currentTab = 'new-quote'; switchTab('new-quote')">Add New Quote</button>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Quote Number</th>
                            <th>Vendor</th>
                            <th>Date</th>
                            <th>Valid Until</th>
                            <th>Total Amount</th>
                            <th>Currency</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="vendorQuotesTable">
                        <!-- Vendor quotes will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- New Quote Entry Tab -->
        <div class="tab-content" id="new-quote">
            <div class="card">
                <div class="card-header">
                    New Vendor Quote Entry
                </div>
                <form id="newQuoteForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Quote Number *</label>
                            <input type="text" id="quoteNumber" required value="VQ-2025-003">
                        </div>
                        <div class="form-group">
                            <label>Vendor *</label>
                            <select id="quoteVendor" required>
                                <option value="">Select Vendor</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Quote Date *</label>
                            <input type="date" id="quoteDate" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label>Valid Until *</label>
                            <input type="date" id="validUntil" required>
                        </div>
                        <div class="form-group">
                            <label>Currency *</label>
                            <select id="quoteCurrency" required>
                                <option value="USD">USD</option>
                                <option value="THB">THB</option>
                                <option value="SGD">SGD</option>
                                <option value="EUR">EUR</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Delivery Terms</label>
                            <select id="deliveryTerms">
                                <option value="EXW">EXW - Ex Works</option>
                                <option value="FOB">FOB - Free on Board</option>
                                <option value="CIF">CIF - Cost Insurance Freight</option>
                                <option value="DDP">DDP - Delivered Duty Paid</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Items</label>
                        <div id="quoteItems">
                            <div class="extracted-item">
                                <input type="text" placeholder="Part Number" style="width: 20%; margin-right: 10px;">
                                <input type="text" placeholder="Description" style="width: 40%; margin-right: 10px;">
                                <input type="number" placeholder="Qty" style="width: 10%; margin-right: 10px;">
                                <input type="number" placeholder="Unit Price" style="width: 15%; margin-right: 10px;">
                                <button type="button" class="btn btn-danger" onclick="removeItem(this)">Remove</button>
                            </div>
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="addQuoteItem()">Add Item</button>
                    </div>

                    <div class="form-group">
                        <label>Notes</label>
                        <textarea id="quoteNotes"></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary">Save Quote</button>
                </form>
            </div>
        </div>

        <!-- Customer Quotes Tab -->
        <div class="tab-content" id="customer-quotes">
            <div class="card">
                <div class="card-header">
                    Generate Customer Quotation
                </div>
                <form id="customerQuoteForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label>Base Vendor Quote *</label>
                            <select id="baseVendorQuote" required>
                                <option value="">Select Vendor Quote</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Customer Name *</label>
                            <input type="text" id="customerName" required placeholder="e.g., PTTEPI">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>Markup % *</label>
                            <input type="number" id="markupPercent" required value="18" min="0" max="100">
                        </div>
                        <div class="form-group">
                            <label>Output Currency</label>
                            <select id="outputCurrency">
                                <option value="USD">USD</option>
                                <option value="THB">THB</option>
                            </select>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">Pricing Calculation</div>
                        <div id="pricingCalculation">
                            <p>Base Cost: <span id="baseCost">$0</span></p>
                            <p>Markup Amount: <span id="markupAmount">$0</span></p>
                            <p>Final Price: <strong id="finalPrice">$0</strong></p>
                            <p>Margin: <span id="marginPercent">0%</span></p>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-success">Generate Customer Quote</button>
                </form>
            </div>

            <div class="card">
                <div class="card-header">Generated Customer Quotes</div>
                <table>
                    <thead>
                        <tr>
                            <th>Quote #</th>
                            <th>Customer</th>
                            <th>Base Vendor</th>
                            <th>Date</th>
                            <th>Total Amount</th>
                            <th>Markup %</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="customerQuotesTable">
                        <!-- Customer quotes will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Import PDF/Excel Tab -->
        <div class="tab-content" id="import">
            <div class="alert alert-info">
                <strong>üì• Smart Import Feature</strong> - Upload PDF or Excel files containing vendor quotations. The system will automatically extract vendor information, items, prices, and terms.
            </div>

            <div class="card">
                <div class="card-header">
                    Import Vendor Quotations from PDF/Excel
                </div>
                
                <div class="import-area" id="dropZone">
                    <div class="import-icon">üìÅ</div>
                    <h3>Drop PDF or Excel files here</h3>
                    <p>or click to browse</p>
                    <input type="file" id="fileInput" accept=".pdf,.xlsx,.xls" style="display: none;">
                    <button class="btn btn-success" onclick="document.getElementById('fileInput').click()">Select Files</button>
                </div>

                <div id="importProgress" style="display: none;">
                    <div class="spinner"></div>
                    <p style="text-align: center;">Processing file...</p>
                </div>

                <div id="extractedDataDisplay" style="display: none;">
                    <div class="alert alert-success" id="extractionResult"></div>
                    
                    <div class="card">
                        <div class="card-header">
                            Extracted Information
                            <button class="btn btn-primary" onclick="importExtractedData()">Import to Quote</button>
                        </div>
                        <div id="extractedContent"></div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">File Preparation Guidelines</div>
                <div style="padding: 10px;">
                    <h4>For PDF Files:</h4>
                    <ul style="margin-left: 20px; margin-bottom: 20px;">
                        <li>Ensure text is selectable (not scanned images)</li>
                        <li>Include vendor name and quote number clearly</li>
                        <li>Items should have: Part Number, Description, Quantity, Price</li>
                        <li>Delivery terms should be clearly stated (EXW, FOB, CIF, DDP)</li>
                    </ul>
                    
                    <h4>For Excel Files:</h4>
                    <ul style="margin-left: 20px;">
                        <li>Use clear column headers: Part No, Description, Qty, Unit Price, Total</li>
                        <li>Include vendor name in the file or sheet name</li>
                        <li>Quote number and date should be visible</li>
                        <li>Avoid merged cells for data rows</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Analyze Proposal Tab -->
        <div class="tab-content" id="analyze">
            <div class="card">
                <div class="card-header">Proposal Analysis</div>
                
                <div class="form-group">
                    <label>Select Quote to Analyze</label>
                    <select id="analyzeQuoteSelect">
                        <option value="">Select a quote...</option>
                    </select>
                </div>

                <div id="analysisResults" style="display: none;">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-card-value" id="totalItems">0</div>
                            <div class="stat-card-label">Total Items</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-value" id="avgLeadTime">0</div>
                            <div class="stat-card-label">Avg. Lead Time (days)</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-value" id="complianceScore">0%</div>
                            <div class="stat-card-label">Compliance Score</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-value" id="riskLevel">Low</div>
                            <div class="stat-card-label">Risk Level</div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">Compliance Standards Detected</div>
                        <div id="complianceList">
                            <!-- Compliance standards will be listed here -->
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Price Comparison Tab -->
        <div class="tab-content" id="comparison">
            <div class="card">
                <div class="card-header">Multi-Vendor Price Comparison</div>
                
                <div class="form-group">
                    <label>Select Product/Service Category</label>
                    <select id="comparisonCategory">
                        <option value="">All Categories</option>
                        <option value="microwave">Microwave Equipment</option>
                        <option value="installation">Installation Services</option>
                        <option value="maintenance">Maintenance Services</option>
                    </select>
                </div>

                <div class="comparison-grid" id="comparisonGrid">
                    <!-- Comparison cards will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Database Tab -->
        <div class="tab-content" id="database">
            <div class="card">
                <div class="card-header">Database Management</div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-value" id="dbVendors">0</div>
                        <div class="stat-card-label">Vendors in Database</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="dbQuotes">0</div>
                        <div class="stat-card-label">Quotes in Database</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="dbSize">0 KB</div>
                        <div class="stat-card-label">Database Size</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-value" id="lastBackup">Never</div>
                        <div class="stat-card-label">Last Backup</div>
                    </div>
                </div>

                <div class="form-row">
                    <button class="btn btn-primary" onclick="exportDatabase()">üì• Export Database</button>
                    <button class="btn btn-success" onclick="document.getElementById('importDb').click()">üì§ Import Database</button>
                    <input type="file" id="importDb" accept=".json" style="display: none;" onchange="importDatabase(event)">
                    <button class="btn btn-secondary" onclick="optimizeDatabase()">üîß Optimize Database</button>
                    <button class="btn btn-danger" onclick="clearDatabase()">üóëÔ∏è Clear All Data</button>
                </div>
            </div>
        </div>

        <!-- Reports Tab -->
        <div class="tab-content" id="reports">
            <div class="card">
                <div class="card-header">Generate Reports</div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Report Type</label>
                        <select id="reportType">
                            <option value="vendor-performance">Vendor Performance</option>
                            <option value="monthly-summary">Monthly Summary</option>
                            <option value="price-trends">Price Trends</option>
                            <option value="win-rate">Win Rate Analysis</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Date Range</label>
                        <input type="date" id="reportStartDate">
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <input type="date" id="reportEndDate">
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="generateReport()">Generate Report</button>

                <div id="reportOutput" style="margin-top: 20px;">
                    <!-- Report will be displayed here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Add Vendor Modal -->
    <div class="modal" id="addVendorModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Add New Vendor</div>
                <span class="close-btn" onclick="closeModal('addVendorModal')">&times;</span>
            </div>
            <form id="addVendorForm">
                <div class="form-group">
                    <label>Company Name *</label>
                    <input type="text" id="vendorName" required>
                </div>
                <div class="form-group">
                    <label>Contact Person</label>
                    <input type="text" id="vendorContact">
                </div>
                <div class="form-group">
                    <label>Email *</label>
                    <input type="email" id="vendorEmail" required>
                </div>
                <div class="form-group">
                    <label>Phone</label>
                    <input type="tel" id="vendorPhone">
                </div>
                <div class="form-group">
                    <label>Address</label>
                    <textarea id="vendorAddress"></textarea>
                </div>
                <div class="form-group">
                    <label>Rating (1-5)</label>
                    <input type="number" id="vendorRating" min="1" max="5" value="3">
                </div>
                <button type="submit" class="btn btn-primary">Add Vendor</button>
            </form>
        </div>
    </div>

    <script>
        // Configure PDF.js worker
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        // In-memory database (replacing localStorage for Claude.ai compatibility)
        const db = {
            vendors: [
                { id: 'V001', name: 'Ceragon Networks', contact: 'John Smith', email: 'john@ceragon.com', phone: '+1-234-567-8900', rating: 5 },
                { id: 'V002', name: 'Huawei Technologies', contact: 'Li Wei', email: 'liwei@huawei.com', phone: '+86-123-4567-8900', rating: 4 },
                { id: 'V003', name: 'Nokia Networks', contact: 'Mika Virtanen', email: 'mika@nokia.com', phone: '+358-123-456-789', rating: 4 }
            ],
            vendorQuotes: [
                {
                    id: 'VQ-2025-001',
                    vendorId: 'V001',
                    vendorName: 'Ceragon Networks',
                    date: '2025-01-02',
                    validUntil: '2025-02-02',
                    currency: 'USD',
                    totalAmount: 125000,
                    status: 'Active',
                    items: [
                        { partNo: 'FG-8000', description: 'Microwave Radio 80GHz', qty: 2, unitPrice: 45000 },
                        { partNo: 'ANT-2FT', description: '2ft Antenna', qty: 2, unitPrice: 17500 }
                    ]
                },
                {
                    id: 'VQ-2025-002',
                    vendorId: 'V002',
                    vendorName: 'Huawei Technologies',
                    date: '2025-01-03',
                    validUntil: '2025-02-03',
                    currency: 'USD',
                    totalAmount: 98500,
                    status: 'Active',
                    items: [
                        { partNo: 'RTN-980', description: 'Microwave System', qty: 2, unitPrice: 38000 },
                        { partNo: 'ODU-100', description: 'Outdoor Unit', qty: 2, unitPrice: 11250 }
                    ]
                }
            ],
            customerQuotes: [],
            extractedData: null
        };

        // Save/Load functions (using in-memory storage)
        function saveData() {
            // In Claude.ai, we can't use localStorage, so data is stored in memory only
            console.log('Data saved to memory');
        }

        function loadData() {
            // Data is already in memory
            console.log('Data loaded from memory');
        }

        // Tab switching
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.tab === tabName) {
                    tab.classList.add('active');
                }
            });

            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            const targetContent = document.getElementById(tabName);
            if (targetContent) {
                targetContent.classList.add('active');
            }

            // Load specific tab data
            if (tabName === 'vendors') {
                loadVendors();
            } else if (tabName === 'vendor-quotes') {
                loadVendorQuotes();
            } else if (tabName === 'new-quote') {
                loadVendorSelect();
            } else if (tabName === 'customer-quotes') {
                loadCustomerQuotes();
            } else if (tabName === 'database') {
                updateDatabaseStats();
            }
        }

        // Add event listeners to tabs
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                switchTab(tab.dataset.tab);
            });
        });

        // Load vendors
        function loadVendors() {
            const tbody = document.getElementById('vendorsTable');
            tbody.innerHTML = '';
            
            db.vendors.forEach(vendor => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${vendor.id}</td>
                    <td>${vendor.name}</td>
                    <td>${vendor.contact || '-'}</td>
                    <td>${vendor.email}</td>
                    <td>${vendor.phone || '-'}</td>
                    <td>${'‚≠ê'.repeat(vendor.rating)}</td>
                    <td>
                        <button class="btn btn-primary" onclick="editVendor('${vendor.id}')">Edit</button>
                        <button class="btn btn-danger" onclick="deleteVendor('${vendor.id}')">Delete</button>
                    </td>
                `;
            });
        }

        // Load vendor quotes
        function loadVendorQuotes() {
            const tbody = document.getElementById('vendorQuotesTable');
            tbody.innerHTML = '';
            
            db.vendorQuotes.forEach(quote => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${quote.id}</td>
                    <td>${quote.vendorName}</td>
                    <td>${quote.date}</td>
                    <td>${quote.validUntil}</td>
                    <td>${quote.currency} ${quote.totalAmount.toLocaleString()}</td>
                    <td>${quote.currency}</td>
                    <td><span style="color: #10b981;">${quote.status}</span></td>
                    <td>
                        <button class="btn btn-primary" onclick="viewQuoteDetails('${quote.id}')">View</button>
                        <button class="btn btn-success" onclick="createCustomerQuote('${quote.id}')">Create Customer Quote</button>
                    </td>
                `;
            });
        }

        // Load vendor select dropdown
        function loadVendorSelect() {
            const select = document.getElementById('quoteVendor');
            select.innerHTML = '<option value="">Select Vendor</option>';
            
            db.vendors.forEach(vendor => {
                const option = document.createElement('option');
                option.value = vendor.id;
                option.textContent = vendor.name;
                select.appendChild(option);
            });
        }

        // Load customer quotes
        function loadCustomerQuotes() {
            const tbody = document.getElementById('customerQuotesTable');
            tbody.innerHTML = '';
            
            // Load base vendor quotes for dropdown
            const baseSelect = document.getElementById('baseVendorQuote');
            baseSelect.innerHTML = '<option value="">Select Vendor Quote</option>';
            
            db.vendorQuotes.forEach(quote => {
                const option = document.createElement('option');
                option.value = quote.id;
                option.textContent = `${quote.id} - ${quote.vendorName} - ${quote.currency} ${quote.totalAmount.toLocaleString()}`;
                baseSelect.appendChild(option);
            });
            
            // Load customer quotes table
            db.customerQuotes.forEach(quote => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${quote.id}</td>
                    <td>${quote.customerName}</td>
                    <td>${quote.baseVendor}</td>
                    <td>${quote.date}</td>
                    <td>${quote.currency} ${quote.totalAmount.toLocaleString()}</td>
                    <td>${quote.markup}%</td>
                    <td>
                        <button class="btn btn-primary" onclick="viewCustomerQuote('${quote.id}')">View</button>
                        <button class="btn btn-success" onclick="exportQuote('${quote.id}')">Export PDF</button>
                    </td>
                `;
            });
        }

        // Add vendor modal functions
        function openAddVendorModal() {
            document.getElementById('addVendorModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // Add vendor form submission
        document.getElementById('addVendorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newVendor = {
                id: 'V' + String(db.vendors.length + 1).padStart(3, '0'),
                name: document.getElementById('vendorName').value,
                contact: document.getElementById('vendorContact').value,
                email: document.getElementById('vendorEmail').value,
                phone: document.getElementById('vendorPhone').value,
                address: document.getElementById('vendorAddress').value,
                rating: parseInt(document.getElementById('vendorRating').value)
            };
            
            db.vendors.push(newVendor);
            saveData();
            closeModal('addVendorModal');
            loadVendors();
            updateHeaderStats();
            
            // Clear form
            document.getElementById('addVendorForm').reset();
        });

        // Delete vendor
        function deleteVendor(vendorId) {
            if (confirm('Are you sure you want to delete this vendor?')) {
                db.vendors = db.vendors.filter(v => v.id !== vendorId);
                saveData();
                loadVendors();
                updateHeaderStats();
            }
        }

        // Add quote item
        function addQuoteItem() {
            const itemsDiv = document.getElementById('quoteItems');
            const newItem = document.createElement('div');
            newItem.className = 'extracted-item';
            newItem.innerHTML = `
                <input type="text" placeholder="Part Number" style="width: 20%; margin-right: 10px;">
                <input type="text" placeholder="Description" style="width: 40%; margin-right: 10px;">
                <input type="number" placeholder="Qty" style="width: 10%; margin-right: 10px;">
                <input type="number" placeholder="Unit Price" style="width: 15%; margin-right: 10px;">
                <button type="button" class="btn btn-danger" onclick="removeItem(this)">Remove</button>
            `;
            itemsDiv.appendChild(newItem);
        }

        // Remove quote item
        function removeItem(button) {
            button.parentElement.remove();
        }

        // New quote form submission
        document.getElementById('newQuoteForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const items = [];
            document.querySelectorAll('#quoteItems .extracted-item').forEach(item => {
                const inputs = item.querySelectorAll('input');
                if (inputs[0].value && inputs[1].value) {
                    items.push({
                        partNo: inputs[0].value,
                        description: inputs[1].value,
                        qty: parseInt(inputs[2].value) || 1,
                        unitPrice: parseFloat(inputs[3].value) || 0
                    });
                }
            });
            
            const totalAmount = items.reduce((sum, item) => sum + (item.qty * item.unitPrice), 0);
            
            const newQuote = {
                id: document.getElementById('quoteNumber').value,
                vendorId: document.getElementById('quoteVendor').value,
                vendorName: db.vendors.find(v => v.id === document.getElementById('quoteVendor').value)?.name || '',
                date: document.getElementById('quoteDate').value,
                validUntil: document.getElementById('validUntil').value,
                currency: document.getElementById('quoteCurrency').value,
                deliveryTerms: document.getElementById('deliveryTerms').value,
                totalAmount: totalAmount,
                status: 'Active',
                items: items,
                notes: document.getElementById('quoteNotes').value
            };
            
            db.vendorQuotes.push(newQuote);
            saveData();
            
            alert('Quote saved successfully!');
            document.getElementById('newQuoteForm').reset();
            switchTab('vendor-quotes');
        });

        // Customer quote form - calculate pricing
        document.getElementById('markupPercent').addEventListener('input', calculateCustomerPrice);
        document.getElementById('baseVendorQuote').addEventListener('change', calculateCustomerPrice);

        function calculateCustomerPrice() {
            const quoteId = document.getElementById('baseVendorQuote').value;
            const markup = parseFloat(document.getElementById('markupPercent').value) || 0;
            
            if (quoteId) {
                const quote = db.vendorQuotes.find(q => q.id === quoteId);
                if (quote) {
                    const baseCost = quote.totalAmount;
                    const markupAmount = baseCost * (markup / 100);
                    const finalPrice = baseCost + markupAmount;
                    const margin = (markupAmount / finalPrice) * 100;
                    
                    document.getElementById('baseCost').textContent = `${quote.currency} ${baseCost.toLocaleString()}`;
                    document.getElementById('markupAmount').textContent = `${quote.currency} ${markupAmount.toLocaleString()}`;
                    document.getElementById('finalPrice').textContent = `${quote.currency} ${finalPrice.toLocaleString()}`;
                    document.getElementById('marginPercent').textContent = `${margin.toFixed(2)}%`;
                }
            }
        }

        // Customer quote form submission
        document.getElementById('customerQuoteForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const baseQuoteId = document.getElementById('baseVendorQuote').value;
            const baseQuote = db.vendorQuotes.find(q => q.id === baseQuoteId);
            const markup = parseFloat(document.getElementById('markupPercent').value);
            
            if (baseQuote) {
                const finalAmount = baseQuote.totalAmount * (1 + markup / 100);
                
                const customerQuote = {
                    id: 'CQ-2025-' + String(db.customerQuotes.length + 1).padStart(3, '0'),
                    customerName: document.getElementById('customerName').value,
                    baseVendor: baseQuote.vendorName,
                    baseQuoteId: baseQuoteId,
                    date: new Date().toISOString().split('T')[0],
                    currency: document.getElementById('outputCurrency').value,
                    totalAmount: finalAmount,
                    markup: markup,
                    items: baseQuote.items.map(item => ({
                        ...item,
                        unitPrice: item.unitPrice * (1 + markup / 100)
                    }))
                };
                
                db.customerQuotes.push(customerQuote);
                saveData();
                
                alert('Customer quote generated successfully!');
                document.getElementById('customerQuoteForm').reset();
                loadCustomerQuotes();
            }
        });

        // File import functionality
        const dropZone = document.getElementById('dropZone');
        const fileInput = document.getElementById('fileInput');

        // Drag and drop
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        fileInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            if (files.length === 0) return;
            
            const file = files[0];
            const fileName = file.name.toLowerCase();
            
            document.getElementById('importProgress').style.display = 'block';
            document.getElementById('extractedDataDisplay').style.display = 'none';
            
            if (fileName.endsWith('.pdf')) {
                processPDFFile(file);
            } else if (fileName.endsWith('.xlsx') || fileName.endsWith('.xls')) {
                processExcelFile(file);
            } else {
                alert('Please upload a PDF or Excel file');
                document.getElementById('importProgress').style.display = 'none';
            }
        }

        // Process PDF file
        async function processPDFFile(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
                let fullText = '';
                
                for (let i = 1; i <= pdf.numPages; i++) {
                    const page = await pdf.getPage(i);
                    const textContent = await page.getTextContent();
                    const pageText = textContent.items.map(item => item.str).join(' ');
                    fullText += pageText + '\n';
                }
                
                parsePDFContent(fullText);
            } catch (error) {
                console.error('Error processing PDF:', error);
                alert('Error processing PDF file. Please ensure it contains selectable text.');
                document.getElementById('importProgress').style.display = 'none';
            }
        }

        // Parse PDF content
        function parsePDFContent(text) {
            const extractedData = {
                vendor: '',
                quoteNumber: '',
                date: '',
                items: [],
                deliveryTerms: '',
                compliance: [],
                totalAmount: 0
            };
            
            // Extract vendor name (common patterns)
            const vendorPatterns = [
                /(?:vendor|supplier|company)[\s:]+([A-Za-z\s&]+)/i,
                /from[\s:]+([A-Za-z\s&]+)/i,
                /(Ceragon|Huawei|Nokia|Ericsson|ZTE)[^,\n]*/i
            ];
            
            for (const pattern of vendorPatterns) {
                const match = text.match(pattern);
                if (match) {
                    extractedData.vendor = match[1].trim();
                    break;
                }
            }
            
            // Extract quote number
            const quotePattern = /(?:quote|quotation|proposal)[\s#:]+([A-Z0-9-]+)/i;
            const quoteMatch = text.match(quotePattern);
            if (quoteMatch) {
                extractedData.quoteNumber = quoteMatch[1];
            }
            
            // Extract date
            const datePattern = /(?:date|dated)[\s:]+([0-9]{1,2}[\/-][0-9]{1,2}[\/-][0-9]{2,4})/i;
            const dateMatch = text.match(datePattern);
            if (dateMatch) {
                extractedData.date = dateMatch[1];
            }
            
            // Extract items (simplified pattern)
            const itemPattern = /([A-Z0-9-]+)[\s]+(.+?)[\s]+(\d+)[\s]+[\$]?([0-9,]+\.?\d*)/g;
            let itemMatch;
            while ((itemMatch = itemPattern.exec(text)) !== null) {
                extractedData.items.push({
                    partNo: itemMatch[1],
                    description: itemMatch[2].trim(),
                    qty: parseInt(itemMatch[3]),
                    unitPrice: parseFloat(itemMatch[4].replace(/,/g, ''))
                });
            }
            
            // Extract delivery terms
            const deliveryPattern = /(EXW|FOB|CIF|DDP|DAP|FCA)/i;
            const deliveryMatch = text.match(deliveryPattern);
            if (deliveryMatch) {
                extractedData.deliveryTerms = deliveryMatch[1].toUpperCase();
            }
            
            // Extract compliance standards
            const compliancePattern = /(ISO[\s-]?\d+|CE|ATEX|UL|FCC|RoHS)/gi;
            const complianceMatches = text.match(compliancePattern);
            if (complianceMatches) {
                extractedData.compliance = [...new Set(complianceMatches)];
            }
            
            // Calculate total
            extractedData.totalAmount = extractedData.items.reduce((sum, item) => 
                sum + (item.qty * item.unitPrice), 0);
            
            displayExtractedData(extractedData);
        }

        // Process Excel file
        async function processExcelFile(file) {
            try {
                const arrayBuffer = await file.arrayBuffer();
                const workbook = XLSX.read(arrayBuffer);
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const data = XLSX.utils.sheet_to_json(firstSheet, { header: 1 });
                
                parseExcelData(data, file.name);
            } catch (error) {
                console.error('Error processing Excel:', error);
                alert('Error processing Excel file');
                document.getElementById('importProgress').style.display = 'none';
            }
        }

        // Parse Excel data
        function parseExcelData(data, fileName) {
            const extractedData = {
                vendor: '',
                quoteNumber: 'IMPORT-' + Date.now(),
                date: new Date().toISOString().split('T')[0],
                items: [],
                deliveryTerms: 'EXW',
                compliance: [],
                totalAmount: 0
            };
            
            // Try to extract vendor from filename
            if (fileName.toLowerCase().includes('ceragon')) {
                extractedData.vendor = 'Ceragon Networks';
            } else if (fileName.toLowerCase().includes('huawei')) {
                extractedData.vendor = 'Huawei Technologies';
            } else if (fileName.toLowerCase().includes('nokia')) {
                extractedData.vendor = 'Nokia Networks';
            }
            
            // Find header row
            let headerRow = -1;
            const headerKeywords = ['part', 'description', 'qty', 'quantity', 'price', 'unit', 'total'];
            
            for (let i = 0; i < Math.min(10, data.length); i++) {
                const row = data[i];
                if (row && row.some(cell => 
                    headerKeywords.some(keyword => 
                        String(cell).toLowerCase().includes(keyword)))) {
                    headerRow = i;
                    break;
                }
            }
            
            if (headerRow === -1) headerRow = 0;
            
            // Extract items
            for (let i = headerRow + 1; i < data.length; i++) {
                const row = data[i];
                if (row && row.length > 2) {
                    const partNo = String(row[0] || '').trim();
                    const description = String(row[1] || '').trim();
                    const qty = parseInt(row[2]) || 1;
                    const price = parseFloat(String(row[3] || row[4] || '0').replace(/[^0-9.-]/g, ''));
                    
                    if (partNo && description && price > 0) {
                        extractedData.items.push({
                            partNo: partNo,
                            description: description,
                            qty: qty,
                            unitPrice: price
                        });
                    }
                }
            }
            
            // Calculate total
            extractedData.totalAmount = extractedData.items.reduce((sum, item) => 
                sum + (item.qty * item.unitPrice), 0);
            
            displayExtractedData(extractedData);
        }

        // Display extracted data
        function displayExtractedData(data) {
            document.getElementById('importProgress').style.display = 'none';
            document.getElementById('extractedDataDisplay').style.display = 'block';
            
            const resultDiv = document.getElementById('extractionResult');
            const contentDiv = document.getElementById('extractedContent');
            
            if (data.items.length > 0) {
                resultDiv.innerHTML = `
                    <strong>‚úÖ Successfully extracted ${data.items.length} items!</strong><br>
                    Vendor: ${data.vendor || 'Unknown'}<br>
                    Total Amount: $${data.totalAmount.toLocaleString()}
                `;
                
                let itemsHtml = '<div class="extracted-data">';
                itemsHtml += `
                    <p><strong>Vendor:</strong> ${data.vendor || 'Unknown'}</p>
                    <p><strong>Quote Number:</strong> ${data.quoteNumber}</p>
                    <p><strong>Date:</strong> ${data.date}</p>
                    <p><strong>Delivery Terms:</strong> ${data.deliveryTerms}</p>
                `;
                
                if (data.compliance.length > 0) {
                    itemsHtml += `<p><strong>Compliance:</strong> ${data.compliance.join(', ')}</p>`;
                }
                
                itemsHtml += '<h4>Items:</h4>';
                data.items.forEach((item, index) => {
                    itemsHtml += `
                        <div class="extracted-item">
                            <div class="extracted-item-header">
                                <span>${index + 1}. ${item.partNo}</span>
                                <span>$${(item.qty * item.unitPrice).toLocaleString()}</span>
                            </div>
                            <div class="extracted-item-details">
                                ${item.description} - Qty: ${item.qty} √ó $${item.unitPrice.toLocaleString()}
                            </div>
                        </div>
                    `;
                });
                itemsHtml += '</div>';
                
                contentDiv.innerHTML = itemsHtml;
                
                // Store extracted data
                db.extractedData = data;
            } else {
                resultDiv.className = 'alert alert-warning';
                resultDiv.innerHTML = `
                    <strong>‚ö†Ô∏è No items found in the file</strong><br>
                    Please ensure the file contains properly formatted item data.
                `;
                contentDiv.innerHTML = '';
            }
        }

        // Import extracted data to quote form
        function importExtractedData() {
            if (!db.extractedData) return;
            
            const data = db.extractedData;
            
            // Switch to new quote tab
            switchTab('new-quote');
            
            // Fill form fields
            document.getElementById('quoteNumber').value = data.quoteNumber || 'VQ-2025-' + String(db.vendorQuotes.length + 1).padStart(3, '0');
            document.getElementById('quoteDate').value = data.date || new Date().toISOString().split('T')[0];
            
            // Set valid until date (30 days from quote date)
            const validDate = new Date();
            validDate.setDate(validDate.getDate() + 30);
            document.getElementById('validUntil').value = validDate.toISOString().split('T')[0];
            
            document.getElementById('quoteCurrency').value = 'USD';
            document.getElementById('deliveryTerms').value = data.deliveryTerms || 'EXW';
            
            // Clear existing items
            document.getElementById('quoteItems').innerHTML = '';
            
            // Add extracted items
            data.items.forEach(item => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'extracted-item';
                itemDiv.innerHTML = `
                    <input type="text" placeholder="Part Number" style="width: 20%; margin-right: 10px;" value="${item.partNo}">
                    <input type="text" placeholder="Description" style="width: 40%; margin-right: 10px;" value="${item.description}">
                    <input type="number" placeholder="Qty" style="width: 10%; margin-right: 10px;" value="${item.qty}">
                    <input type="number" placeholder="Unit Price" style="width: 15%; margin-right: 10px;" value="${item.unitPrice}">
                    <button type="button" class="btn btn-danger" onclick="removeItem(this)">Remove</button>
                `;
                document.getElementById('quoteItems').appendChild(itemDiv);
            });
            
            if (data.compliance.length > 0) {
                document.getElementById('quoteNotes').value = 'Compliance: ' + data.compliance.join(', ');
            }
            
            alert('Data imported successfully! Please select a vendor and review the information before saving.');
        }

        // Database functions
        function updateDatabaseStats() {
            document.getElementById('dbVendors').textContent = db.vendors.length;
            document.getElementById('dbQuotes').textContent = db.vendorQuotes.length + db.customerQuotes.length;
            
            // Calculate approximate size
            const dbSize = JSON.stringify(db).length / 1024;
            document.getElementById('dbSize').textContent = dbSize.toFixed(2) + ' KB';
            
            const lastBackup = localStorage.getItem('lastBackup') || 'Never';
            document.getElementById('lastBackup').textContent = lastBackup;
        }

        function exportDatabase() {
            const dataStr = JSON.stringify(db, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `addvalue_db_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            // Note: In production, you would use localStorage
            // localStorage.setItem('lastBackup', new Date().toLocaleString());
            updateDatabaseStats();
        }

        function importDatabase(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedDb = JSON.parse(e.target.result);
                    Object.assign(db, importedDb);
                    saveData();
                    alert('Database imported successfully!');
                    location.reload();
                } catch (error) {
                    alert('Error importing database: Invalid file format');
                }
            };
            reader.readAsText(file);
        }

        function optimizeDatabase() {
            // Remove duplicates and clean data
            db.vendors = [...new Map(db.vendors.map(v => [v.id, v])).values()];
            db.vendorQuotes = [...new Map(db.vendorQuotes.map(q => [q.id, q])).values()];
            db.customerQuotes = [...new Map(db.customerQuotes.map(q => [q.id, q])).values()];
            
            saveData();
            alert('Database optimized successfully!');
            updateDatabaseStats();
        }

        function clearDatabase() {
            if (confirm('Are you sure you want to clear all data? This action cannot be undone.')) {
                db.vendors = [];
                db.vendorQuotes = [];
                db.customerQuotes = [];
                db.extractedData = null;
                saveData();
                alert('Database cleared!');
                location.reload();
            }
        }

        // Generate report
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const reportOutput = document.getElementById('reportOutput');
            
            let reportHtml = '<div class="card"><div class="card-header">Report Results</div>';
            
            if (reportType === 'vendor-performance') {
                reportHtml += '<h4>Vendor Performance Report</h4>';
                reportHtml += '<table><thead><tr><th>Vendor</th><th>Total Quotes</th><th>Total Value</th><th>Rating</th></tr></thead><tbody>';
                
                db.vendors.forEach(vendor => {
                    const vendorQuotes = db.vendorQuotes.filter(q => q.vendorId === vendor.id);
                    const totalValue = vendorQuotes.reduce((sum, q) => sum + q.totalAmount, 0);
                    reportHtml += `
                        <tr>
                            <td>${vendor.name}</td>
                            <td>${vendorQuotes.length}</td>
                            <td>$${totalValue.toLocaleString()}</td>
                            <td>${'‚≠ê'.repeat(vendor.rating)}</td>
                        </tr>
                    `;
                });
                
                reportHtml += '</tbody></table>';
            } else if (reportType === 'monthly-summary') {
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                const monthlyQuotes = db.vendorQuotes.filter(q => {
                    const qDate = new Date(q.date);
                    return qDate.getMonth() === currentMonth && qDate.getFullYear() === currentYear;
                });
                
                reportHtml += '<h4>Monthly Summary Report</h4>';
                reportHtml += `<p>Total Quotes: ${monthlyQuotes.length}</p>`;
                reportHtml += `<p>Total Value: $${monthlyQuotes.reduce((sum, q) => sum + q.totalAmount, 0).toLocaleString()}</p>`;
            }
            
            reportHtml += '</div>';
            reportOutput.innerHTML = reportHtml;
        }

        // Update header stats
        function updateHeaderStats() {
            document.getElementById('totalVendors').textContent = db.vendors.length;
            document.getElementById('activeQuotes').textContent = db.vendorQuotes.filter(q => q.status === 'Active').length;
            
            const monthlyTotal = db.vendorQuotes
                .filter(q => {
                    const qDate = new Date(q.date);
                    const now = new Date();
                    return qDate.getMonth() === now.getMonth() && qDate.getFullYear() === now.getFullYear();
                })
                .reduce((sum, q) => sum + q.totalAmount, 0);
            
            document.getElementById('monthlyVolume').textContent = '$' + monthlyTotal.toLocaleString();
        }

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            updateHeaderStats();
            
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('quoteDate').value = today;
            
            // Set valid until date (30 days from today)
            const validDate = new Date();
            validDate.setDate(validDate.getDate() + 30);
            document.getElementById('validUntil').value = validDate.toISOString().split('T')[0];
        });
    </script>
</body>
</html>