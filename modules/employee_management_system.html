<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Addvalue HR Management System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            color: #666;
            font-size: 1.1rem;
        }
        
        /* Navigation */
        .nav-section {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .breadcrumb {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            font-size: 0.9rem;
            color: #666;
        }
        
        .breadcrumb-item {
            cursor: pointer;
            color: #0078d4;
            text-decoration: none;
        }
        
        .breadcrumb-item:hover {
            text-decoration: underline;
        }
        
        .breadcrumb-separator {
            color: #999;
        }
        
        /* Main Program */
        .main-program {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }
        
        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 2rem;
            padding: 1rem;
            background: #f8f9fa;
            border-radius: 10px;
        }
        
        .search-filters {
            display: flex;
            gap: 1rem;
            flex: 1;
            max-width: 600px;
        }
        
        .action-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        /* Employee List */
        .employee-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .employee-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .employee-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }
        
        .employee-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .employee-name {
            font-size: 1.1rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.25rem;
        }
        
        .employee-position {
            font-size: 0.9rem;
            color: #666;
        }
        
        .employee-id {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 0.5rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .employee-info {
            margin-bottom: 1rem;
        }
        
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }
        
        .info-label {
            color: #666;
        }
        
        .info-value {
            font-weight: 500;
            color: #333;
        }
        
        .salary-highlight {
            color: #107c10;
            font-weight: 600;
        }
        
        /* Sub Program */
        .sub-program {
            display: none;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .sub-program.active {
            display: block;
        }
        
        .employee-details-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding: 1.5rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 12px;
        }
        
        .employee-details-info h2 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        .employee-details-info p {
            opacity: 0.9;
        }
        
        .sub-menu {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .sub-menu-btn {
            padding: 1rem 1.5rem;
            border: none;
            border-radius: 10px;
            background: #f8f9fa;
            color: #333;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }
        
        .sub-menu-btn:hover {
            background: #e9ecef;
        }
        
        .sub-menu-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-color: #667eea;
        }
        
        .sub-content {
            display: none;
            background: white;
            border-radius: 12px;
            padding: 2rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }
        
        .sub-content.active {
            display: block;
        }
        
        /* Form Styles */
        .form-input, .form-select {
            padding: 0.75rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.9rem;
            width: 100%;
            transition: border-color 0.3s ease;
        }
        
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #333;
            border: 1px solid #ddd;
        }
        
        .btn-secondary:hover {
            background: #e9ecef;
        }
        
        .btn-success {
            background: #107c10;
            color: white;
        }
        
        .btn-success:hover {
            background: #0e6e0e;
            transform: translateY(-2px);
        }
        
        .btn-warning {
            background: #ca5010;
            color: white;
        }
        
        .btn-warning:hover {
            background: #b04010;
        }
        
        .btn-danger {
            background: #d13438;
            color: white;
        }
        
        .btn-danger:hover {
            background: #b92b2b;
        }
        
        /* Department Badges */
        .dept-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        /* Personal Info Styles */
        .personal-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }
        
        .info-section {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
        }
        
        .info-section h3 {
            color: #333;
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }
        
        .info-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.75rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #e9ecef;
        }
        
        .info-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .info-item-label {
            color: #666;
            font-weight: 500;
        }
        
        .info-item-value {
            color: #333;
            font-weight: 500;
        }
        
        /* Salary History Styles */
        .salary-history-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .salary-change {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .salary-old {
            color: #d13438;
            text-decoration: line-through;
            font-size: 1.1rem;
        }
        
        .salary-new {
            color: #107c10;
            font-weight: 600;
            font-size: 1.2rem;
        }
        
        .salary-arrow {
            color: #666;
            font-size: 1.2rem;
        }
        
        .salary-date {
            color: #666;
            font-size: 0.9rem;
        }
        
        .salary-reason {
            color: #333;
            margin-top: 0.5rem;
            font-style: italic;
        }
        
        .salary-increase {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 0.5rem;
            border-radius: 5px;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        
        /* Notes Styles */
        .notes-list {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .note-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 1rem;
            margin-bottom: 1rem;
        }
        
        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .note-date {
            color: #666;
            font-size: 0.8rem;
        }
        
        .note-author {
            background: #667eea;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
        }
        
        .note-content {
            color: #333;
            line-height: 1.5;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }
        
        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal-content {
            background: white;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid #e9ecef;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 15px 15px 0 0;
        }
        
        .modal-title {
            font-size: 1.2rem;
            font-weight: 600;
        }
        
        .close-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.3);
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #333;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid #e9ecef;
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            background: #f8f9fa;
            border-radius: 0 0 15px 15px;
        }
        
        .hidden {
            display: none !important;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 1rem 1.5rem;
            border-radius: 10px;
            color: white;
            font-weight: 500;
            z-index: 1001;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .notification.success {
            background: linear-gradient(135deg, #107c10, #0e6e0e);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #d13438, #b92b2b);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 1rem;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-filters {
                max-width: none;
                flex-direction: column;
            }
            
            .employee-grid {
                grid-template-columns: 1fr;
            }
            
            .sub-menu {
                flex-direction: column;
            }
            
            .personal-info-grid {
                grid-template-columns: 1fr;
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Addvalue HR Management System</h1>
            <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ó‡∏£‡∏±‡∏û‡∏¢‡∏≤‡∏Å‡∏£‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•‡πÅ‡∏ö‡∏ö‡∏Ñ‡∏£‡∏ö‡∏ß‡∏á‡∏à‡∏£</p>
        </div>
        
        <!-- Navigation -->
        <div class="nav-section">
            <div class="breadcrumb" id="breadcrumb">
                <span class="breadcrumb-item" onclick="showMainProgram()">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span>
            </div>
        </div>
        
        <!-- Main Program -->
        <div class="main-program" id="mainProgram">
            <!-- Statistics -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="totalEmployees">8</div>
                    <div class="stat-label">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgSalary">49,750‡∏ø</div>
                    <div class="stat-label">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="avgDailyRate">1,658‡∏ø</div>
                    <div class="stat-label">‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏ß‡∏±‡∏ô</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="totalPayroll">398,000‡∏ø</div>
                    <div class="stat-label">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                </div>
            </div>
            
            <!-- Controls -->
            <div class="controls">
                <div class="search-filters">
                    <input type="text" class="form-input" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô..." 
                           oninput="searchEmployees(this.value)" id="searchInput">
                    <select class="form-select" onchange="filterByDepartment(this.value)" id="departmentFilter">
                        <option value="">‡∏ó‡∏∏‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å</option>
                        <option value="Management">‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</option>
                        <option value="Engineering">‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°</option>
                        <option value="Technical">‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ</option>
                        <option value="Sales & Marketing">‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î</option>
                        <option value="Accounting & Finance">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</option>
                        <option value="Administration">‡∏ò‡∏∏‡∏£‡∏Å‡∏≤‡∏£</option>
                    </select>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-success" onclick="exportToExcel()">
                        üìä Export Excel
                    </button>
                    <button class="btn btn-primary" onclick="openAddModal()">
                        ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô
                    </button>
                </div>
            </div>
            
            <!-- Employee List -->
            <div class="employee-grid" id="employeeGrid">
                <!-- Employee cards will be populated here -->
            </div>
        </div>
        
        <!-- Sub Program -->
        <div class="sub-program" id="subProgram">
            <!-- Employee Details Header -->
            <div class="employee-details-header" id="employeeDetailsHeader">
                <!-- Will be populated when employee is selected -->
            </div>
            
            <!-- Sub Menu -->
            <div class="sub-menu">
                <button class="sub-menu-btn active" onclick="showSubContent('personal')">
                    üë§ ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•
                </button>
                <button class="sub-menu-btn" onclick="showSubContent('salary')">
                    üí∞ ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
                </button>
                <button class="sub-menu-btn" onclick="showSubContent('history')">
                    üìà ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                </button>
                <button class="sub-menu-btn" onclick="showSubContent('notes')">
                    üìù ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
                </button>
            </div>
            
            <!-- Personal Information Content -->
            <div class="sub-content active" id="personalContent">
                <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•</h3>
                <div class="personal-info-grid" id="personalInfoGrid">
                    <!-- Personal info will be populated here -->
                </div>
                <div style="margin-top: 2rem; text-align: right;">
                    <button class="btn btn-warning" onclick="editSelectedEmployee()">
                        ‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                    </button>
                </div>
            </div>
            
            <!-- Salary Content -->
            <div class="sub-content" id="salaryContent">
                <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h3>
                <div id="salaryInfoGrid">
                    <!-- Salary info will be populated here -->
                </div>
            </div>
            
            <!-- Salary History Content -->
            <div class="sub-content" id="historyContent">
                <h3>‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h3>
                <div style="margin-bottom: 1rem;">
                    <button class="btn btn-primary" onclick="addSalaryHistory()">
                        ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô
                    </button>
                </div>
                <div id="salaryHistoryList">
                    <!-- Salary history will be populated here -->
                </div>
            </div>
            
            <!-- Notes Content -->
            <div class="sub-content" id="notesContent">
                <h3>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</h3>
                <div style="margin-bottom: 1rem; display: flex; gap: 1rem;">
                    <input type="text" class="form-input" id="newNote" placeholder="‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÉ‡∏´‡∏°‡πà..." style="flex: 1;">
                    <button class="btn btn-primary" onclick="addNote()">‡πÄ‡∏û‡∏¥‡πà‡∏°</button>
                </div>
                <div class="notes-list" id="notesList">
                    <!-- Notes will be populated here -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add/Edit Employee Modal -->
    <div class="modal" id="employeeModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà</h2>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="employeeForm">
                    <div class="form-group">
                        <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• *</label>
                        <input type="text" class="form-input" id="name" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Login *</label>
                            <input type="text" class="form-input" id="login" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Username</label>
                            <input type="text" class="form-input" id="emp_username">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏• *</label>
                        <input type="email" class="form-input" id="email" required>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå</label>
                            <input type="tel" class="form-input" id="phone">
                        </div>
                        <div class="form-group">
                            <label class="form-label">‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î</label>
                            <input type="date" class="form-input" id="dateOfBirth">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà</label>
                        <input type="text" class="form-input" id="address">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏á‡∏≤‡∏ô *</label>
                            <input type="text" class="form-input" id="jobPosition" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">‡πÅ‡∏ú‡∏ô‡∏Å *</label>
                            <select class="form-select" id="department" required>
                                <option value="">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÅ‡∏ú‡∏ô‡∏Å</option>
                                <option value="Management">‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£</option>
                                <option value="Engineering">‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°</option>
                                <option value="Technical">‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ</option>
                                <option value="Sales & Marketing">‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡∏ï‡∏•‡∏≤‡∏î</option>
                                <option value="Accounting & Finance">‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô</option>
                                <option value="Administration">‡∏ò‡∏∏‡∏£‡∏Å‡∏≤‡∏£</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô</label>
                            <input type="date" class="form-input" id="employmentDate">
                        </div>
                        <div class="form-group">
                            <label class="form-label">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á/‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå</label>
                            <input type="number" class="form-input" id="hoursPerWeek" value="48">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏ø) *</label>
                            <input type="number" class="form-input" id="salary" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</label>
                            <select class="form-select" id="type">
                                <option value="Internal">‡∏õ‡∏£‡∏∞‡∏à‡∏≥</option>
                                <option value="External">‡∏†‡∏≤‡∏¢‡∏ô‡∏≠‡∏Å</option>
                                <option value="Contract">‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏à‡πâ‡∏≤‡∏á</option>
                            </select>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="btn btn-success" onclick="saveEmployee()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>
    
    <!-- Add Salary History Modal -->
    <div class="modal" id="salaryHistoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h2>
                <button class="close-btn" onclick="closeSalaryHistoryModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="salaryHistoryForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ú‡∏• *</label>
                            <input type="date" class="form-input" id="salaryEffectiveDate" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏Å‡πà‡∏≤ (‡∏ø) *</label>
                            <input type="number" class="form-input" id="salaryOld" required>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà (‡∏ø) *</label>
                            <input type="number" class="form-input" id="salaryNew" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô *</label>
                            <input type="text" class="form-input" id="salaryReason" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡∏≤‡∏°‡∏ú‡∏•‡∏á‡∏≤‡∏ô, ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á" required>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeSalaryHistoryModal()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                <button class="btn btn-success" onclick="saveSalaryHistory()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
            </div>
        </div>
    </div>
    
    <script>
        // Real employee database from actual company data
        let employees = [
            {
                id: 1,
                name: "‡∏ì‡∏±‡∏ä‡∏ä‡∏≤ ‡∏¢‡∏≠‡∏î‡∏≠‡∏¥‡∏ô‡∏ó‡∏£‡πå (Natcha)",
                login: "Natcha",
                username: "addvalue-natcha",
                email: "addvalue-natcha@hotmail.com",
                phone: "0956653833",
                address: "111/270 ‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 5 ‡∏ï‡∏≥‡∏ö‡∏•‡∏Ñ‡∏•‡∏≠‡∏á‡∏™‡∏≤‡∏° ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°, 12000 ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°, Thailand",
                dateOfBirth: "1956-06-11",
                jobPosition: "‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà‡∏ò‡∏∏‡∏£‡∏Å‡∏≤‡∏£‡πÇ‡∏£‡∏á‡∏á‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏¥‡∏ô",
                department: "Administration",
                employmentDate: "2013-01-01",
                hoursPerWeek: 48,
                salary: 14000,
                type: "Internal",
                salaryHistory: [],
                notes: []
            },
            {
                id: 2,
                name: "Ratchaneekom Mo-on",
                login: "Ratchaneekom",
                username: "",
                email: "ratchaneekom@addvaluesystem.com",
                phone: "0953096914",
                address: "49/18 Moo 8 Soi Bearing48 Sukhumvit 107 Subdistrict Samrong Nuea District Muang, 10270 ‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£, Thailand",
                dateOfBirth: "2013-01-23",
                jobPosition: "Telecommunication Technician",
                department: "Engineering",
                employmentDate: "2024-04-11",
                hoursPerWeek: 48,
                salary: 24000,
                type: "Internal",
                salaryHistory: [],
                notes: []
            },
            {
                id: 3,
                name: "Sakda Wongjam",
                login: "Sakda",
                username: "addvalue_sakda",
                email: "sakda@addvaluesystem.com",
                phone: "0894446913",
                address: "59/1 m12, ‡∏ï‡∏≥‡∏ö‡∏•‡πÄ‡∏ä‡∏¥‡∏á‡πÉ‡∏ô, Thailand",
                dateOfBirth: "1978-01-22",
                jobPosition: "Chief Engineer",
                department: "Engineering",
                employmentDate: "2001-10-03",
                hoursPerWeek: 48,
                salary: 82000,
                type: "Internal",
                salaryHistory: [],
                notes: []
            },
            {
                id: 4,
                name: "Suriyapong Yoo-om-sin",
                login: "Suriyapong",
                username: "addvaluesystem-suriyapong",
                email: "suriyapong@addvaluesystem.com",
                phone: "025820114, +66061465616",
                address: "59/66 Moo 1 Ban Mai Sub District, Pak Kret District, Nonthaburi Province, 11120, Thailand",
                dateOfBirth: "2014-04-15",
                jobPosition: "Manager",
                department: "Management",
                employmentDate: "2000-10-03",
                hoursPerWeek: 48,
                salary: 120000,
                type: "Internal",
                salaryHistory: [],
                notes: []
            },
            {
                id: 5,
                name: "Aurnchalee Meena·∏≥",
                login: "Aurnchalee",
                username: "addvaluesystem-aurnchalee",
                email: "aurnchalee@addvaluesystem.com",
                phone: "0877194378",
                address: "Thailand",
                dateOfBirth: "1978-11-24",
                jobPosition: "Account Manager",
                department: "Sales & Marketing",
                employmentDate: "2000-10-03",
                hoursPerWeek: 48,
                salary: 50000,
                type: "Internal",
                salaryHistory: [],
                notes: []
            },
            {
                id: 6,
                name: "Suttirak Nunsong",
                login: "suttirak",
                username: "",
                email: "suttirak@addvaluesystem.com",
                phone: "0929286017",
                address: "619/21 ‡∏´‡∏°‡∏π‡πà‡∏ó‡∏µ‡πà 8 ‡∏ï‡∏≥‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏≤‡∏Ø ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏ò‡∏±‡∏ç‡∏ö‡∏∏‡∏£‡∏µ ‡∏à.‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ, 50000 Songkhla, Thailand",
                dateOfBirth: "1999-06-21",
                jobPosition: "Telecommunication Engineer",
                department: "Engineering",
                employmentDate: "2023-06-10",
                hoursPerWeek: 48,
                salary: 33000,
                type: "Internal",
                salaryHistory: [],
                notes: []
            },
            {
                id: 7,
                name: "Wasupol Amonthat",
                login: "wasupol",
                username: "",
                email: "wasupol@addvaluesystem.com",
                phone: "0944592666",
                address: "145/594 ‡∏ï‡∏≥‡∏ö‡∏•‡πÄ‡∏ó‡∏®‡∏ö‡∏≤‡∏•‡∏ô‡∏Ñ‡∏£‡∏•‡∏≥‡∏õ‡∏≤‡∏á 64 ‡πÅ‡∏Ç‡∏ß‡∏á‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á ‡πÄ‡∏Ç‡∏ï‡∏•‡∏≤‡∏î‡∏Å‡∏£‡∏∞‡∏ö‡∏±‡∏á ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û‡∏Ø, ‡∏Å‡∏£‡∏∏‡∏á‡πÄ‡∏ó‡∏û, Thailand",
                dateOfBirth: "1967-10-10",
                jobPosition: "Sales Manager",
                department: "Sales & Marketing",
                employmentDate: "2021-06-16",
                hoursPerWeek: 48,
                salary: 18000,
                type: "Internal",
                salaryHistory: [],
                notes: []
            },
            {
                id: 8,
                name: "Yuttapong Eakimphon",
                login: "Yuttapong",
                username: "addvalue-yuttapong",
                email: "yuttapong@addvaluesystem.com",
                phone: "0846998570",
                address: "7/203 ‡∏ï‡∏≥‡∏ö‡∏•‡∏ó‡πà‡∏≤‡∏£‡∏≤‡∏° 13 ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡∏ó‡πà‡∏≤‡∏£‡∏≤‡∏° ‡πÅ‡∏Ç‡∏ß‡∏á‡∏î‡∏¥‡∏ô‡πÅ‡∏î‡∏á, 10210 ‡∏≠‡∏£‡∏ô‡∏¥‡∏ß‡∏≤‡∏™, Thailand",
                dateOfBirth: "1980-04-23",
                jobPosition: "Chief Technical",
                department: "Technical",
                employmentDate: "2001-10-03",
                hoursPerWeek: 48,
                salary: 37000,
                type: "Internal",
                salaryHistory: [],
                notes: []
            }
        ];
        
        let filteredEmployees = employees;
        let selectedEmployee = null;
        let editingEmployeeId = null;
        let selectedDepartment = '';
        
        // Get department badge style
        function getDepartmentBadge(department) {
            const badges = {
                'Management': { bg: '#0078d4', color: 'white', text: '‡∏ú‡∏π‡πâ‡∏ö‡∏£‡∏¥‡∏´‡∏≤‡∏£' },
                'Engineering': { bg: '#107c10', color: 'white', text: '‡∏ß‡∏¥‡∏®‡∏ß‡∏Å‡∏£‡∏£‡∏°' },
                'Technical': { bg: '#ca5010', color: 'white', text: '‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ' },
                'Sales & Marketing': { bg: '#8764b8', color: 'white', text: '‡∏Ç‡∏≤‡∏¢‡πÅ‡∏•‡∏∞‡∏ï‡∏•‡∏≤‡∏î' },
                'Accounting & Finance': { bg: '#d83b01', color: 'white', text: '‡∏ö‡∏±‡∏ç‡∏ä‡∏µ‡πÅ‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πÄ‡∏á‡∏¥‡∏ô' },
                'Administration': { bg: '#d13438', color: 'white', text: '‡∏ò‡∏∏‡∏£‡∏Å‡∏≤‡∏£' }
            };
            
            const badge = badges[department] || { bg: '#f3f2f1', color: '#323130', text: department };
            return `<span class="dept-badge" style="background: ${badge.bg}; color: ${badge.color};">${badge.text}</span>`;
        }
        
        // Enhanced alphabetical sorting function
        function sortEmployeesAlphabetically(employeeList) {
            return employeeList.sort((a, b) => {
                // Extract name for sorting - prioritize English name in parentheses
                let nameA = a.name;
                let nameB = b.name;
                
                // If name contains parentheses, extract English name
                if (nameA.includes('(') && nameA.includes(')')) {
                    const match = nameA.match(/\(([^)]+)\)/);
                    if (match) nameA = match[1];
                }
                if (nameB.includes('(') && nameB.includes(')')) {
                    const match = nameB.match(/\(([^)]+)\)/);
                    if (match) nameB = match[1];
                }
                
                // Convert to lowercase and compare
                return nameA.toLowerCase().localeCompare(nameB.toLowerCase(), 'en', { 
                    sensitivity: 'base',
                    numeric: true,
                    ignorePunctuation: true
                });
            });
        }
        
        // Statistics calculations
        function updateStatistics() {
            const totalEmployees = employees.length;
            const totalSalary = employees.reduce((sum, emp) => sum + emp.salary, 0);
            const avgSalary = totalSalary / totalEmployees;
            const avgDailyRate = employees.reduce((sum, emp) => sum + (emp.salary / 30), 0) / totalEmployees;
            
            document.getElementById('totalEmployees').textContent = totalEmployees;
            document.getElementById('avgSalary').textContent = Math.round(avgSalary).toLocaleString() + '‡∏ø';
            document.getElementById('avgDailyRate').textContent = Math.round(avgDailyRate).toLocaleString() + '‡∏ø';
            document.getElementById('totalPayroll').textContent = totalSalary.toLocaleString() + '‡∏ø';
        }
        
        // Navigation with forced sorting
        function showMainProgram() {
            document.getElementById('mainProgram').style.display = 'block';
            document.getElementById('subProgram').classList.remove('active');
            document.getElementById('breadcrumb').innerHTML = '<span class="breadcrumb-item" onclick="showMainProgram()">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span>';
            selectedEmployee = null;
            
            // Force reset and sort
            filteredEmployees = sortEmployeesAlphabetically([...employees]);
            renderEmployees();
        }
        
        function showSubProgram(employee) {
            selectedEmployee = employee;
            document.getElementById('mainProgram').style.display = 'none';
            document.getElementById('subProgram').classList.add('active');
            
            // Update breadcrumb
            document.getElementById('breadcrumb').innerHTML = `
                <span class="breadcrumb-item" onclick="showMainProgram()">‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</span>
                <span class="breadcrumb-separator"> > </span>
                <span>${employee.name}</span>
            `;
            
            // Update employee details header
            const dailyRate = Math.round(employee.salary / 30);
            const hourlyRate = Math.round(employee.salary / (employee.hoursPerWeek * 4.33));
            
            document.getElementById('employeeDetailsHeader').innerHTML = `
                <div class="employee-details-info">
                    <h2>${employee.name}</h2>
                    <p>${employee.jobPosition} ‚Ä¢ ${getDepartmentBadge(employee.department)}</p>
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 1.5rem; font-weight: 600; margin-bottom: 0.25rem;">${employee.salary.toLocaleString()}‡∏ø</div>
                    <div style="opacity: 0.9;">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
                </div>
            `;
            
            // Load default content
            showSubContent('personal');
        }
        
        // Sub content management
        function showSubContent(contentType) {
            // Update menu buttons
            document.querySelectorAll('.sub-menu-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            // Hide all content
            document.querySelectorAll('.sub-content').forEach(content => content.classList.remove('active'));
            
            // Show selected content
            document.getElementById(contentType + 'Content').classList.add('active');
            
            // Load content based on type
            switch(contentType) {
                case 'personal':
                    loadPersonalInfo();
                    break;
                case 'salary':
                    loadSalaryInfo();
                    break;
                case 'history':
                    loadSalaryHistory();
                    break;
                case 'notes':
                    loadNotes();
                    break;
            }
        }
        
        // Load personal information
        function loadPersonalInfo() {
            if (!selectedEmployee) return;
            
            const container = document.getElementById('personalInfoGrid');
            container.innerHTML = `
                <div class="info-section">
                    <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h3>
                    <div class="info-item">
                        <span class="info-item-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</span>
                        <span class="info-item-value">${selectedEmployee.email}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-item-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå:</span>
                        <span class="info-item-value">${selectedEmployee.phone || '-'}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-item-label">‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà:</span>
                        <span class="info-item-value">${selectedEmployee.address || '-'}</span>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h3>
                    <div class="info-item">
                        <span class="info-item-label">‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î:</span>
                        <span class="info-item-value">${selectedEmployee.dateOfBirth || '-'}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-item-label">‡∏≠‡∏≤‡∏¢‡∏∏:</span>
                        <span class="info-item-value">${selectedEmployee.dateOfBirth ? calculateAge(selectedEmployee.dateOfBirth) + ' ‡∏õ‡∏µ' : '-'}</span>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏ó‡∏≥‡∏á‡∏≤‡∏ô</h3>
                    <div class="info-item">
                        <span class="info-item-label">Login:</span>
                        <span class="info-item-value">${selectedEmployee.login}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-item-label">Username:</span>
                        <span class="info-item-value">${selectedEmployee.username || '-'}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-item-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô:</span>
                        <span class="info-item-value">${selectedEmployee.employmentDate || '-'}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-item-label">‡∏≠‡∏≤‡∏¢‡∏∏‡∏á‡∏≤‡∏ô:</span>
                        <span class="info-item-value">${selectedEmployee.employmentDate ? calculateWorkExperience(selectedEmployee.employmentDate) : '-'}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-item-label">‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå:</span>
                        <span class="info-item-value">${selectedEmployee.hoursPerWeek} ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á</span>
                    </div>
                    <div class="info-item">
                        <span class="info-item-label">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô:</span>
                        <span class="info-item-value">${selectedEmployee.type}</span>
                    </div>
                </div>
            `;
        }
        
        // Load salary information
        function loadSalaryInfo() {
            if (!selectedEmployee) return;
            
            const dailyRate = Math.round(selectedEmployee.salary / 30);
            const hourlyRate = Math.round(selectedEmployee.salary / (selectedEmployee.hoursPerWeek * 4.33));
            const monthlyRate = selectedEmployee.salary;
            const yearlyRate = monthlyRate * 12;
            
            const container = document.getElementById('salaryInfoGrid');
            container.innerHTML = `
                <div class="info-section">
                    <h3>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</h3>
                    <div class="info-item">
                        <span class="info-item-label">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</span>
                        <span class="info-item-value salary-highlight">${monthlyRate.toLocaleString()}‡∏ø</span>
                    </div>
                    <div class="info-item">
                        <span class="info-item-label">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏õ‡∏µ:</span>
                        <span class="info-item-value">${yearlyRate.toLocaleString()}‡∏ø</span>
                    </div>
                    <div class="info-item">
                        <span class="info-item-label">‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á/‡∏ß‡∏±‡∏ô:</span>
                        <span class="info-item-value">${dailyRate.toLocaleString()}‡∏ø</span>
                    </div>
                    <div class="info-item">
                        <span class="info-item-label">‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á/‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á:</span>
                        <span class="info-item-value">${hourlyRate.toLocaleString()}‡∏ø</span>
                    </div>
                </div>
                
                <div class="info-section">
                    <h3>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö</h3>
                    <div class="info-item">
                        <span class="info-item-label">‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏Å‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢:</span>
                        <span class="info-item-value">${calculateSalaryComparison(selectedEmployee.salary)}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-item-label">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡πÉ‡∏ô‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó:</span>
                        <span class="info-item-value">${getSalaryRank(selectedEmployee.salary)} ‡∏à‡∏≤‡∏Å ${employees.length} ‡∏Ñ‡∏ô</span>
                    </div>
                </div>
            `;
        }
        
        // Load salary history
        function loadSalaryHistory() {
            if (!selectedEmployee) return;
            
            const container = document.getElementById('salaryHistoryList');
            const history = selectedEmployee.salaryHistory || [];
            
            if (history.length === 0) {
                container.innerHTML = '<div class="info-section"><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</p></div>';
                return;
            }
            
            const sortedHistory = history.sort((a, b) => new Date(b.effectiveDate) - new Date(a.effectiveDate));
            let html = '';
            
            sortedHistory.forEach(item => {
                const increase = item.newSalary - item.oldSalary;
                const increasePercent = ((increase / item.oldSalary) * 100).toFixed(1);
                
                html += `
                    <div class="salary-history-item">
                        <div class="salary-change">
                            <div>
                                <span class="salary-old">${item.oldSalary.toLocaleString()}‡∏ø</span>
                                <span class="salary-arrow"> ‚Üí </span>
                                <span class="salary-new">${item.newSalary.toLocaleString()}‡∏ø</span>
                            </div>
                            <span class="salary-date">${item.effectiveDate}</span>
                        </div>
                        <div class="salary-reason">${item.reason}</div>
                        <div class="salary-increase">
                            ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô: +${increase.toLocaleString()}‡∏ø (+${increasePercent}%)
                        </div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Load notes
        function loadNotes() {
            if (!selectedEmployee) return;
            
            const container = document.getElementById('notesList');
            const notes = selectedEmployee.notes || [];
            
            if (notes.length === 0) {
                container.innerHTML = '<div class="info-section"><p>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</p></div>';
                return;
            }
            
            const sortedNotes = notes.sort((a, b) => new Date(b.date) - new Date(a.date));
            let html = '';
            
            sortedNotes.forEach(note => {
                html += `
                    <div class="note-item">
                        <div class="note-header">
                            <span class="note-date">${note.date}</span>
                            <span class="note-author">${note.createdBy || 'Admin'}</span>
                        </div>
                        <div class="note-content">${note.content}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // Render employee list - always sorted alphabetically
        function renderEmployees() {
            // Always sort before rendering, no exceptions
            const sortedEmployees = sortEmployeesAlphabetically([...filteredEmployees]);
            const container = document.getElementById('employeeGrid');
            container.innerHTML = '';
            
            sortedEmployees.forEach((employee, index) => {
                const dailyRate = Math.round(employee.salary / 30);
                const sequenceNumber = index + 1; // Correct alphabetical sequence
                
                const card = document.createElement('div');
                card.className = 'employee-card';
                card.onclick = () => showSubProgram(employee);
                
                card.innerHTML = `
                    <div class="employee-header">
                        <div>
                            <div class="employee-name">${employee.name}</div>
                            <div class="employee-position">${employee.jobPosition}</div>
                        </div>
                        <div class="employee-id">#${sequenceNumber}</div>
                    </div>
                    
                    <div class="employee-info">
                        <div class="info-row">
                            <span class="info-label">‡πÅ‡∏ú‡∏ô‡∏Å:</span>
                            <span class="info-value">${getDepartmentBadge(employee.department)}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏•:</span>
                            <span class="info-value">${employee.email}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</span>
                            <span class="info-value salary-highlight">${employee.salary.toLocaleString()}‡∏ø</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á/‡∏ß‡∏±‡∏ô:</span>
                            <span class="info-value">${dailyRate.toLocaleString()}‡∏ø</span>
                        </div>
                    </div>
                `;
                
                container.appendChild(card);
            });
            
            // Debug: Show current order
            console.log('Rendered order:', sortedEmployees.map((emp, idx) => `#${idx + 1}: ${emp.name}`));
        }
        
        // Search and filter functionality with forced sorting
        function searchEmployees(query) {
            applyFilters(query, selectedDepartment);
        }
        
        function filterByDepartment(department) {
            selectedDepartment = department;
            const searchQuery = document.getElementById('searchInput').value;
            applyFilters(searchQuery, department);
        }
        
        function applyFilters(searchQuery, department) {
            let filtered = [...employees]; // Create a copy
            
            if (searchQuery && searchQuery.trim()) {
                const searchTerm = searchQuery.toLowerCase();
                filtered = filtered.filter(employee =>
                    employee.name.toLowerCase().includes(searchTerm) ||
                    employee.jobPosition.toLowerCase().includes(searchTerm) ||
                    employee.email.toLowerCase().includes(searchTerm) ||
                    employee.department.toLowerCase().includes(searchTerm)
                );
            }
            
            if (department) {
                filtered = filtered.filter(employee => employee.department === department);
            }
            
            // Force alphabetical sorting before setting filteredEmployees
            filteredEmployees = sortEmployeesAlphabetically(filtered);
            renderEmployees();
        }
        
        // Utility functions
        function calculateAge(birthDate) {
            const today = new Date();
            const birth = new Date(birthDate);
            let age = today.getFullYear() - birth.getFullYear();
            const m = today.getMonth() - birth.getMonth();
            if (m < 0 || (m === 0 && today.getDate() < birth.getDate())) {
                age--;
            }
            return age;
        }
        
        function calculateWorkExperience(startDate) {
            const today = new Date();
            const start = new Date(startDate);
            const years = today.getFullYear() - start.getFullYear();
            const months = today.getMonth() - start.getMonth();
            
            let totalMonths = years * 12 + months;
            if (today.getDate() < start.getDate()) {
                totalMonths--;
            }
            
            const expYears = Math.floor(totalMonths / 12);
            const expMonths = totalMonths % 12;
            
            if (expYears > 0 && expMonths > 0) {
                return `${expYears} ‡∏õ‡∏µ ${expMonths} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`;
            } else if (expYears > 0) {
                return `${expYears} ‡∏õ‡∏µ`;
            } else {
                return `${expMonths} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`;
            }
        }
        
        function calculateSalaryComparison(salary) {
            const avgSalary = employees.reduce((sum, emp) => sum + emp.salary, 0) / employees.length;
            const diff = salary - avgSalary;
            const percentage = ((diff / avgSalary) * 100).toFixed(1);
            
            if (diff > 0) {
                return `‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ ${Math.abs(diff).toLocaleString()}‡∏ø (+${percentage}%)`;
            } else if (diff < 0) {
                return `‡∏ï‡πà‡∏≥‡∏Å‡∏ß‡πà‡∏≤ ${Math.abs(diff).toLocaleString()}‡∏ø (${percentage}%)`;
            } else {
                return '‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢';
            }
        }
        
        function getSalaryRank(salary) {
            const sortedSalaries = employees.map(emp => emp.salary).sort((a, b) => b - a);
            return sortedSalaries.indexOf(salary) + 1;
        }
        
        // Modal management
        function openAddModal() {
            editingEmployeeId = null;
            document.getElementById('modalTitle').textContent = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà';
            document.getElementById('employeeForm').reset();
            document.getElementById('employeeModal').classList.add('active');
        }
        
        function editSelectedEmployee() {
            if (!selectedEmployee) return;
            
            editingEmployeeId = selectedEmployee.id;
            document.getElementById('modalTitle').textContent = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô';
            
            // Populate form fields
            document.getElementById('name').value = selectedEmployee.name;
            document.getElementById('login').value = selectedEmployee.login;
            document.getElementById('emp_username').value = selectedEmployee.username;
            document.getElementById('email').value = selectedEmployee.email;
            document.getElementById('phone').value = selectedEmployee.phone;
            document.getElementById('address').value = selectedEmployee.address;
            document.getElementById('dateOfBirth').value = selectedEmployee.dateOfBirth;
            document.getElementById('jobPosition').value = selectedEmployee.jobPosition;
            document.getElementById('department').value = selectedEmployee.department;
            document.getElementById('employmentDate').value = selectedEmployee.employmentDate;
            document.getElementById('hoursPerWeek').value = selectedEmployee.hoursPerWeek;
            document.getElementById('salary').value = selectedEmployee.salary;
            document.getElementById('type').value = selectedEmployee.type;
            
            document.getElementById('employeeModal').classList.add('active');
        }
        
        function closeModal() {
            document.getElementById('employeeModal').classList.remove('active');
            editingEmployeeId = null;
        }
        
        function saveEmployee() {
            const form = document.getElementById('employeeForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const employeeData = {
                name: document.getElementById('name').value,
                login: document.getElementById('login').value,
                username: document.getElementById('emp_username').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                address: document.getElementById('address').value,
                dateOfBirth: document.getElementById('dateOfBirth').value,
                jobPosition: document.getElementById('jobPosition').value,
                department: document.getElementById('department').value,
                employmentDate: document.getElementById('employmentDate').value,
                hoursPerWeek: parseInt(document.getElementById('hoursPerWeek').value),
                salary: parseInt(document.getElementById('salary').value),
                type: document.getElementById('type').value
            };
            
            if (editingEmployeeId) {
                // Update existing employee
                const index = employees.findIndex(e => e.id === editingEmployeeId);
                employees[index] = { 
                    ...employees[index], 
                    ...employeeData
                };
                
                // Update selected employee if it's the one being edited
                if (selectedEmployee && selectedEmployee.id === editingEmployeeId) {
                    selectedEmployee = employees[index];
                    loadPersonalInfo(); // Refresh the view
                }
                
                showNotification('‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
            } else {
                // Add new employee
                const newId = Math.max(...employees.map(e => e.id)) + 1;
                employees.push({ 
                    id: newId, 
                    ...employeeData,
                    salaryHistory: [],
                    notes: []
                });
                showNotification('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
            }
            
            selectedDepartment = '';
            document.getElementById('departmentFilter').value = '';
            document.getElementById('searchInput').value = '';
            filteredEmployees = employees;
            
            updateStatistics();
            renderEmployees();
            closeModal();
        }
        
        // Salary History Modal
        function addSalaryHistory() {
            if (!selectedEmployee) return;
            
            document.getElementById('salaryOld').value = selectedEmployee.salary;
            document.getElementById('salaryEffectiveDate').valueAsDate = new Date();
            document.getElementById('salaryHistoryModal').classList.add('active');
        }
        
        function closeSalaryHistoryModal() {
            document.getElementById('salaryHistoryModal').classList.remove('active');
            document.getElementById('salaryHistoryForm').reset();
        }
        
        function saveSalaryHistory() {
            const form = document.getElementById('salaryHistoryForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            const historyItem = {
                date: new Date().toISOString().split('T')[0],
                oldSalary: parseInt(document.getElementById('salaryOld').value),
                newSalary: parseInt(document.getElementById('salaryNew').value),
                reason: document.getElementById('salaryReason').value,
                effectiveDate: document.getElementById('salaryEffectiveDate').value
            };
            
            if (!selectedEmployee.salaryHistory) {
                selectedEmployee.salaryHistory = [];
            }
            
            selectedEmployee.salaryHistory.push(historyItem);
            selectedEmployee.salary = historyItem.newSalary;
            
            // Update in main array
            const index = employees.findIndex(e => e.id === selectedEmployee.id);
            employees[index] = selectedEmployee;
            
            loadSalaryHistory();
            loadSalaryInfo();
            updateStatistics();
            renderEmployees();
            closeSalaryHistoryModal();
            showNotification('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }
        
        // Notes management
        function addNote() {
            const noteText = document.getElementById('newNote').value.trim();
            if (!noteText || !selectedEmployee) return;
            
            const noteItem = {
                date: new Date().toISOString().split('T')[0],
                content: noteText,
                createdBy: 'Admin'
            };
            
            if (!selectedEmployee.notes) {
                selectedEmployee.notes = [];
            }
            
            selectedEmployee.notes.push(noteItem);
            
            // Update in main array
            const index = employees.findIndex(e => e.id === selectedEmployee.id);
            employees[index] = selectedEmployee;
            
            loadNotes();
            document.getElementById('newNote').value = '';
            showNotification('‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß', 'success');
        }
        
        // Export to Excel
        function exportToExcel() {
            try {
                const exportData = employees.map((emp, index) => ({
                    '‡∏•‡∏≥‡∏î‡∏±‡∏ö': index + 1,
                    '‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•': emp.name,
                    'Login': emp.login,
                    'Username': emp.username || '',
                    '‡∏≠‡∏µ‡πÄ‡∏°‡∏•': emp.email,
                    '‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå': emp.phone || '',
                    '‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î': emp.dateOfBirth || '',
                    '‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà': emp.address || '',
                    '‡πÅ‡∏ú‡∏ô‡∏Å': emp.department,
                    '‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á': emp.jobPosition,
                    '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô': emp.employmentDate || '',
                    '‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ï‡πà‡∏≠‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå': emp.hoursPerWeek,
                    '‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô': emp.salary,
                    '‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô': Math.round(emp.salary / 30),
                    '‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏£‡∏≤‡∏¢‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á': Math.round(emp.salary / (emp.hoursPerWeek * 4.33)),
                    '‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô': emp.type,
                    '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô': emp.salaryHistory ? emp.salaryHistory.length : 0,
                    '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏': emp.notes ? emp.notes.length : 0,
                    '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î': emp.notes && emp.notes.length > 0 ? emp.notes[emp.notes.length - 1].content : ''
                }));
                
                // Create salary history sheet
                const salaryHistoryData = [];
                employees.forEach(emp => {
                    if (emp.salaryHistory && emp.salaryHistory.length > 0) {
                        emp.salaryHistory.forEach(history => {
                            salaryHistoryData.push({
                                '‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô': emp.name,
                                '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ú‡∏•': history.effectiveDate,
                                '‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏Å‡πà‡∏≤': history.oldSalary,
                                '‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÉ‡∏´‡∏°‡πà': history.newSalary,
                                '‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á': history.newSalary - history.oldSalary,
                                '‡πÄ‡∏õ‡∏≠‡∏£‡πå‡πÄ‡∏ã‡πá‡∏ô‡∏ï‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏û‡∏¥‡πà‡∏°': ((history.newSalary - history.oldSalary) / history.oldSalary * 100).toFixed(2) + '%',
                                '‡πÄ‡∏´‡∏ï‡∏∏‡∏ú‡∏•': history.reason,
                                '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å': history.date
                            });
                        });
                    }
                });
                
                // Create notes sheet
                const notesData = [];
                employees.forEach(emp => {
                    if (emp.notes && emp.notes.length > 0) {
                        emp.notes.forEach(note => {
                            notesData.push({
                                '‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô': emp.name,
                                '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà': note.date,
                                '‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏': note.content,
                                '‡∏ú‡∏π‡πâ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å': note.createdBy || ''
                            });
                        });
                    }
                });
                
                const wb = XLSX.utils.book_new();
                
                // Main employee data sheet
                const ws1 = XLSX.utils.json_to_sheet(exportData);
                XLSX.utils.book_append_sheet(wb, ws1, "‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô");
                
                // Salary history sheet
                if (salaryHistoryData.length > 0) {
                    const ws2 = XLSX.utils.json_to_sheet(salaryHistoryData);
                    XLSX.utils.book_append_sheet(wb, ws2, "‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô");
                }
                
                // Notes sheet
                if (notesData.length > 0) {
                    const ws3 = XLSX.utils.json_to_sheet(notesData);
                    XLSX.utils.book_append_sheet(wb, ws3, "‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏");
                }
                
                // Generate summary sheet
                const totalSalary = employees.reduce((sum, emp) => sum + emp.salary, 0);
                const avgSalary = totalSalary / employees.length;
                const avgDailyRate = employees.reduce((sum, emp) => sum + (emp.salary / 30), 0) / employees.length;
                
                const summaryData = [
                    { '‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠': '‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•': employees.length + ' ‡∏Ñ‡∏ô' },
                    { '‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠': '‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•': Math.round(avgSalary).toLocaleString() + ' ‡∏ö‡∏≤‡∏ó' },
                    { '‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠': '‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•': Math.round(avgDailyRate).toLocaleString() + ' ‡∏ö‡∏≤‡∏ó' },
                    { '‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠': '‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•': totalSalary.toLocaleString() + ' ‡∏ö‡∏≤‡∏ó' },
                    { '‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠': '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà Export', '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•': new Date().toLocaleDateString('th-TH') }
                ];
                
                // Department breakdown
                const deptStats = {};
                employees.forEach(emp => {
                    if (!deptStats[emp.department]) {
                        deptStats[emp.department] = { count: 0, totalSalary: 0 };
                    }
                    deptStats[emp.department].count++;
                    deptStats[emp.department].totalSalary += emp.salary;
                });
                
                Object.keys(deptStats).forEach(dept => {
                    summaryData.push({
                        '‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠': `‡πÅ‡∏ú‡∏ô‡∏Å${dept}`,
                        '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•': `${deptStats[dept].count} ‡∏Ñ‡∏ô, ‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏£‡∏ß‡∏° ${deptStats[dept].totalSalary.toLocaleString()} ‡∏ö‡∏≤‡∏ó`
                    });
                });
                
                const ws4 = XLSX.utils.json_to_sheet(summaryData);
                XLSX.utils.book_append_sheet(wb, ws4, "‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");
                
                const fileName = `Addvalue_Employee_Database_${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(wb, fileName);
                
                showNotification('Export Excel ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß', 'success');
            } catch (error) {
                console.error('Export error:', error);
                showNotification('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£ Export', 'error');
            }
        }
        
        function showNotification(message, type) {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.classList.add('show'), 100);
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => document.body.removeChild(notification), 300);
            }, 3000);
        }
        
        // Event listeners
        document.getElementById('newNote').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addNote();
            }
        });
        
        // Close modal when clicking outside
        document.getElementById('employeeModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });
        
        document.getElementById('salaryHistoryModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSalaryHistoryModal();
            }
        });
        
        // Initialize app
        updateStatistics();
        renderEmployees();
    </script>
</body>
</html>