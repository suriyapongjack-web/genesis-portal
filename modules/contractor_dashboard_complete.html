<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard ‡πÉ‡∏ö‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤ - ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£ LAN 76 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 30px;
            background: #f8f9fa;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
            border-left: 5px solid #007bff;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }

        .stat-card.pending {
            border-left-color: #ffc107;
        }

        .stat-card.confirmed {
            border-left-color: #28a745;
        }

        .stat-card.rejected {
            border-left-color: #dc3545;
        }

        .stat-card.multiple {
            border-left-color: #17a2b8;
        }

        .stat-card h3 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            color: #2c3e50;
            font-weight: 700;
        }

        .stat-card p {
            font-size: 1.1rem;
            color: #6c757d;
            font-weight: 500;
        }

        .controls {
            padding: 30px;
            background: white;
            border-bottom: 2px solid #e9ecef;
        }

        .control-row {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .search-group {
            display: flex;
            gap: 15px;
            flex: 1;
            min-width: 300px;
        }

        .form-control {
            padding: 12px 16px;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            outline: none;
        }

        .form-control:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: white;
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8 0%, #138496 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .export-section {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .table-container {
            padding: 30px;
            overflow-x: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            font-size: 0.95rem;
        }

        .data-table thead {
            background: linear-gradient(135deg, #343a40 0%, #495057 100%);
            color: white;
        }

        .data-table th,
        .data-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #e9ecef;
        }

        .data-table th {
            font-weight: 600;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .data-table tbody tr {
            transition: background-color 0.2s ease;
            cursor: pointer;
        }

        .data-table tbody tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-align: center;
            min-width: 100px;
            display: inline-block;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status-confirmed {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-rejected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-multiple {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #b8daff;
        }

        .status-badge:hover {
            transform: scale(1.05);
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
        }

        .equipment-count {
            background: #e3f2fd;
            color: #1565c0;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: 600;
            margin: 2px;
            display: inline-block;
        }

        .contractor-count {
            background: #f3e5f5;
            color: #7b1fa2;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
        }

        .contractor-count:hover {
            background: #e1bee7;
            transform: scale(1.05);
        }

        .contractor-count.multiple {
            background: #e8f5e8;
            color: #2e7d32;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .progress-container {
            background: white;
            margin: 20px 30px;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .progress-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 25px;
            overflow: hidden;
            margin-top: 15px;
            position: relative;
        }

        .progress-fill {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            height: 100%;
            transition: width 1s ease;
            position: relative;
        }

        .progress-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .footer {
            background: #f8f9fa;
            padding: 20px 30px;
            text-align: center;
            color: #6c757d;
            border-top: 2px solid #e9ecef;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #28a745;
            color: white;
            padding: 15px 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            transform: translateX(300px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
        }

        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }

        .filter-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            color: #1565c0;
            font-weight: 500;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 2% auto;
            padding: 30px;
            border-radius: 15px;
            width: 95%;
            max-width: 800px;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-content.large {
            max-width: 1000px;
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 20px;
            top: 20px;
        }

        .close:hover {
            color: #000;
        }

        .contractor-list {
            margin-top: 20px;
        }

        .contractor-card {
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            background: #f8f9fa;
            transition: all 0.3s ease;
        }

        .contractor-card:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .contractor-card.selected {
            border-color: #28a745;
            background: #f8fff9;
        }

        .contractor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .contractor-name {
            font-size: 1.2rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .contractor-actions {
            display: flex;
            gap: 10px;
        }

        .contractor-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .detail-item {
            display: flex;
            flex-direction: column;
        }

        .detail-label {
            font-size: 0.85rem;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .detail-value {
            font-weight: 500;
            color: #2c3e50;
        }

        .add-contractor-btn {
            width: 100%;
            padding: 15px;
            border: 2px dashed #007bff;
            background: #f8f9ff;
            color: #007bff;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .add-contractor-btn:hover {
            background: #e3f2fd;
            border-color: #0056b3;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 1.8rem;
            }
            
            .control-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-group {
                min-width: auto;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .export-section {
                justify-content: center;
            }

            .data-table {
                font-size: 0.8rem;
            }

            .data-table th,
            .data-table td {
                padding: 8px;
            }

            .modal-content {
                margin: 5% auto;
                padding: 20px;
                width: 95%;
            }

            .contractor-details {
                grid-template-columns: 1fr;
            }
        }

        .badge-multiple {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
            margin-left: 8px;
        }
    </style>
</head>
<body>
    <!-- Notification -->
    <div id="notification" class="notification"></div>

    <!-- Contractors Modal -->
    <div id="contractorsModal" class="modal">
        <div class="modal-content large">
            <span class="close" onclick="closeContractorsModal()">&times;</span>
            <h2 id="modalTitle">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö</h2>
            <div id="contractorsList" class="contractor-list">
                <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
            </div>
            <button class="add-contractor-btn" onclick="showAddContractorForm()">
                ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà
            </button>
        </div>
    </div>

    <!-- Add Contractor Modal -->
    <div id="addContractorModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeAddContractorModal()">&times;</span>
            <h2>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà</h2>
            <form id="addContractorForm">
                <div class="form-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó/‡∏´‡πâ‡∏≤‡∏á‡∏´‡∏∏‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô *</label>
                    <input type="text" id="companyName" required>
                </div>
                <div class="form-group">
                    <label>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ *</label>
                    <input type="text" id="contactPerson" required>
                </div>
                <div class="form-group">
                    <label>‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå *</label>
                    <input type="tel" id="contactPhone" required>
                </div>
                <div class="form-group">
                    <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏• *</label>
                    <input type="email" id="contactEmail" required>
                </div>
                <div class="form-group">
                    <label>Line ID</label>
                    <input type="text" id="lineId">
                </div>
                <div class="form-group">
                    <label>‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå (‡∏õ‡∏µ)</label>
                    <input type="number" id="experience" min="0">
                </div>
                <div class="form-group">
                    <label>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</label>
                    <select id="contractorStatus">
                        <option value="pending">‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤</option>
                        <option value="qualified">‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤</option>
                        <option value="selected">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
                        <option value="rejected">‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</label>
                    <textarea id="contractorNotes" rows="3"></textarea>
                </div>
                <div style="text-align: center; margin-top: 25px;">
                    <button type="submit" class="btn btn-success">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    <button type="button" class="btn" style="background: #6c757d; color: white; margin-left: 10px;" onclick="closeAddContractorModal()">‚ùå ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
                </div>
            </form>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>üè¢ Dashboard ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h1>
            <p>‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢ (LAN) 76 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î - Add Value System Company Limited</p>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3 id="totalProvinces">76</h3>
                <p>üìç ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
            </div>
            <div class="stat-card confirmed">
                <h3 id="confirmedCount">0</h3>
                <p>‚úÖ ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß</p>
            </div>
            <div class="stat-card multiple">
                <h3 id="multipleCount">0</h3>
                <p>üë• ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≤‡∏¢</p>
            </div>
            <div class="stat-card pending">
                <h3 id="pendingCount">76</h3>
                <p>‚è≥ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö</p>
            </div>
            <div class="stat-card">
                <h3 id="totalContractors">0</h3>
                <p>üè™ ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
            </div>
            <div class="stat-card">
                <h3 id="totalPoints">2,373</h3>
                <p>üîå ‡∏à‡∏∏‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</p>
            </div>
        </div>

        <div class="progress-container">
            <h3>üìä ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤</h3>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%">
                    <div class="progress-text" id="progressText">0%</div>
                </div>
            </div>
            <p style="margin-top: 10px; color: #6c757d; text-align: center;">
                <span id="progressPercent">0</span>% ‡∏Ç‡∏≠‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß 
                (<span id="confirmedCountText">0</span> ‡∏à‡∏≤‡∏Å 76 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î)
            </p>
        </div>

        <div class="controls">
            <div class="control-row">
                <div class="search-group">
                    <input type="text" id="searchInput" class="form-control" placeholder="üîç ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î, ‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó, ‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠...">
                    <select id="statusFilter" class="form-control">
                        <option value="">üìã ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        <option value="hasContractors">‚úÖ ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö</option>
                        <option value="multiple">üë• ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≤‡∏¢</option>
                        <option value="noContractors">‚è≥ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö</option>
                    </select>
                    <select id="regionFilter" class="form-control">
                        <option value="">üó∫Ô∏è ‡∏†‡∏≤‡∏Ñ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</option>
                        <option value="north">‡∏†‡∏≤‡∏Ñ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠</option>
                        <option value="northeast">‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠</option>
                        <option value="central">‡∏†‡∏≤‡∏Ñ‡∏Å‡∏•‡∏≤‡∏á</option>
                        <option value="east">‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å</option>
                        <option value="west">‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å</option>
                        <option value="south">‡∏†‡∏≤‡∏Ñ‡πÉ‡∏ï‡πâ</option>
                    </select>
                </div>
                <div class="export-section">
                    <button class="btn btn-primary" onclick="exportToJSON()">üìÅ Export JSON</button>
                    <button class="btn btn-success" onclick="exportToCSV()">üìä Export CSV</button>
                    <button class="btn btn-warning" onclick="exportToPowerBI()">‚ö° Power BI Format</button>
                    <button class="btn btn-info" onclick="generateReport()">üìã ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
                </div>
            </div>
            <div id="filterInfo" class="filter-info" style="display: none;"></div>
        </div>

        <div class="table-container">
            <table class="data-table" id="provincesTable">
                <thead>
                    <tr>
                        <th style="width: 60px;">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                        <th style="width: 120px;">‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</th>
                        <th style="width: 100px;">‡∏†‡∏≤‡∏Ñ</th>
                        <th>‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡∏°</th>
                        <th style="width: 80px;">‡∏à‡∏∏‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á</th>
                        <th style="width: 80px;">Switch</th>
                        <th style="width: 80px;">Rack</th>
                        <th style="width: 150px;">‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö</th>
                        <th style="width: 120px;">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ñ‡∏π‡∏Å populate ‡∏î‡πâ‡∏ß‡∏¢ JavaScript -->
                </tbody>
            </table>
        </div>

        <div class="footer">
            <p>üìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó: <span id="updateDate"></span> | 
               üè¢ Add Value System Company Limited | 
               üìß addvalue-procurement@addvaluesystemcompany.onmicrosoft.com</p>
        </div>
    </div>

    <script>
        // ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏ó‡∏±‡πâ‡∏á 76 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤
        const provincesData = [
            {id: 1, name: "‡∏Å‡∏£‡∏∞‡∏ö‡∏µ‡πà", region: "south", email: "addvalue-krabi@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 2, name: "‡∏Å‡∏≤‡∏ç‡∏à‡∏ô‡∏ö‡∏∏‡∏£‡∏µ", region: "west", email: "addvalue-kanchanaburi@outlook.co.th", points: 34, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 3, name: "‡∏Å‡∏≤‡∏¨‡∏™‡∏¥‡∏ô‡∏ò‡∏∏‡πå", region: "northeast", email: "addvalue-kalasin@outlook.co.th", points: 37, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 4, name: "‡∏Å‡∏≥‡πÅ‡∏û‡∏á‡πÄ‡∏û‡∏ä‡∏£", region: "north", email: "addvalue-kamphaengphet@outlook.co.th", points: 11, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 5, name: "‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô", region: "northeast", email: "addvalue-khonkaen@outlook.co.th", points: 53, switches: 3, racks: 1, lastUpdate: "2024-08-30", contractors: [
                {id: 1, companyName: "‡∏ö‡∏à‡∏Å.‡πÄ‡∏ó‡∏Ñ‡πÇ‡∏ô‡πÇ‡∏•‡∏¢‡∏µ ‡∏Ç‡∏≠‡∏ô‡πÅ‡∏Å‡πà‡∏ô", contactPerson: "‡∏ô‡∏≤‡∏¢‡∏™‡∏°‡∏ä‡∏≤‡∏¢ ‡πÉ‡∏à‡∏î‡∏µ", contactPhone: "089-123-4567", contactEmail: "somchai@techkk.com", lineId: "somchai_tech", experience: 5, status: "qualified", submittedDate: "2024-08-28", notes: "‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏á‡∏≤‡∏ô LAN ‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤ 5 ‡∏õ‡∏µ"}
            ]},
            {id: 6, name: "‡∏à‡∏±‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", region: "east", email: "addvalue-chanthaburi@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 7, name: "‡∏â‡∏∞‡πÄ‡∏ä‡∏¥‡∏á‡πÄ‡∏ó‡∏£‡∏≤", region: "central", email: "addvalue-chachoengsao@outlook.co.th", points: 31, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 8, name: "‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ", region: "east", email: "addvalue-chonburi@outlook.co.th", points: 48, switches: 3, racks: 1, lastUpdate: "2024-08-30", contractors: [
                {id: 1, companyName: "‡∏´‡∏à‡∏Å.‡πÄ‡∏ô‡πá‡∏ï‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏Ñ ‡∏ä‡∏•‡∏ö‡∏∏‡∏£‡∏µ", contactPerson: "‡∏ô‡∏≤‡∏¢‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤ ‡πÄ‡∏Å‡πà‡∏á‡∏Å‡∏≤‡∏à", contactPhone: "081-234-5678", contactEmail: "wittaya@netcb.com", lineId: "wittaya_net", experience: 7, status: "selected", submittedDate: "2024-08-25", notes: "‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÑ‡∏î‡πâ ‡∏°‡∏µ‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏î‡∏µ"},
                {id: 2, companyName: "‡∏ö‡∏à‡∏Å.‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï ‡∏û‡∏•‡∏±‡∏™", contactPerson: "‡∏ô‡∏≤‡∏á‡∏™‡∏≤‡∏ß‡∏°‡∏ì‡∏µ ‡πÅ‡∏™‡∏á‡∏ó‡∏≠‡∏á", contactPhone: "092-345-6789", contactEmail: "manee@inetplus.com", lineId: "manee_iplus", experience: 4, status: "qualified", submittedDate: "2024-08-27", notes: "‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏Ç‡πà‡∏á‡∏Ç‡∏±‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏ï‡πà‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤"},
                {id: 3, companyName: "‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏≠‡∏°‡∏Ø ‡πÇ‡∏ä‡∏Ñ‡∏î‡∏µ", contactPerson: "‡∏ô‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡πÄ‡∏™‡∏£‡∏¥‡∏ê ‡∏ä‡∏≠‡∏ö‡∏á‡∏≤‡∏ô", contactPhone: "086-456-7890", contactEmail: "prasert@chokdee.com", lineId: "prasert_cd", experience: 2, status: "pending", submittedDate: "2024-08-29", notes: "‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô"}
            ]},
            {id: 9, name: "‡∏ä‡∏±‡∏¢‡∏ô‡∏≤‡∏ó", region: "central", email: "addvalue-chainat@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 10, name: "‡∏ä‡∏±‡∏¢‡∏†‡∏π‡∏°‡∏¥", region: "northeast", email: "addvalue-chaiyaphum@outlook.co.th", points: 34, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 11, name: "‡∏ä‡∏∏‡∏°‡∏û‡∏£", region: "south", email: "addvalue-chumphon@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 12, name: "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡∏£‡∏≤‡∏¢", region: "north", email: "addvalue-chiangrai@outlook.co.th", points: 38, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 13, name: "‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà", region: "north", email: "addvalue-chiangmai@outlook.co.th", points: 53, switches: 3, racks: 1, lastUpdate: "2024-08-30", contractors: [
                {id: 1, companyName: "‡∏ö‡∏à‡∏Å.‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡πÄ‡∏ó‡∏Ñ ‡πÄ‡∏ã‡∏≠‡∏£‡πå‡∏ß‡∏¥‡∏™", contactPerson: "‡∏ô‡∏≤‡∏¢‡∏ä‡∏≥‡∏ô‡∏≤‡∏ç ‡∏£‡∏π‡πâ‡πÄ‡∏Å‡πà‡∏á", contactPhone: "053-123-456", contactEmail: "chamnan@northtech.com", lineId: "chamnan_nt", experience: 8, status: "selected", submittedDate: "2024-08-26", notes: "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏õ‡πá‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡∏´‡∏•‡∏±‡∏Å‡πÅ‡∏•‡πâ‡∏ß"},
                {id: 2, companyName: "‡∏´‡∏à‡∏Å.‡∏î‡∏≠‡∏¢‡πÄ‡∏ó‡∏Ñ", contactPerson: "‡∏ô‡∏≤‡∏á‡∏™‡∏∏‡∏î‡∏≤ ‡∏Ç‡∏¢‡∏±‡∏ô‡∏ó‡∏≥", contactPhone: "053-234-567", contactEmail: "suda@doitech.com", lineId: "suda_dt", experience: 6, status: "backup", submittedDate: "2024-08-27", notes: "‡πÄ‡∏Å‡πá‡∏ö‡πÑ‡∏ß‡πâ‡πÄ‡∏õ‡πá‡∏ô backup contractor"}
            ]},
            {id: 14, name: "‡∏ï‡∏£‡∏±‡∏á", region: "south", email: "addvalue-trang@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 15, name: "‡∏ï‡∏£‡∏≤‡∏î", region: "east", email: "addvalue-trat@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 16, name: "‡∏ï‡∏≤‡∏Å", region: "north", email: "addvalue-tak@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 17, name: "‡∏ô‡∏Ñ‡∏£‡∏ô‡∏≤‡∏¢‡∏Å", region: "central", email: "addvalue-nakhonnayok@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 18, name: "‡∏ô‡∏Ñ‡∏£‡∏õ‡∏ê‡∏°", region: "central", email: "addvalue-nakhonpathom@outlook.co.th", points: 34, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 19, name: "‡∏ô‡∏Ñ‡∏£‡∏û‡∏ô‡∏°", region: "northeast", email: "addvalue-nakhonphanom@outlook.co.th", points: 11, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 20, name: "‡∏ô‡∏Ñ‡∏£‡∏£‡∏≤‡∏ä‡∏™‡∏µ‡∏°‡∏≤", region: "northeast", email: "addvalue-nakhonratchasima@outlook.co.th", points: 43, switches: 3, racks: 1, lastUpdate: "2024-08-30", contractors: [
                {id: 1, companyName: "‡∏ö‡∏à‡∏Å.‡πÇ‡∏Ñ‡∏£‡∏≤‡∏ä ‡πÄ‡∏ô‡πá‡∏ï‡πÄ‡∏ß‡∏¥‡∏£‡πå‡∏Ñ", contactPerson: "‡∏ô‡∏≤‡∏¢‡∏î‡∏≥‡∏£‡∏á‡∏Ñ‡πå ‡πÄ‡∏ä‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏≤‡∏ç", contactPhone: "044-123-456", contactEmail: "damrong@koratnet.com", lineId: "damrong_kn", experience: 10, status: "qualified", submittedDate: "2024-08-24", notes: "‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏™‡∏π‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î"}
            ]},
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏î‡∏¥‡∏° ‡πÇ‡∏î‡∏¢‡∏™‡πà‡∏ß‡∏ô‡πÉ‡∏´‡∏ç‡πà‡∏à‡∏∞‡πÄ‡∏õ‡πá‡∏ô contractors: []
            {id: 21, name: "‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏ò‡∏£‡∏£‡∏°‡∏£‡∏≤‡∏ä", region: "south", email: "addvalue-nakhonsithammarat@outlook.co.th", points: 38, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 22, name: "‡∏ô‡∏Ñ‡∏£‡∏™‡∏ß‡∏£‡∏£‡∏Ñ‡πå", region: "north", email: "addvalue-nakhonsawan@outlook.co.th", points: 34, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 23, name: "‡∏ô‡∏ô‡∏ó‡∏ö‡∏∏‡∏£‡∏µ", region: "central", email: "addvalue-nonthaburi@outlook.co.th", points: 31, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 24, name: "‡∏ô‡∏£‡∏≤‡∏ò‡∏¥‡∏ß‡∏≤‡∏™", region: "south", email: "addvalue-narathiwat@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 25, name: "‡∏ô‡πà‡∏≤‡∏ô", region: "north", email: "addvalue-nan@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 26, name: "‡∏ö‡∏∂‡∏á‡∏Å‡∏≤‡∏¨", region: "northeast", email: "addvalue-buengkan@outlook.co.th", points: 11, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 27, name: "‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå", region: "northeast", email: "addvalue-buriram@outlook.co.th", points: 38, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 28, name: "‡∏õ‡∏ó‡∏∏‡∏°‡∏ò‡∏≤‡∏ô‡∏µ", region: "central", email: "addvalue-pathumthani@outlook.co.th", points: 34, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 29, name: "‡∏õ‡∏£‡∏∞‡∏à‡∏ß‡∏ö‡∏Ñ‡∏µ‡∏£‡∏µ‡∏Ç‡∏±‡∏ô‡∏ò‡πå", region: "south", email: "addvalue-prachuapkhirikhan@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 30, name: "‡∏õ‡∏£‡∏≤‡∏à‡∏µ‡∏ô‡∏ö‡∏∏‡∏£‡∏µ", region: "east", email: "addvalue-prachinburi@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 31, name: "‡∏õ‡∏±‡∏ï‡∏ï‡∏≤‡∏ô‡∏µ", region: "south", email: "addvalue-pattani@outlook.co.th", points: 11, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 32, name: "‡∏û‡∏£‡∏∞‡∏ô‡∏Ñ‡∏£‡∏®‡∏£‡∏µ‡∏≠‡∏¢‡∏∏‡∏ò‡∏¢‡∏≤", region: "central", email: "addvalue-ayutthaya@outlook.co.th", points: 34, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 33, name: "‡∏û‡∏∞‡πÄ‡∏¢‡∏≤", region: "north", email: "addvalue-phayao@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 34, name: "‡∏û‡∏±‡∏á‡∏á‡∏≤", region: "south", email: "addvalue-phangnga@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 35, name: "‡∏û‡∏±‡∏ó‡∏•‡∏∏‡∏á", region: "south", email: "addvalue-phatthalung@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 36, name: "‡∏û‡∏¥‡∏à‡∏¥‡∏ï‡∏£", region: "north", email: "addvalue-phichit@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 37, name: "‡∏û‡∏¥‡∏©‡∏ì‡∏∏‡πÇ‡∏•‡∏Å", region: "north", email: "addvalue-phitsanulok@outlook.co.th", points: 34, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 38, name: "‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏∏‡∏£‡∏µ", region: "central", email: "addvalue-phetchaburi@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 39, name: "‡πÄ‡∏û‡∏ä‡∏£‡∏ö‡∏π‡∏£‡∏ì‡πå", region: "north", email: "addvalue-phetchabun@outlook.co.th", points: 34, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 40, name: "‡πÅ‡∏û‡∏£‡πà", region: "north", email: "addvalue-phrae@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 41, name: "‡∏†‡∏π‡πÄ‡∏Å‡πá‡∏ï", region: "south", email: "addvalue-phuket@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 42, name: "‡∏°‡∏´‡∏≤‡∏™‡∏≤‡∏£‡∏Ñ‡∏≤‡∏°", region: "northeast", email: "addvalue-mahasarakham@outlook.co.th", points: 34, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 43, name: "‡∏°‡∏∏‡∏Å‡∏î‡∏≤‡∏´‡∏≤‡∏£", region: "northeast", email: "addvalue-mukdahan@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 44, name: "‡πÅ‡∏°‡πà‡∏Æ‡πà‡∏≠‡∏á‡∏™‡∏≠‡∏ô", region: "north", email: "addvalue-maehongson@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 45, name: "‡∏¢‡πÇ‡∏™‡∏ò‡∏£", region: "northeast", email: "addvalue-yasothon@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 46, name: "‡∏¢‡∏∞‡∏•‡∏≤", region: "south", email: "addvalue-yala@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 47, name: "‡∏£‡πâ‡∏≠‡∏¢‡πÄ‡∏≠‡πá‡∏î", region: "northeast", email: "addvalue-roiet@outlook.co.th", points: 38, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 48, name: "‡∏£‡∏∞‡∏ô‡∏≠‡∏á", region: "south", email: "addvalue-ranong@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 49, name: "‡∏£‡∏∞‡∏¢‡∏≠‡∏á", region: "east", email: "addvalue-rayong@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 50, name: "‡∏£‡∏≤‡∏ä‡∏ö‡∏∏‡∏£‡∏µ", region: "west", email: "addvalue-ratchaburi@outlook.co.th", points: 34, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 51, name: "‡∏•‡∏û‡∏ö‡∏∏‡∏£‡∏µ", region: "central", email: "addvalue-lopburi@outlook.co.th", points: 31, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 52, name: "‡∏•‡∏≥‡∏õ‡∏≤‡∏á", region: "north", email: "addvalue-lampang@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 53, name: "‡∏•‡∏≥‡∏û‡∏π‡∏ô", region: "north", email: "addvalue-lamphun@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 54, name: "‡πÄ‡∏•‡∏¢", region: "northeast", email: "addvalue-loei@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 55, name: "‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©", region: "northeast", email: "addvalue-sisaket@outlook.co.th", points: 38, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 56, name: "‡∏™‡∏Å‡∏•‡∏ô‡∏Ñ‡∏£", region: "northeast", email: "addvalue-sakonnakhon@outlook.co.th", points: 34, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 57, name: "‡∏™‡∏á‡∏Ç‡∏•‡∏≤", region: "south", email: "addvalue-songkhla@outlook.co.th", points: 51, switches: 3, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 58, name: "‡∏™‡∏ï‡∏π‡∏•", region: "south", email: "addvalue-satun@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 59, name: "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏õ‡∏£‡∏≤‡∏Å‡∏≤‡∏£", region: "central", email: "addvalue-samutprakan@outlook.co.th", points: 34, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 60, name: "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏á‡∏Ñ‡∏£‡∏≤‡∏°", region: "central", email: "addvalue-samutsongkhram@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 61, name: "‡∏™‡∏°‡∏∏‡∏ó‡∏£‡∏™‡∏≤‡∏Ñ‡∏£", region: "central", email: "addvalue-samutsakhon@outlook.co.th", points: 11, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 62, name: "‡∏™‡∏£‡∏∞‡πÅ‡∏Å‡πâ‡∏ß", region: "east", email: "addvalue-sakaeo@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 63, name: "‡∏™‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏µ", region: "central", email: "addvalue-saraburi@outlook.co.th", points: 31, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 64, name: "‡∏™‡∏¥‡∏á‡∏´‡πå‡∏ö‡∏∏‡∏£‡∏µ", region: "central", email: "addvalue-singburi@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 65, name: "‡∏™‡∏∏‡πÇ‡∏Ç‡∏ó‡∏±‡∏¢", region: "north", email: "addvalue-sukhothai@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 66, name: "‡∏™‡∏∏‡∏û‡∏£‡∏£‡∏ì‡∏ö‡∏∏‡∏£‡∏µ", region: "central", email: "addvalue-suphanburi@outlook.co.th", points: 31, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 67, name: "‡∏™‡∏∏‡∏£‡∏≤‡∏©‡∏é‡∏£‡πå‡∏ò‡∏≤‡∏ô‡∏µ", region: "south", email: "addvalue-suratthani@outlook.co.th", points: 34, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 68, name: "‡∏™‡∏∏‡∏£‡∏¥‡∏ô‡∏ó‡∏£‡πå", region: "northeast", email: "addvalue-surin@outlook.co.th", points: 38, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 69, name: "‡∏´‡∏ô‡∏≠‡∏á‡∏Ñ‡∏≤‡∏¢", region: "northeast", email: "addvalue-nongkhai@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 70, name: "‡∏´‡∏ô‡∏≠‡∏á‡∏ö‡∏±‡∏ß‡∏•‡∏≥‡∏†‡∏π", region: "northeast", email: "addvalue-nongbualamphu@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 71, name: "‡∏≠‡πà‡∏≤‡∏á‡∏ó‡∏≠‡∏á", region: "central", email: "addvalue-angthong@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 72, name: "‡∏≠‡∏≥‡∏ô‡∏≤‡∏à‡πÄ‡∏à‡∏£‡∏¥‡∏ç", region: "northeast", email: "addvalue-amnatcharoen@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 73, name: "‡∏≠‡∏∏‡∏î‡∏£‡∏ò‡∏≤‡∏ô‡∏µ", region: "northeast", email: "addvalue-udonthani@outlook.co.th", points: 38, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 74, name: "‡∏≠‡∏∏‡∏ï‡∏£‡∏î‡∏¥‡∏ï‡∏ñ‡πå", region: "north", email: "addvalue-uttaradit@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 75, name: "‡∏≠‡∏∏‡∏ó‡∏±‡∏¢‡∏ò‡∏≤‡∏ô‡∏µ", region: "north", email: "addvalue-uthaithani@outlook.co.th", points: 29, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []},
            {id: 76, name: "‡∏≠‡∏∏‡∏ö‡∏•‡∏£‡∏≤‡∏ä‡∏ò‡∏≤‡∏ô‡∏µ", region: "northeast", email: "addvalue-ubonratchathani@outlook.co.th", points: 39, switches: 2, racks: 1, lastUpdate: "2024-08-30", contractors: []}
        ];

        let filteredData = [...provincesData];
        let currentProvinceId = null;

        // Region mappings
        const regionNames = {
            "north": "‡∏†‡∏≤‡∏Ñ‡πÄ‡∏´‡∏ô‡∏∑‡∏≠",
            "northeast": "‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å‡πÄ‡∏â‡∏µ‡∏¢‡∏á‡πÄ‡∏´‡∏ô‡∏∑‡∏≠", 
            "central": "‡∏†‡∏≤‡∏Ñ‡∏Å‡∏•‡∏≤‡∏á",
            "east": "‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏≠‡∏≠‡∏Å",
            "west": "‡∏†‡∏≤‡∏Ñ‡∏ï‡∏∞‡∏ß‡∏±‡∏ô‡∏ï‡∏Å",
            "south": "‡∏†‡∏≤‡∏Ñ‡πÉ‡∏ï‡πâ"
        };

        // Status mappings
        const statusNames = {
            "pending": "‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤",
            "qualified": "‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤",
            "selected": "‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô",
            "backup": "‡∏™‡∏≥‡∏£‡∏≠‡∏á",
            "rejected": "‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤"
        };

        // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥
        function updateStats() {
            const provincesWithContractors = provincesData.filter(p => p.contractors.length > 0).length;
            const provincesWithMultiple = provincesData.filter(p => p.contractors.length > 1).length;
            const pendingProvinces = provincesData.filter(p => p.contractors.length === 0).length;
            const totalContractors = provincesData.reduce((sum, p) => sum + p.contractors.length, 0);
            const totalPoints = provincesData.reduce((sum, p) => sum + p.points, 0);

            document.getElementById('confirmedCount').textContent = provincesWithContractors;
            document.getElementById('multipleCount').textContent = provincesWithMultiple;
            document.getElementById('pendingCount').textContent = pendingProvinces;
            document.getElementById('totalContractors').textContent = totalContractors;
            document.getElementById('totalPoints').textContent = totalPoints.toLocaleString();

            // ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó progress bar
            const progressPercent = Math.round((provincesWithContractors / provincesData.length) * 100);
            document.getElementById('progressPercent').textContent = progressPercent;
            document.getElementById('confirmedCountText').textContent = provincesWithContractors;
            document.getElementById('progressFill').style.width = progressPercent + '%';
            document.getElementById('progressText').textContent = progressPercent + '%';
        }

        // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏£‡∏≤‡∏á
        function populateTable(data = filteredData) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" style="text-align: center; padding: 40px; color: #6c757d;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</td></tr>';
                return;
            }

            data.forEach((province, index) => {
                const row = tbody.insertRow();
                const contractorsCount = province.contractors.length;
                const contractorDisplay = getContractorDisplay(province);
                
                row.innerHTML = `
                    <td style="text-align: center; font-weight: bold;">${index + 1}</td>
                    <td style="font-weight: bold; color: #2c3e50;">${province.name}</td>
                    <td><span style="background: #e3f2fd; color: #1565c0; padding: 4px 8px; border-radius: 4px; font-size: 0.8rem;">${regionNames[province.region]}</span></td>
                    <td style="font-size: 0.85rem; color: #6c757d;">${province.email}</td>
                    <td><span class="equipment-count">${province.points} ‡∏à‡∏∏‡∏î</span></td>
                    <td><span class="equipment-count">${province.switches} ‡∏ï‡∏±‡∏ß</span></td>
                    <td><span class="equipment-count">${province.racks} ‡∏ï‡∏π‡πâ</span></td>
                    <td>${contractorDisplay}</td>
                    <td style="font-size: 0.8rem; color: #6c757d;">${formatDate(province.lastUpdate)}</td>
                `;

                // ‡πÄ‡∏û‡∏¥‡πà‡∏° hover effect
                row.addEventListener('mouseenter', () => {
                    row.style.transform = 'scale(1.01)';
                    row.style.boxShadow = '0 2px 8px rgba(0,0,0,0.1)';
                });

                row.addEventListener('mouseleave', () => {
                    row.style.transform = 'scale(1)';
                    row.style.boxShadow = 'none';
                });
            });

            updateFilterInfo(data.length);
        }

        function getContractorDisplay(province) {
            const count = province.contractors.length;
            if (count === 0) {
                return '<span class="contractor-count" onclick="openContractorsModal(' + province.id + ')">‚è≥ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö</span>';
            } else if (count === 1) {
                return '<span class="contractor-count" onclick="openContractorsModal(' + province.id + ')">‚úÖ ' + count + ' ‡∏£‡∏≤‡∏¢</span>';
            } else {
                return '<span class="contractor-count multiple" onclick="openContractorsModal(' + province.id + ')">üë• ' + count + ' ‡∏£‡∏≤‡∏¢' + 
                       '<span class="badge-multiple">Multiple!</span></span>';
            }
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('th-TH', {
                day: '2-digit',
                month: '2-digit', 
                year: 'numeric'
            });
        }

        function updateFilterInfo(count) {
            const filterInfo = document.getElementById('filterInfo');
            const searchTerm = document.getElementById('searchInput').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const regionFilter = document.getElementById('regionFilter').value;

            if (searchTerm || statusFilter || regionFilter || count < provincesData.length) {
                let info = `‡πÅ‡∏™‡∏î‡∏á ${count.toLocaleString()} ‡∏à‡∏≤‡∏Å ${provincesData.length} ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î`;
                if (searchTerm) info += ` | ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: "${searchTerm}"`;
                if (statusFilter) {
                    const statusLabels = {
                        'hasContractors': '‚úÖ ‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö',
                        'multiple': 'üë• ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏≤‡∏¢',
                        'noContractors': '‚è≥ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö'
                    };
                    info += ` | ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${statusLabels[statusFilter]}`;
                }
                if (regionFilter) info += ` | ‡∏†‡∏≤‡∏Ñ: ${regionNames[regionFilter]}`;
                
                filterInfo.textContent = info;
                filterInfo.style.display = 'block';
            } else {
                filterInfo.style.display = 'none';
            }
        }

        // Modal functions
        function openContractorsModal(provinceId) {
            currentProvinceId = provinceId;
            const province = provincesData.find(p => p.id === provinceId);
            
            document.getElementById('modalTitle').textContent = `‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤ ‡∏à.${province.name} (${province.contractors.length} ‡∏£‡∏≤‡∏¢)`;
            
            const contractorsList = document.getElementById('contractorsList');
            contractorsList.innerHTML = '';

            if (province.contractors.length === 0) {
                contractorsList.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 40px;">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö</p>';
            } else {
                province.contractors.forEach(contractor => {
                    const contractorCard = createContractorCard(contractor, provinceId);
                    contractorsList.appendChild(contractorCard);
                });
            }

            document.getElementById('contractorsModal').style.display = 'block';
        }

        function createContractorCard(contractor, provinceId) {
            const card = document.createElement('div');
            card.className = 'contractor-card';
            if (contractor.status === 'selected') {
                card.classList.add('selected');
            }

            card.innerHTML = `
                <div class="contractor-header">
                    <div class="contractor-name">${contractor.companyName}</div>
                    <div class="contractor-actions">
                        <button class="btn btn-info" onclick="editContractor(${provinceId}, ${contractor.id})">‚úèÔ∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                        <button class="btn btn-danger" onclick="removeContractor(${provinceId}, ${contractor.id})">üóëÔ∏è ‡∏•‡∏ö</button>
                    </div>
                </div>
                <div class="contractor-details">
                    <div class="detail-item">
                        <div class="detail-label">‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</div>
                        <div class="detail-value">${contractor.contactPerson}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£</div>
                        <div class="detail-value">${contractor.contactPhone}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">‡∏≠‡∏µ‡πÄ‡∏°‡∏•</div>
                        <div class="detail-value">${contractor.contactEmail}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Line ID</div>
                        <div class="detail-value">${contractor.lineId || '-'}</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">‡∏õ‡∏£‡∏∞‡∏™‡∏ö‡∏Å‡∏≤‡∏£‡∏ì‡πå</div>
                        <div class="detail-value">${contractor.experience || 0} ‡∏õ‡∏µ</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</div>
                        <div class="detail-value">
                            <select onchange="updateContractorStatus(${provinceId}, ${contractor.id}, this.value)" style="padding: 4px 8px; border-radius: 4px;">
                                <option value="pending" ${contractor.status === 'pending' ? 'selected' : ''}>‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤</option>
                                <option value="qualified" ${contractor.status === 'qualified' ? 'selected' : ''}>‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤</option>
                                <option value="selected" ${contractor.status === 'selected' ? 'selected' : ''}>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</option>
                                <option value="backup" ${contractor.status === 'backup' ? 'selected' : ''}>‡∏™‡∏≥‡∏£‡∏≠‡∏á</option>
                                <option value="rejected" ${contractor.status === 'rejected' ? 'selected' : ''}>‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡∏à‡∏≤‡∏£‡∏ì‡∏≤</option>
                            </select>
                        </div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡πà‡∏á‡πÉ‡∏ö‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö</div>
                        <div class="detail-value">${formatDate(contractor.submittedDate)}</div>
                    </div>
                    <div class="detail-item" style="grid-column: 1 / -1;">
                        <div class="detail-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</div>
                        <div class="detail-value">${contractor.notes || '-'}</div>
                    </div>
                </div>
            `;

            return card;
        }

        function updateContractorStatus(provinceId, contractorId, newStatus) {
            const province = provincesData.find(p => p.id === provinceId);
            const contractor = province.contractors.find(c => c.id === contractorId);
            contractor.status = newStatus;
            province.lastUpdate = new Date().toISOString().split('T')[0];
            
            updateStats();
            populateTable(filteredData);
            openContractorsModal(provinceId); // Refresh modal
            
            showNotification(`‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ${contractor.companyName} ‡πÄ‡∏õ‡πá‡∏ô ${statusNames[newStatus]} ‡πÅ‡∏•‡πâ‡∏ß!`);
        }

        function removeContractor(provinceId, contractorId) {
            if (confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡∏£‡∏≤‡∏¢‡∏ô‡∏µ‡πâ?')) {
                const province = provincesData.find(p => p.id === provinceId);
                const contractorIndex = province.contractors.findIndex(c => c.id === contractorId);
                const contractor = province.contractors[contractorIndex];
                
                province.contractors.splice(contractorIndex, 1);
                province.lastUpdate = new Date().toISOString().split('T')[0];
                
                updateStats();
                populateTable(filteredData);
                openContractorsModal(provinceId); // Refresh modal
                
                showNotification(`‡∏•‡∏ö ${contractor.companyName} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
            }
        }

        function closeContractorsModal() {
            document.getElementById('contractorsModal').style.display = 'none';
        }

        function showAddContractorForm() {
            document.getElementById('addContractorForm').reset();
            document.getElementById('addContractorModal').style.display = 'block';
        }

        function closeAddContractorModal() {
            document.getElementById('addContractorModal').style.display = 'none';
        }

        function showNotification(message) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Add contractor form submission
        document.getElementById('addContractorForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!currentProvinceId) {
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î');
                return;
            }

            const province = provincesData.find(p => p.id === currentProvinceId);
            const newContractorId = Math.max(...province.contractors.map(c => c.id), 0) + 1;

            const newContractor = {
                id: newContractorId,
                companyName: document.getElementById('companyName').value,
                contactPerson: document.getElementById('contactPerson').value,
                contactPhone: document.getElementById('contactPhone').value,
                contactEmail: document.getElementById('contactEmail').value,
                lineId: document.getElementById('lineId').value,
                experience: parseInt(document.getElementById('experience').value) || 0,
                status: document.getElementById('contractorStatus').value,
                submittedDate: new Date().toISOString().split('T')[0],
                notes: document.getElementById('contractorNotes').value
            };

            province.contractors.push(newContractor);
            province.lastUpdate = new Date().toISOString().split('T')[0];

            updateStats();
            populateTable(filteredData);
            closeAddContractorModal();
            openContractorsModal(currentProvinceId); // Refresh modal

            showNotification(`‡πÄ‡∏û‡∏¥‡πà‡∏° ${newContractor.companyName} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
        });

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏Å‡∏£‡∏≠‡∏á
        function applyFilters() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const statusFilter = document.getElementById('statusFilter').value;
            const regionFilter = document.getElementById('regionFilter').value;

            filteredData = provincesData.filter(province => {
                // Search filter
                const matchesSearch = province.name.toLowerCase().includes(searchTerm) || 
                                    province.email.toLowerCase().includes(searchTerm) ||
                                    province.contractors.some(c => 
                                        c.companyName.toLowerCase().includes(searchTerm) ||
                                        c.contactPerson.toLowerCase().includes(searchTerm)
                                    );
                
                // Status filter
                let matchesStatus = true;
                if (statusFilter) {
                    switch (statusFilter) {
                        case 'hasContractors':
                            matchesStatus = province.contractors.length > 0;
                            break;
                        case 'multiple':
                            matchesStatus = province.contractors.length > 1;
                            break;
                        case 'noContractors':
                            matchesStatus = province.contractors.length === 0;
                            break;
                    }
                }

                // Region filter
                const matchesRegion = !regionFilter || province.region === regionFilter;

                return matchesSearch && matchesStatus && matchesRegion;
            });

            populateTable(filteredData);
        }

        // Export functions
        function exportToJSON() {
            const dataStr = JSON.stringify(provincesData, null, 2);
            downloadFile(dataStr, 'provinces_contractors_full.json', 'application/json');
            showNotification('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• JSON ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
        }

        function exportToCSV() {
            let csvContent = '\ufeffID,‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î,‡∏†‡∏≤‡∏Ñ,‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ó‡∏µ‡∏°,‡∏à‡∏∏‡∏î‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á,Switch,Rack,‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤,‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó,‡∏ú‡∏π‡πâ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠,‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£,‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤,‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤,‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö,‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó\n';

            provincesData.forEach(p => {
                if (p.contractors.length === 0) {
                    csvContent += `${p.id},"${p.name}","${regionNames[p.region]}","${p.email}",${p.points},${p.switches},${p.racks},0,"","","","","","",${p.lastUpdate}\n`;
                } else {
                    p.contractors.forEach(c => {
                        csvContent += `${p.id},"${p.name}","${regionNames[p.region]}","${p.email}",${p.points},${p.switches},${p.racks},${p.contractors.length},"${c.companyName}","${c.contactPerson}","${c.contactPhone}","${c.contactEmail}","${statusNames[c.status]}",${c.submittedDate},${p.lastUpdate}\n`;
                    });
                }
            });
            
            downloadFile(csvContent, 'provinces_contractors_full.csv', 'text/csv;charset=utf-8;');
            showNotification('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• CSV ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
        }

        function exportToPowerBI() {
            const powerBIData = [];

            provincesData.forEach(p => {
                if (p.contractors.length === 0) {
                    powerBIData.push({
                        ProvinceID: p.id,
                        ProvinceName: p.name,
                        Region: p.region,
                        RegionName: regionNames[p.region],
                        TeamEmail: p.email,
                        InstallationPoints: p.points,
                        SwitchCount: p.switches,
                        RackCount: p.racks,
                        ContractorsCount: 0,
                        HasContractors: false,
                        HasMultipleContractors: false,
                        ContractorID: null,
                        CompanyName: null,
                        ContactPerson: null,
                        ContactPhone: null,
                        ContactEmail: null,
                        ContractorStatus: null,
                        StatusName: null,
                        Experience: null,
                        SubmittedDate: null,
                        Notes: null,
                        LastUpdated: p.lastUpdate,
                        CreatedDate: new Date().toISOString(),
                        ProjectName: '‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢ (LAN) 76 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î',
                        CompanyName: 'Add Value System Company Limited'
                    });
                } else {
                    p.contractors.forEach(c => {
                        powerBIData.push({
                            ProvinceID: p.id,
                            ProvinceName: p.name,
                            Region: p.region,
                            RegionName: regionNames[p.region],
                            TeamEmail: p.email,
                            InstallationPoints: p.points,
                            SwitchCount: p.switches,
                            RackCount: p.racks,
                            ContractorsCount: p.contractors.length,
                            HasContractors: true,
                            HasMultipleContractors: p.contractors.length > 1,
                            ContractorID: c.id,
                            CompanyName: c.companyName,
                            ContactPerson: c.contactPerson,
                            ContactPhone: c.contactPhone,
                            ContactEmail: c.contactEmail,
                            ContractorStatus: c.status,
                            StatusName: statusNames[c.status],
                            Experience: c.experience,
                            SubmittedDate: c.submittedDate,
                            Notes: c.notes,
                            LastUpdated: p.lastUpdate,
                            CreatedDate: new Date().toISOString(),
                            ProjectName: '‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢ (LAN) 76 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î',
                            CompanyName: 'Add Value System Company Limited'
                        });
                    });
                }
            });

            const dataStr = JSON.stringify(powerBIData, null, 2);
            downloadFile(dataStr, 'contractors_powerbi_format.json', 'application/json');
            showNotification('‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• Power BI Format ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
        }

        function generateReport() {
            const provincesWithContractors = provincesData.filter(p => p.contractors.length > 0).length;
            const provincesWithMultiple = provincesData.filter(p => p.contractors.length > 1).length;
            const totalContractors = provincesData.reduce((sum, p) => sum + p.contractors.length, 0);
            
            const reportData = {
                metadata: {
                    reportTitle: '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö - ‡∏£‡∏≤‡∏¢‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î',
                    projectName: '‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡∏≠‡∏Ç‡πà‡∏≤‡∏¢ (LAN) 76 ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î',
                    company: 'Add Value System Company Limited',
                    generatedDate: new Date().toISOString(),
                    generatedBy: 'Dashboard System'
                },
                summary: {
                    totalProvinces: provincesData.length,
                    provincesWithContractors: provincesWithContractors,
                    provincesWithMultipleContractors: provincesWithMultiple,
                    provincesWithoutContractors: provincesData.length - provincesWithContractors,
                    totalContractors: totalContractors,
                    averageContractorsPerProvince: (totalContractors / provincesData.length).toFixed(2),
                    progressPercentage: Math.round((provincesWithContractors / provincesData.length) * 100)
                },
                byStatus: Object.keys(statusNames).map(status => {
                    const contractorsWithStatus = provincesData.reduce((sum, p) => 
                        sum + p.contractors.filter(c => c.status === status).length, 0);
                    return {
                        status: status,
                        statusName: statusNames[status],
                        count: contractorsWithStatus,
                        percentage: totalContractors > 0 ? ((contractorsWithStatus / totalContractors) * 100).toFixed(1) : 0
                    };
                }),
                byRegion: Object.keys(regionNames).map(region => {
                    const regionProvinces = provincesData.filter(p => p.region === region);
                    const regionContractors = regionProvinces.reduce((sum, p) => sum + p.contractors.length, 0);
                    return {
                        region: region,
                        regionName: regionNames[region],
                        totalProvinces: regionProvinces.length,
                        provincesWithContractors: regionProvinces.filter(p => p.contractors.length > 0).length,
                        totalContractors: regionContractors
                    };
                }),
                detailedData: provincesData.map(p => ({
                    id: p.id,
                    name: p.name,
                    region: regionNames[p.region],
                    email: p.email,
                    points: p.points,
                    switches: p.switches,
                    racks: p.racks,
                    contractorsCount: p.contractors.length,
                    lastUpdate: p.lastUpdate,
                    contractors: p.contractors.map(c => ({
                        companyName: c.companyName,
                        contactPerson: c.contactPerson,
                        contactPhone: c.contactPhone,
                        contactEmail: c.contactEmail,
                        status: c.status,
                        statusName: statusNames[c.status],
                        experience: c.experience,
                        submittedDate: c.submittedDate,
                        notes: c.notes
                    }))
                }))
            };

            const dataStr = JSON.stringify(reportData, null, 2);
            downloadFile(dataStr, 'contractors_detailed_report.json', 'application/json');
            showNotification('‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
        }

        function downloadFile(content, filename, contentType) {
            const a = document.createElement('a');
            const file = new Blob([content], {type: contentType});
            a.href = URL.createObjectURL(file);
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        // Event listeners
        document.getElementById('searchInput').addEventListener('input', applyFilters);
        document.getElementById('statusFilter').addEventListener('change', applyFilters);
        document.getElementById('regionFilter').addEventListener('change', applyFilters);

        // Close modals when clicking outside
        window.addEventListener('click', (event) => {
            const contractorsModal = document.getElementById('contractorsModal');
            const addContractorModal = document.getElementById('addContractorModal');
            
            if (event.target === contractorsModal) {
                closeContractorsModal();
            }
            if (event.target === addContractorModal) {
                closeAddContractorModal();
            }
        });

        // Stats card click events for filtering
        document.addEventListener('DOMContentLoaded', function() {
            const statCards = document.querySelectorAll('.stat-card');
            statCards.forEach(card => {
                card.addEventListener('click', function() {
                    const statusFilter = document.getElementById('statusFilter');
                    
                    if (this.classList.contains('confirmed')) {
                        statusFilter.value = 'hasContractors';
                    } else if (this.classList.contains('multiple')) {
                        statusFilter.value = 'multiple';
                    } else if (this.classList.contains('pending')) {
                        statusFilter.value = 'noContractors';
                    } else {
                        statusFilter.value = '';
                    }
                    applyFilters();
                    
                    // Visual feedback
                    this.style.transform = 'scale(0.95)';
                    setTimeout(() => {
                        this.style.transform = 'scale(1)';
                    }, 150);
                });
            });

            updateStats();
            populateTable();
            document.getElementById('updateDate').textContent = new Date().toLocaleDateString('th-TH', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
            
            // Show demo notification
            setTimeout(() => {
                showNotification('üë• Dashboard ‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô - ‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà "‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏´‡∏°‡∏≤‡∏ï‡∏≠‡∏ö‡∏£‡∏±‡∏ö" ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î!');
            }, 1000);
        });
    </script>
</body>
</html>